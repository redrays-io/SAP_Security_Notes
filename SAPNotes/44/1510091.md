SAP Security Note 1510091 - Unauthorized usage of application functionality in MFG-MII

**Description**

An unauthorized user can trigger functionality in SAP Manufacturing Integration and Intelligence (MII) on behalf of an unsuspecting authorized user, leading to potential Cross-Site Request Forgery (CSRF) attacks.

**Impact**

This vulnerability allows unauthenticated third parties to execute state-changing operations in MII without the authorized user's knowledge or consent.

**Affected Versions**

- **XMII 12.0**
- **XMII 12.1**

**Solution**

To address this vulnerability, implement XSRF protection by adopting the SAP NetWeaver Application Server Java's XSRF Protection Framework. Follow the steps below:

1. **Apply Required Notes:**
   - Ensure that [SAP Note 1450166](https://me.sap.com/notes/1450166) is applied to enable the XSRF Protection Framework.

2. **Configure XSRF Protection:**
   - Copy the `xsrf-config.xml` file attached to this note into the `/WEB-INF` directory of your MII application.
   - Replace the existing JSP files with the ones provided in the `XSRF_JSP_FILES.zip` attachment. These enhanced JSP pages include tokens for state-critical actions.

3. **Handle Customizations:**
   - If you have modified JSP pages for custom branding or other purposes, manually incorporate the token additions to maintain XSRF protection.
   - For any additional or custom state-changing actions, configure them in the `xsrf-config.xml` file and include the necessary tokens in your pages.

4. **Review and Test:**
   - After implementing the changes, thoroughly test your application to ensure that XSRF protections are functioning correctly without disrupting legitimate operations.

**Attachments**

- [xsrf-config.zip](https://userapps.support.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012003146900000383522010&iv_version=0004&iv_guid=9553CA6CC943624485A2B770D22B963D)
- [XSRF_JSP_FILES.zip](https://userapps.support.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012003146900000383522010&iv_version=0004&iv_guid=F4BA503F03A6E748AC6BEA89985BD49A)

**Support Package Patches**

- **XMII 12.1 SP005:** [Download SP005](https://me.sap.com/sap/support/swdc/notes?cvnr=01200314690200006512&support_package=SP005&patch_level=000000)
- **XMII 12.1 SP008:** [Download SP008](https://me.sap.com/sap/support/swdc/notes?cvnr=01200314690200006512&support_package=SP008&patch_level=000000)
- **XMII 12.0 SP012:** [Download SP012](https://me.sap.com/sap/support/swdc/notes?cvnr=01200314690200005134&support_package=SP012&patch_level=000000)

**Download Links**

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000017098032017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001510091?language=en-US&token=28B531C3A4367500F14809C81F636400)

**References**

- [MII 12.1 SP08](https://me.sap.com/notes/1537813)
- [SAP Note 1450166 - Unauthorized usage of application functionality](https://me.sap.com/notes/1450166)

For more detailed information, please refer to the full security note on the [SAP Support Portal](https://me.sap.com/notes/1510091).

Credits to [Redrays.io](https://redrays.io) for support in providing this information.