SAP Security Note 1585767 - Enabling Virus Scanning in SAP Content Server

**Symptom**

This security note has been updated. For more detailed information, see [Security Note 1751530](https://me.sap.com/notes/1751530).

Files uploaded to a SAP HTTP content server could contain a virus, trojan, or backdoor. If a user opens these kinds of files, the Content Server will be infected, which in turn could lead to a content server crash.

**Other Terms**

Content Server, Virus Scan, upload

**Reason and Prerequisites**

Enabling the virus scanner in SAP Content Server is required to upload safe files into the Content Server.

**Solution**

Please refer to [Note 514500](https://me.sap.com/notes/514500) and download the latest patch for SAP Content Server.

The solution provides only the feature of scanning files during the file upload to SAP Content Server. It does not provide features like FullScan, Quick Scan, and Quarantine.

**WINDOWS CONTENT SERVER:**

After installing the latest patch, perform the following settings in the CSADMIN transaction and Virus Scanner INI file to enable virus scanning.

**I) Changes in CSADMIN Transaction:**

1. Go to the CSADMIN transaction.
2. Select the Repository Name and navigate to the **Settings** tab.
3. Configure the following parameters:

   - **VirusScan**
     - **Type:** Boolean
     - **Default setting:** 0
     - **Values:** 0, 1
     - **Mandatory:** Yes
     - **Description:** Enables VirusScan if set to one.

   - **ScanDirectory**
     - **Type:** Character
     - **Default setting:** Windows TEMP directory
     - **Values:** Any accessible path in the local machine (e.g., `ScanDirectory=C:\TempDirectory`)
     - **Mandatory:** Yes
     - **Description:** Directory used to save temporary files for scanning.

   - **VSINIPath**
     - **Type:** Character
     - **Values:** Path where the Virus_scanner.ini file is present (e.g., `VSINIPath=C:\Virus_Scanner.ini`)
     - **Mandatory:** Yes
     - **Description:** Path to the Virus_scanner.ini file.

   Copy the attached `Virus_Scanner.txt` file to your local machine and rename it to `Virus_Scanner.ini`. Provide the path in CSADMIN as mentioned above.

**II) Changes in Virus_Scanner.ini File:**

Configure the following sections in the `Virus_Scanner.ini` file:

- **[Path to VSA]**
  - **VSA Adapter:** Path to the virus scanner adapter (e.g., `VSA Adapter=C:\Vssap.dll`)
  - **Description:** Refer to [Note 1494278](https://me.sap.com/notes/1494278) for available virus scanner adapters.

- **[Configuration Parameters]**
  - Set the necessary configuration parameters as per your virus scan adapter. Refer to [Note 786179](https://me.sap.com/notes/786179) for more details.

- **[Trace File Path]**
  - **Trace File:** Path for trace logs (e.g., `Trace File=C:\`)
  - **Description:** Logs virus scanner-specific errors or warnings.

- **[Trace Levels]**
  - **Trace Parameter:** Set to 1, 2, or 3 based on desired tracing level.

For detailed documentation, refer to the attached `Virus_Scanner.txt` file.

**UNIX CONTENT SERVER:**

After installing the latest patch, perform the following settings in the CSADMIN transaction and `vs.conf` file to enable virus scanning.

**I) Changes in CSADMIN Transaction:**

1. Go to the CSADMIN transaction.
2. Select the Repository Name and navigate to the **Settings** tab.
3. Configure the following parameters:

   - **VirusScan**
     - **Type:** Character
     - **Values:** all, None
     - **Mandatory:** Yes
     - **Description:** Enables VirusScan if set to all.

   - **ScanDirectory**
     - **Type:** Character
     - **Values:** Any accessible path in the local machine (e.g., `ScanDirectory=/tmp`)
     - **Mandatory:** Yes
     - **Description:** Directory used to save temporary files for scanning.

   - **VSConfPath**
     - **Type:** Character
     - **Values:** Path where the `vs.conf` file is present (e.g., `VSConfPath=/tmp/vs.conf`)
     - **Mandatory:** Yes
     - **Description:** Path to the `vs.conf` file.

   Copy the attached `Virus_Scanner_Unix.txt` file to your local machine and rename it to `vs.conf`. Provide the path in CSADMIN as mentioned above.

**II) Changes in vs.conf File:**

Configure the following sections in the `vs.conf` file:

- **[VirusScanner]**
  - **VSAPath:** Path to the virus scanner adapter (e.g., `VSAPath=/tmp/vssap.so`)
  - **Description:** Refer to [Note 1494278](https://me.sap.com/notes/1494278) for available virus scanner adapters.

- **[TraceFile]**
  - **TraceFile:** Path for trace logs (e.g., `TraceFile=/tmp/`)
  - **Description:** Logs virus scanner-specific errors or warnings.

- **[TraceLevel]**
  - **Values:** 1, 2, 3
  - **Description:** Sets different levels of tracing.

- **[VSA-Params]**
  - Set necessary configuration parameters as per your virus scan adapter. Refer to [Note 786179](https://me.sap.com/notes/786179) for more details.

For detailed documentation, refer to the attached `Virus_Scanner_Unix.txt` file.

**Attachments**

- [Virus_Scanner.TXT](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012003146900000203472011&iv_version=0010&iv_guid=59866D406C8E0A4DBBE2268F50AC260A)
- [Virus_Scanner_Unix.TXT](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012003146900000203472011&iv_version=0010&iv_guid=6E5FA9C073EFD64BAFE9D47A92158C0B)

**References**

- [Security Note 1751530](https://me.sap.com/notes/1751530) - Update 1 to security note 1585767
- [Note 1494278](https://me.sap.com/notes/1494278) - NW-VSI: Summary of Virus Scan Adapter's for SAP integration
- [Note 786179](https://me.sap.com/notes/786179) - Data security products: Use in the antivirus area
- [Note 514500](https://me.sap.com/notes/514500) - Importing patches for SAP Content Server 6.50

**Credits**

Credits to [Redrays.io](https://redrays.io) for support in providing this information.