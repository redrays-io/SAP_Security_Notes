SAP Security Note 1521197 - Update #1 to Security Note 1517094 Released

**Description**
SAP Security Note 1521197 addresses critical issues encountered in CRM 4.0 IS after implementing and activating security-relevant changes in SAP NetWeaver (Note 1532777). Specifically, the CRM Interaction becomes non-startable from the browser, leading to multiple communication problems such as:

- **CTI → Worker session**
- **Agent session → Worker session**
- **Browser (polling, SAM communication) → ICM or Worker Session**

Common errors include:
- `400 Session not found`
- `HTTPIO_USER_VALIDATION_SSOCOOKIE_MISSING` (see Note 1266780)
- `HTTPIO_USER_VALIDATION_SSOCOOKIE_INVALID`

**Prerequisites**
Before implementing this security note, ensure that you have applied the necessary corrections from related notes:
- [Note 1420203 - Enable foreign access to a stateful HTTP session](https://me.sap.com/notes/1420203)
- [Note 1517094 - CRM-IC: Session Access Token](https://me.sap.com/notes/1517094)
- [Note 1532777 - Collective Note: ABAP Session Protection Recommendations](https://me.sap.com/notes/1532777)
- [Note 1310561 - SAP J2EE Engine Session Fixation Protection](https://me.sap.com/notes/1310561)
- [Note 1301591 - HTTP 400 - Session not found (Stateful HTTP communication)](https://me.sap.com/notes/1301591)
- [Note 1266780 - User check for each HTTP request](https://me.sap.com/notes/1266780)

**Solution**
Implementing this security note involves both automated corrections and manual activities:

1. **Download and Apply Corrections**
   - [Download for SNOTE](https://notesdownloads.sap.com/note/0040000009020302017)
   - [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001521197?language=en-US&token=E9C7D6BB88659223BB7157285EF2586D)

2. **Manual Activities**
   - **Pre-Implementation Steps:**
     - Update MIME repository objects in BSP applications `SAM_SESS_QUEUE` and `SAM_NOTIFYING` with provided JavaScript files from the `CRMIS.ZIP` attachment.
     - Create and update specific classes in SE80 as detailed in the attached `STEP-BY-STEP-PRE-NOTE-1521197.pdf`.
   
   - **Post-Implementation Steps:**
     - Create new nodes in transaction `SICF` under the `sap` node for `ic_frame`, `notify`, and `polling`.
     - Activate the newly created services in `SICF`.
     - Create a new concept ID in transaction `SOTR_EDIT` with specific configurations.
     - Modify BSP application properties for `CRM_IC` to set session lifetime.
     - If using HTTPS, create an RFC destination `CRM_RT_HTTPS` in transaction `SM59` with appropriate SSL settings.
     - Invalidate and clean browser and backend server caches to ensure changes take effect.

3. **Testing**
   - After implementing both pre and post-installation steps, release and import the transports into the quality environment.
   - Thoroughly test the `CRM_IC` application before moving changes to the production environment.
   - Ensure that SICF entries are active in all systems across the landscape.

**References**
- [Note 1532777 - Collective Note: ABAP Session Protection Recommendations](https://me.sap.com/notes/1532777)
- [Note 1517094 - CRM-IC: Session Access Token](https://me.sap.com/notes/1517094)
- [Note 1420203 - Enable foreign access to a stateful HTTP session](https://me.sap.com/notes/1420203)
- [Note 1310561 - SAP J2EE Engine Session Fixation Protection](https://me.sap.com/notes/1310561)
- [Note 1301591 - HTTP 400 - Session not found (Stateful HTTP communication)](https://me.sap.com/notes/1301591)
- [Note 1266780 - User check for each HTTP request](https://me.sap.com/notes/1266780)

**Attachments**
- [STEP-BY-STEP-PRE-NOTE-1521197.pdf](https://me.sap.com/notes/0001521197/P)
- [CRMIS.ZIP](https://me.sap.com/notes/0001521197/Z)

For more detailed instructions and updates, visit the [SAP Support Portal](https://me.sap.com/).

*Credits to [https://redrays.io](https://redrays.io) for support in providing this information.*