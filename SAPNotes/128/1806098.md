SAP Security Note 1806098 - Unauthorized Use of Application Functions in REST Interface

**Symptom**
An attacker can execute functions in the SAP NetWeaver Identity Management 7.2 REST interface with version identifier "v72alpha" without authentication and authorization.

**Other Terms**
Cross-site request forgery, XSRF, Identity Management, ID Mgmt, IdM, REST, v72alpha

**Reason and Prerequisites**
The SAP NetWeaver Identity Management 7.2 REST interface with version identifier "v72alpha" executes certain functions by referencing specific URLs. When an attacker tricks an authenticated user's browser into making a request containing a certain URL and specific parameters, the function is executed with the rights of the authenticated user. This vulnerability applies to all modification operations provided by the REST interface. Attackers may use cross-site scripting attacks or present malicious links to the victim.

**Solution**

**Security Correction: Prerequisites**
A security correction is available to prevent the described attack. This correction utilizes a new protection infrastructure introduced with:
- SAP NetWeaver Application Server Java (AS Java) 7.30 SP09
- AS Java 7.3 EhP 1 SP06

Ensure your AS Java is updated to one of these releases or higher, and deploy the SAP NetWeaver Identity Management User Interface component version containing the security correction.

**Security Correction: Availability**
- Apply the attached patch for SAP NetWeaver Identity Management 7.2 SP07 User Interface.
- No patch is required for SAP NetWeaver Identity Management 7.2 SP08 and later.

**Security Correction: Required Changes to REST Clients**
The correction introduces a token-based protection mechanism for modifying requests:
1. **Retrieve a Token**
   - Perform a GET, HEAD, or OPTIONS request with the HTTP header `X-CSRF-Token: Fetch`.
   - The REST interface generates and returns a token in the `X-CSRF-Token` response header.
2. **Use the Token**
   - Include the retrieved token in the `X-CSRF-Token` header for all modifying requests.
   - Ensure all cookies set by the server during the token retrieval are included in modifying requests.

If validation fails, a `403 Forbidden` status is returned. Successful validation allows the requested operation to proceed.

**Temporary Measures If Immediate Update Is Not Feasible**
- **Disable the New Protection Mechanism:**
  If you cannot update all REST clients immediately, you can temporarily disable the new protection mechanism:
  1. Navigate to **SAP NetWeaver Administrator** > **Configuration** > **Infrastructure** > **Java System Properties**.
  2. Filter for the `tc~idm~jmx~rest~app` web application.
  3. Modify the `v72alpha.security.xsrf.disable_token_based_protection` property to `true`.
  4. Restart AS Java.

  **Note:** Ensure you apply additional protective measures, such as limiting REST interface access to specific hosts.

- **Disable the REST Interface:**
  If the REST interface is not needed, deactivate the `idmrest` application alias on AS Java to block access.
  - For detailed procedures, refer to the [SAP Help Portal](https://me.sap.com/).

- **Limit Access to Specific Hosts:**
  Restrict REST interface access to trusted hosts using firewall or load balancer URL filtering. Ensure that only necessary hosts can communicate with the REST interface to mitigate XSRF risks.

**Download Links**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000017582012017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001806098?language=en-US&token=E8F6FFE8B248EEF08FC204682DBBF36B)

For more information and updates, visit [SAP Support](https://me.sap.com/).

*Credits to [RedRays.io](https://redrays.io) for supporting the provision of this information.*