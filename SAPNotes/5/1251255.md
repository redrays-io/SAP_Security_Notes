SAP Security Note 1251255 - Authorizations for the system user (WF-BATCH)

## Description

**Symptom:**
You use a system user to execute and manage workflows. This system user is defined in the RFC destination `WORKFLOW_LOCAL_<client>`, typically named `WF-BATCH`, though a different user can be specified.

The authorization profile `SAP_ALL` is assigned to the system user. You may want to restrict the authorizations of this system user for enhanced security.

**Other Terms:**
- **PFCG:** Profile Generator in SAP used for role maintenance.

**Reason and Prerequisites:**
Creating the RFC destination `WORKFLOW_LOCAL_<client>` using transaction `SWU3` (Automatic Workflow Customizing), specifically the activity 'Configure RFC Destination'. If you use the function 'Perform Automatic Workflow Customizing (F9)', the system automatically creates the user `WF-BATCH` if it does not already exist. In such cases, the system assigns all profiles of the user executing `SWU3` to `WF-BATCH`, which may include the `SAP_ALL` profile.

Additionally, there is no existing PFCG role to restrict the authorizations of the system user, posing a security risk.

## Solution

This note provides a correction and introduces a new PFCG role to address the issue.

1. **Apply the Correction:**
   - After implementing the correction from this note, the system ensures that the `SAP_ALL` profile is never assigned to the user `WF-BATCH` when using the 'Perform Automatic Workflow Customizing (F9)' function.
   - The correction is available from SAP_BASIS version 610 onwards. In versions below 610, the function 'Configure RFC Destination' is not available, preventing the assignment of `SAP_ALL` when using transaction `SWU3`.

2. **Utilize the New PFCG Role:**
   - **Role Name:** `SAP_BC_BMT_WFM_SERV_USER`
   - **Availability:** Delivered for SAP_BASIS 640 and higher releases.
   - **Functionality:** Contains all necessary authorizations required by the workflow runtime to execute and manage workflows. Note that it does **not** include application-specific authorizations, which are typically required for using SAP Business Workflow within applications.

3. **Restricting Authorizations:**
   - **Set the Plan Version:**
     - Assign your active plan version to the Plan Version field in the role `SAP_BC_BMT_WFM_SERV_USER` and generate the authorization profile.
   
   - **Assign the Role:**
     - Use user maintenance to remove all existing role and profile assignments from the system user and assign only the `SAP_BC_BMT_WFM_SERV_USER` role.
   
   - **Add Application-Specific Authorizations:**
     - Identify active workflows and their underlying applications.
     - Assign existing roles for these applications to the system user. These roles may be standard SAP roles or custom roles tailored to your environment.
     - Use the system trace (`transaction ST01`) to identify any missing authorizations required by the workflows and add them to an existing or new role assigned to the system user.
     - Verify the correct execution of workflows after assigning the necessary roles and adjust as needed based on trace results.

## References

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000007315282017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001251255?language=en-US&token=1FADD990AAF51C906137AB3588224A53)
- [Edit Note](https://me.sap.com/sap/support/notes/edit/0001251255)
- [Show Changes](https://me.sap.com/notesLatestChanges/0001251255/E/diff)

## Validity

- **SAP_BASIS Versions:**
  - From 610 to 640
  - From 700 to 702
  - From 710 to 720

## Support Package

Refer to the following support packages for applicable SAP_BASIS versions:

- [SAPKB62068 for SAP_BASIS 620](https://me.sap.com/supportpackage/SAPKB62068)
- [SAPKB64026 for SAP_BASIS 640](https://me.sap.com/supportpackage/SAPKB64026)
- [SAPKB64024 for SAP_BASIS 640](https://me.sap.com/supportpackage/SAPKB64024)
- [SAPKB70018 for SAP_BASIS 700](https://me.sap.com/supportpackage/SAPKB70018)
- [SAPKB70022 for SAP_BASIS 700](https://me.sap.com/supportpackage/SAPKB70022)
- [SAPKB70103 for SAP_BASIS 701](https://me.sap.com/supportpackage/SAPKB70103)
- [SAPKB70107 for SAP_BASIS 701](https://me.sap.com/supportpackage/SAPKB70107)
- [SAPKB70203 for SAP_BASIS 702](https://me.sap.com/supportpackage/SAPKB70203)
- [SAPKB71007 for SAP_BASIS 710](https://me.sap.com/supportpackage/SAPKB71007)
- [SAPKB71010 for SAP_BASIS 710](https://me.sap.com/supportpackage/SAPKB71010)
- [SAPKB71101 for SAP_BASIS 711](https://me.sap.com/supportpackage/SAPKB71101)
- [SAPKB71105 for SAP_BASIS 711](https://me.sap.com/supportpackage/SAPKB71105)
- [SAPKB72003 for SAP_BASIS 720](https://me.sap.com/supportpackage/SAPKB72003)

## Correction Instructions

- [Correction Instructions for SAP_BASIS](https://me.sap.com/corrins/0001251255/41)

---

*Credits to [Redrays.io](https://redrays.io) for support in providing this information.*