SAP Security Note 1582983 - MDSD Admin Console is vulnerable to XSRF attacks.

## Description

An unauthorized user can trigger functionality in the MDSD Admin Console on behalf of an unsuspecting authorized user by deceiving them into triggering a URL callback via a script or special HTML element parameter.

**Other Terms:** Cross-Site Request Forgery (CSRF), XSRF, MDSD Admin Console

## Reason and Prerequisites

The MDSD Admin Console (which contains Servlets/JSP pages) executes state-changing functionality via URLs. In certain scenarios, it is possible for an unauthorized and unauthenticated third party to trigger this functionality on behalf of an authorized authenticated user without the latter's knowledge and/or consent.

## Solution

XSRF attacks must be addressed within web applications. These applications must ensure that for state-changing operations, they are not relying solely on credentials or tokens that are automatically submitted by browsers. A common approach is to include a special token in each request, which is associated with the user session and is valid only for the session's lifetime.

The SAP NetWeaver Application Server Java (AS Java) has been enhanced with the XSRF Protection Framework. You can secure your web application with the token-based approach by adopting this framework. This note contains the steps to adopt the XSRF Protection Framework for the MDSD Admin Console.

SAP's XSRF Protection Framework is available for specific versions of SAP NetWeaver. Please refer to [Note 1450166](https://me.sap.com/notes/1450166) for details regarding availability. To enable XSRF protection for the MDSD Admin Console, apply the aforementioned note before undertaking the steps highlighted in this note. Additionally, refer to the [SAP XSRF Protection Guide](https://me.sap.com/notes/1450166) to gain an overall understanding of the XSRF protection procedure.

Once you have reviewed the above documentation, follow these detailed steps specific to the MDSD Admin Console:

1. **Standard XSRF Protection Approach:** XSRF protection for the MDSD Admin Console uses the standard XSRF protection approach. Refer to the Protection Guide for details.
2. **Obtain Latest Hotfix:** According to [Note 1582779](https://me.sap.com/notes/1582779), obtain the latest Hotfix and deploy the newest version of `MDSD.ear` to your J2EE.
3. **Modified JSP Pages:** If the JSP pages have been modified (e.g., for customer-specific branding), manually include the changes that add tokens to state-changing actions to prevent loss of modifications.
4. **Additional State-Changing Actions:**
   - **Configure Actions:** Configure additional actions triggering state changes on AS Java in the `xsrf-config.xml` file. Refer to the Protection Guide for details.
   - **Include Tokens:** Include URL parameters or hidden form fields on the pages to add the tokens. Refer to the Protection Guide for details.

**Affected SAP Delivered JSP Pages in MDSD Admin Console:**
- `/tmpls/lLogin.jsp`
- `/tmpls/detail1.jsp`
- `/tmpls/search1.jsp`
- `/tmpls/list1.jsp`
- `/tmpls/list2.jsp`
- `/tmpls/settings.jsp`

## References

- [SAP Note 1680716 - Unauthorized modification of displayed content in MDSD Admin](https://me.sap.com/notes/1680716)
- [SAP Note 1582779 - Patch for MDSD Admin Console](https://me.sap.com/notes/1582779)
- [SAP Note 1450166 - Unauthorized usage of application functionality](https://me.sap.com/notes/1450166)

## Validity

**Software Components:**
- **MBA-DSD:** Versions 2.1, 3.0, 4.0
- **MDSDADMINCONSOLE:** Version 4.0

## Support Package Patches

- **MDSD 3.0 SP003:** [Link](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=01200615320200008610&support_package=SP003&patch_level=000000)
- **XMDSD 2.1 SP003:** [Link](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=01200615320200008609&support_package=SP003&patch_level=000000)
- **XMDSD 2.1 SP002:** [Link](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=01200615320200008609&support_package=SP002&patch_level=000011)
- **XMDSD 2.1 SP001:** [Link](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=01200615320200008609&support_package=SP001&patch_level=000023)
- **MDSD 4.0 SP001:** [Link](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=01200314690200008359&support_package=SP001&patch_level=000000)

---

*Credits: [redrays.io](https://redrays.io) for support in providing this information.*