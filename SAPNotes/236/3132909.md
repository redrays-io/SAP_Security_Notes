3132909 - [CVE-2021-44228] Remote Code Execution vulnerability associated with Apache Log4j 2 component used in SAP Edge Services On Premise Edition

## Symptom

**UPDATE 11th January 2022**: This note has been re-released with updated 'Solution' information. This update upgrades the product to Log4j version 2.17.1

SAP Edge Services On Premise Edition uses a version of the open-source component Apache Log4j 2 which is vulnerable to remote code execution (CVE-2021-44228).

Some well-known impacts of Code Injection vulnerabilities include:

- Unauthorized execution of commands
- Sensitive information disclosure
- Denial of Service

## Other Terms

Command Injection, OS command injection, Remote Code Execution, Log4j2, [CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228), [CVE-2021-45105](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45105), [CVE-2021-45046](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45046), [CVE-2021-44832](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44832)

## Solution

A patch of SAP Edge Services On-premise Edition v3.5.1 has updated the Log4j2 open-source library to 2.17.1.

1. **Download the SP05 Patch1 for DEP_IOT_EDGE 3.0** from the [SAP Marketplace](https://me.sap.com/#/softwarecenter/search/DEP_IOT_EDGE).
2. **Upgrade the existing installation** following the [Streaming Service Configuration Guide](https://help.sap.com/viewer/product/SAP_EDGE_SERVICES_OP/3.0.5/en-US) from the SAP Help Portal.

### Workaround

Remove the vulnerable class from the Log4J-core jar file:

1. Stop any running SAP Edge Services (`start.sh` for Linux or `start.bat` for Windows).
2. Locate the root of your Edge Services On-Premise installation, referred to as `<EdgeServicesRuntime>`.
3. Edit the jar `<EdgeServicesRuntime>/plugins/log4j-core-2.x.x.jar`. In the latest feature pack FP05, the file is `<EdgeServicesRuntime>/plugins/log4j-core-2.13.2.jar`.
4. Remove the class `org/apache/logging/log4j/core/lookup/JndiLookup.class` using a graphical zip/jar editor or a command line tool, for example:
   ```
   zip -q -d log4j-core-*.jar org/apache/logging/log4j/core/lookup/JndiLookup.class
   ```
5. Restart SAP Edge Services (`start.sh` for Linux or `start.bat` for Windows).

## CVSS

- **CVSS Score**: 10.0
- **CVSS Vector**: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H

## References

- [CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228)
- [CVE-2021-45105](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45105)
- [CVE-2021-45046](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45046)
- [CVE-2021-44832](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44832)

For more details, visit the [SAP Security Note 3132909](https://me.sap.com/notes/3132909).

*Credits to [RedRays](https://redrays.io) for supporting the provision of this information.*