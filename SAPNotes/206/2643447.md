2643447 - Directory Traversal Vulnerability in ABAP Server File Interface

**Description**

SAP Security Note [2643447](https://me.sap.com/notes/0002643447) addresses a **Directory Traversal vulnerability** in the ABAP Server File Interface. This vulnerability allows an attacker to exploit insufficient validation of path information provided by users, enabling characters that represent traversal to parent directories to be passed through to the file APIs.

**Impacts of Directory Traversal Vulnerability:**
- **Data Exposure:** Attackers could read the content of arbitrary files on the remote server, potentially exposing sensitive data.
- **Data Integrity:** Attackers could overwrite, delete, or corrupt arbitrary files on the remote server.

**Reason and Prerequisites**

Several issues contribute to this vulnerability:
1. The method `IS_SUBPATH_OF` in class `CL_FS_PATH` may fail to correctly convert relative paths to absolute paths in rare cases, leading to incorrect results.
2. On Microsoft Windows systems, certain path formats are not correctly recognized as equal by the methods `IS_EQUAL` and `IS_SUBPATH_OF`:
   - Paths starting with a single backslash (`\`) refer to the current drive, causing different path representations to point to the same file.
   - Dots after directory or file names are ignored, leading to equivalent but syntactically different paths.
   - Paths beginning with the prefix `\\?\` may not be handled correctly, affecting hostname and drive letter retrieval, and recognition of equivalent paths.

**Solution**

To mitigate this vulnerability, apply the **correction instructions** provided in this SAP Note or the corresponding Support Package. These corrections ensure that:
- Paths in cases 2.a) and 2.b) are correctly recognized as equal.
- The behavior in cases 1) and 2.c) aligns with expected security measures.
- For case 2.d), introduce the optional parameter `ignore_uncw_prefix` in the methods `IS_EQUAL` and `IS_SUBPATH_OF` to discard the `\\?\` prefix when necessary.

**CVSS Information**
- **CVSS Score:** 6.3
- **Vector:** CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L

**Affected Components**
- **Software Component:** SAP_BASIS
- **Versions:** Various, including 700 to 753

**Support Packages**
Apply the relevant Support Package for your SAP_BASIS version as listed in the [Support Package](https://me.sap.com/supportpackage/SAPKB70037) section of the SAP Note.

**References**
- [Update 1 to Security Note 2643447](https://me.sap.com/notes/2812152)
- [Error in SPAM when loading EPS files](https://me.sap.com/notes/2978800)
- [Problems with SAP Note 2643447 when installing a support package](https://me.sap.com/notes/2805129)

**Prerequisites**
Ensure that all prerequisite SAP Notes are applied as listed in the [Preconditions](https://me.sap.com/notes/0002643447#prerequisites) section to maintain system stability and integrity.

For detailed information and to download the full security note, visit the [SAP Support Portal](https://me.sap.com/notes/0002643447).

*Credits to [RedRays.io](https://redrays.io) for supporting and providing the information.*