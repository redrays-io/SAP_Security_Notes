2427949 - Incorrect Authorization Checks in SAP ERP Logistics Customer Master and Vendor Master

## Symptom

**UPDATE 17th January 2018**: This note has been re-released with updated "Correction instructions" information.

SAP ERP Logistics Customer Master and Vendor Master performs incorrect authorization checks for an authenticated user, which may result in potential escalation of privileges.

Some well-known impacts of incorrect authorization checks are:

- Abuse functionality restricted to a particular user group
- Read, modify, or delete restricted data

## CVSS Information

**CVSS v3 Base Score**: 6.3 / 10

**CVSS v3 Base Vector:**

| Metric                     | Value                |
|----------------------------|----------------------|
| Attack Vector (AV)         | Network (N)          |
| Attack Complexity (AC)     | Low (L)              |
| Privileges Required (PR)   | Low (L)              |
| User Interaction (UI)      | None (N)             |
| Scope (S)                  | Unchanged (U)        |
| Confidentiality Impact (C) | Low (L)              |
| Integrity Impact (I)       | Low (L)              |
| Availability Impact (A)    | Low (L)              |

*SAP provides this CVSS v3 base score as an estimate of the risk posed by the issue reported in this note. This estimate does not take into account your own system configuration or operational environment. It is not intended to replace any risk assessments you are advised to conduct when deciding on the applicability or priority of this SAP security note. For more information, see the FAQ section at [SAP Security Notes](https://me.sap.com/securitynotes).*

## Reason and Prerequisites

Remote calls to RFC function modules are protected by checks on the authorization object `S_RFC`. Authorizations for `S_RFC` must be limited to the required minimum authorizations for all users to ensure system security. Please see SAP note [2008727](https://me.sap.com/notes/2008727) for further information on RFC Security.

**Prerequisite**: Note [2179233](https://me.sap.com/notes/2179233) or corresponding support package is implemented.

## Solution

New switchable authorization checks have been implemented. The checks are delivered inactive to ensure compatibility with your running processes. The checks can be activated in transaction `SACF` as described in the manual correction instructions.

### Steps to Activate Switchable Authorization Checks

1. **Create the Authorization Scenario Definition**:
    - Start transaction `SACF` in the development system and check if scenario definitions `LO_MD_BP_CREMAS` (for vendor CREMAS idocs) or `LO_MD_BP_DEBMAS` (for customer DEBMAS idocs) exist. If they exist, proceed to step 2.
    - If the scenario definitions do not exist, download the attachment **LO_MD_BP_IDOC_TRX.TXT** from this note.
    - Start transaction `SACF_TRANSFER`.
    - Select "Upload", choose "Scenario Definition", deselect "Productive Scenarios" and "Test Mode", then execute (F8).
    - Select the file `LO_MD_BP_IDOC_TRX.TXT` and confirm the upload.
    - Assign the scenario definitions `LO_MD_BP_CREMAS` and `LO_MD_BP_DEBMAS` to the development package `VSV`.

2. **Create the Productive Authorization Scenario**:
    - In transaction `SACF`, select "Scenario Definition" and the relevant scenario name, then execute (F8).
    - Double-click the scenario definition and click "Scenario" (or press F5) to transfer it to a productive scenario.
    - Choose the initial scenario status:
        - **Active**: Activates the authorization check and logs to the Security Audit Log.
        - **Logging**: Activates logging only, allowing you to identify users needing the required authorizations without enforcing them immediately.

3. **Activate Logging in Security Audit Log**:
    - Ensure Security Audit Log is activated by checking transaction `SM19` → Environment → Profile parameter (or the "Kernel Parameters" tab).
    - Create a new filter in the active Security Audit Log configuration:
        - **Other events - Non-Critical**:
            - DUO (Authorization check successful)
            - DUP (Authorization check failed)
        - **Other events - Critical**:
            - DUQ (Authorization scenario change)
    - Activate the new filter.

4. **Adjust User Roles**:
    - Use report `RSAU_SELECT_EVENTS` to identify users requiring new authorizations based on DUO and DUP audit messages.
    - Analyze authorization checks using system trace transactions `STAUTHTRACE` or `ST01`.

### Attachments

- **LO_MD_BP_IDOC_TRX.TXT**: [Download Attachment](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=002075125800000665842017&iv_version=0004&iv_guid=6CAE8B3EAC5B1ED6BCED36BECEC4C0C8)

## References

- **Note [2179233](https://me.sap.com/notes/2179233)**: Missing authorization check in LO-MD-BP-CM, LO-MD-BP-VM, FI-AP-AP-N, FI-AR-AR-N
- **Note [2008727](https://me.sap.com/notes/2008727)**: Securing Remote Function Calls (RFC)

## Validity

This document is valid for the following software components:

- **SAP_APPL**: Versions 600 to 618
- **S4CORE**: Versions 100 and 101

## Support Package

Refer to the corresponding support packages for your software component version:

- [SAPK-10004INS4CORE](https://me.sap.com/supportpackage/SAPK-10004INS4CORE) for S4CORE 100
- [SAPK-10102INS4CORE](https://me.sap.com/supportpackage/SAPK-10102INS4CORE) for S4CORE 101
- [SAPKH60029](https://me.sap.com/supportpackage/SAPKH60029) for SAP_APPL 600
- ... *(Include additional support package links as needed)*

*Credits to [RedRays](https://redrays.io) for support in providing this information.*