2983204 - [CVE-2020-26837] Multiple Vulnerabilities in SAP Solution Manager 7.2 (User Experience Monitoring)

**Symptom**

This SAP security note addresses multiple vulnerabilities identified in SAP Solution Manager 7.2 (User Experience Monitoring). The vulnerability details along with their CVE relevant information can be found below.

**Vulnerabilities**

1. **Path Traversal**
   - An authenticated non-administrative user of SAP Solution Manager 7.2 (User Experience Monitoring) can deploy a malicious script which can exploit an existing path traversal vulnerability to fully compromise confidentiality by exposing elements of the file system and partially compromise availability by making certain services unavailable.
   - [CVE-2020-26837](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-26837)
   - **CVSS Score:** 8.5  
     CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:L

2. **Missing Authorization Check**
   - SAP Solution Manager 7.2 (User Experience Monitoring) does not perform necessary authorization checks for an authenticated user. Due to inadequate access control, a network attacker authenticated as a regular user can use operations which should be restricted to administrators. These operations can be used to deploy a malicious User Experience Monitoring script.
   - [CVE-2020-26830](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-26830)
   - **CVSS Score:** 7.6  
     CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L

These issues are relevant for all customers using SAP Solution Manager 7.2 with LM-SERVICE 7.20 deployment.

**Solution**

This fix enforces user authorization checks on the User-Experience Monitoring administration service and thereby removes the root cause of CVE-2020-26830.

*Before proceeding:*
1. Ensure Single Sign-On Automatic Activity in SAP Solution Manager Configuration has been executed successfully. This is available in transaction `SOLMAN_SETUP` under Cross Scenario Configuration > Mandatory Configuration > Infrastructure Preparation: Setup Connectivity > Enable Connectivity. Applicable for all SAP Solution Manager 7.2 support packages.
2. Enable Maintenance Mode using the Agent Administration UI. This procedure is described in the Release Information Note relevant to your SAP Solution Manager 7.2 Support Package stack, as listed in [SAP Note 1595736](https://me.sap.com/notes/1595736).
3. If the "Workaround" was previously applied, revert it following the "Procedure to revert the Workaround" below.

**Patching Procedure for SP03-SP11**
Deploy the LM-SERVICE 7.20 Software Component as mentioned in the "Support Packages & Patches" section for SP03-SP11.

*Additional Procedure for SP03:*
1. Log in to SAP NetWeaver Administration on the SAP Solution Manager Java Stack with the SAP J2EE Admin user.
2. Navigate to **Configuration > Connectivity > Single Service Administration > Service Definitions**.
3. Search for WSDL port Type named 'EemAdmin' and click 'Go'.
4. Select it and display its configuration details in the 'Details' tab.
5. Under the 'Security' tab of the EemAdminBeanPort, enable the following options in the Http Authentication section:
   - [x] User ID/Password
   - [x] Logon Ticket
6. Save the settings. No restart is required.

**Workaround**

This workaround will temporarily deactivate the EemAdmin web-service on the SAP Solution Manager Java stack, preventing the setup of an attack. However, it does not stop an existing attack if a malicious script is already deployed.

*Impact:*
- The SAP Solution Manager User Experience Monitoring scenario cannot be configured until the web-service is reactivated.

*Procedure to apply the workaround:*
1. Authenticate as Java Admin user and open the NetWeaver Administration UI (NWA) on the SAP Solution Manager Java instance.
2. Navigate to the **Operations** tab > **Systems** subtab.
3. Click **Start & Stop**.
4. Go to the **Java Applications** tab.
5. Find and select the `tc~smd~EemAdminGateway` application.
6. Click the `[Stop]` button and confirm.
7. Refresh to ensure the application status is **Stopped**.
8. Prevent automatic restart:
   - Click **More Action** > **Edit Startup Filters**.
   - Enable **Show Advanced Properties**.
   - In the **Filters** tab, add a filter with:
     - Action: `disable`
     - Vendor Mask: `sap.com`
     - Component: `application`
     - Component Name Mask: `tc~smd~EemAdminGateway`
   - Save the settings.

*Important:* If the workaround is applied, revert it when the **Solution** is implemented by following the "Procedure to revert the Workaround" below.

**Procedure to revert the workaround:**
1. Authenticate as Java Admin user and open the NetWeaver Administration UI (NWA).
2. Navigate to **Operations** tab > **Systems** subtab.
3. Click **Start & Stop**.
4. Go to the **Java Applications** tab.
5. Click **More Action** > **Edit Startup Filters**.
6. Enable **Show Advanced Properties**.
7. In the **Filters** tab, remove the filter for `tc~smd~EemAdminGateway`.
8. Save the settings.
9. Continue the installation of the LM-SERVICE patch.

**References**
- [Missing Authorization check and Path traversal in SAP Solution Manager 7.2: FAQ](https://me.sap.com/notes/2998001)
- [LM-SERVICE 7.20 SP 7 Patch 26](https://me.sap.com/notes/2987137)
- [LM-SERVICE 7.20 SP 6 Patch 19](https://me.sap.com/notes/2986640)
- [LM-SERVICE 7.20 SP 3 Patch 8](https://me.sap.com/notes/2986480)
- [LM-SERVICE 7.20 SP 5 Patch 19](https://me.sap.com/notes/2985909)
- [LM-SERVICE 7.20 SP 4 Patch 17](https://me.sap.com/notes/2985796)
- [LM-SERVICE 7.20 SP 11 Patch 5](https://me.sap.com/notes/2985557)
- [LM-SERVICE 7.20 SP 10 Patch 9](https://me.sap.com/notes/2985428)
- [LM-SERVICE 7.20 SP 9 Patch 18](https://me.sap.com/notes/2985418)
- [LM-SERVICE 7.20 SP 8 Patch 24](https://me.sap.com/notes/2979256)

*Credits to [RedRays](https://redrays.io) for support in providing this information.*