1692988 - Directory traversal in SFTP modules

**Symptom**

BC-SRV-COM-FTP contains a vulnerability through which a malicious user can potentially write arbitrary files on the remote server, possibly corrupting data or altering system behavior.

**CVSS Information**

- **CVSS Base Score:** 7.1
- **CVSS Base Vector:** AV:N/AC:H/AU:S/C:C/I:C/A:C

SAP provides this CVSS base score as an estimate of the risk posed by the issue reported in this note. This estimate does not take into account your own system configuration or operational environment. It is not intended to replace any risk assessments you are advised to conduct when deciding on the applicability or priority of this SAP security note. For more information, see the [FAQ section](https://me.sap.com/service.sap.com/securitynotes/) at SAP Security Notes.

**Other Terms**

directory, traversal, BC-SRV-COM-FTP.

**Reason and Prerequisites**

BC-SRV-COM-FTP fails to correctly validate the path a user-submitted file is written to. Through this, an attacker can potentially overwrite data on the remote system.

Please implement [Note 1605054](https://me.sap.com/notes/1605054) before implementing this note.

**Solution**

Please implement the correction instructions attached to this SAP Note (manual and automatic).

To perform a directory traversal check, the logical path name against which the physical path should be validated must be provided by the applications using SAPFTP.

Refer to the following notes for additional configurations:
- [Note 1686247](https://me.sap.com/notes/1686247) to enable the security audit logs.
- [Note 1497003](https://me.sap.com/notes/1497003) for the logical path configuration.

To allow applications to set the logical path, the following class/function module has been created:

1. **For releases >= 620**
   - A singleton class named `FTP_LOGICAL_PATH_CHECK` has been created.
   - Applications must use the method `FTP_SET_LOGICAL_PATH` to set the logical path name.

2. **For releases < 620**
   - Applications must use the function module `FTP_SET_LOGICAL_PATH` to set the logical path name.

Once you have implemented this note, please implement [Note 1754531](https://me.sap.com/notes/1754531) for the functionality to work.

**References**

This document refers to:
- [Note 1808106](https://me.sap.com/notes/1808106) - Update #2 to Security Note 1692988
- [Note 1775527](https://me.sap.com/notes/1775527) - Update 1 to Security Note 1692988
- [Note 1754531](https://me.sap.com/notes/1754531) - Issue with SFTP authority check with note 1692988
- [Note 1725378](https://me.sap.com/notes/1725378) - Path evaluation for SAPFTP functionality in CA-DMS
- [Note 1710330](https://me.sap.com/notes/1710330) - Path evaluation for SAPFTP functionality in BC-SRV-KPR
- [Note 1686247](https://me.sap.com/notes/1686247) - SAL | Interfaces for additional audit log messages (02)
- [Note 1605054](https://me.sap.com/notes/1605054) - Restriction in access to FTP Servers & usage of test reports
- [Note 1497003](https://me.sap.com/notes/1497003) - Potential directory traversals in applications
- [Note 93042](https://me.sap.com/notes/93042) - Problems with SAPFTP

**Preconditions**

Ensure the following notes are applied based on your software component and version:
- SAP_APPL 45B: [1605054](https://me.sap.com/notes/1605054), [1692988](https://me.sap.com/notes/1692988)
- SAP_BASIS versions 46B, 46C, 620, 640, 700, 701, 702, 710, 711, 720, 730, 731: Various notes including [1605054](https://me.sap.com/notes/1605054) and [1692988](https://me.sap.com/notes/1692988)

**Correction Instructions**

- **SAP_BASIS:** 60 Correction Instructions ([View Instructions](https://me.sap.com/corrins/0001692988/41))
- **SAP_APPL:** 4 Correction Instructions ([View Instructions](https://me.sap.com/corrins/0001692988/1))

**Manual Activities**

Please follow the manual activities outlined in the correction instructions to ensure proper implementation.

**Credits**

Credits to [Redrays.io](https://redrays.io) for support in providing this information.