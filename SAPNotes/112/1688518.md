1688518 - Code Injection Vulnerability in Module Editor

**Overview**

A critical security vulnerability (SAP Note **1688518**) has been identified in the SAP Module Editor, allowing for code injection. This vulnerability enables attackers to execute arbitrary ABAP code, potentially leading to unauthorized system behavior and privilege escalation.

**Symptom**

In the customization of the Module Editor, arbitrary ABAP code can be entered. An attacker can control system behavior or escalate privileges by executing malicious code without having legitimate credentials.

**Impact**

An attacker with the necessary developer authorization (`S_DEVELOP` object) can:
- Inject and execute their own code.
- Access sensitive information that should remain hidden.
- Modify or delete data.
- Alter the system's output.
- Create new users with elevated privileges.
- Perform denial-of-service attacks.

**Solution**

Implement the attached corrections or the corresponding support packages to mitigate this vulnerability. After applying this note, users without developer authorization will be restricted to using predefined commands in the Module Editor, preventing the injection of multiple sentences unless they possess the required authorization.

**Action Items**

- **Download the Note:** [Download for SNOTE](https://notesdownloads.sap.com/note/0040000010030922017)
- **View PDF Version:** [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001688518?language=en-US&token=C4F0027F66E747C1CA7FCAE2A1009DFD)

**References**

- [1688294 - New step types for SDL Primary Objects](https://me.sap.com/notes/1688294)
- [1675511 - Code injection vulnerability in module editor for BA70-80](https://me.sap.com/notes/1675511)

**Support Packages**

- **FSAPPL 200:** [SAPKISC319](https://me.sap.com/supportpackage/SAPKISC319)
- **BANK-ALYZE 42:** [SAPKIBAM16](https://me.sap.com/supportpackage/SAPKIBAM16)
- **BANK-ALYZE 50:** [SAPKIBAL27](https://me.sap.com/supportpackage/SAPKIBAL27)

**Manual Correction Instructions**

*For FSAPPL:*
1. **Create Message `/BA1/P3_CT_CUST520`:**
   - Execute transaction SE91.
   - Enter message class `/BA1/P3_CT_CUST` and message number `520`.
   - Change mode and copy the text as follows:
     - **English:** "You are not authorized to process the step &1"
     - **German:** "Sie besitzen keine Berechtigung, um den Schritt &1 zu bearbeiten"
   - Save the message.

2. **Add Text Elements in Class `/BA1/P3_CL_STP`:**
   - Execute transaction SE24.
   - Enter class `/BA1/P3_CL_STP` and change mode.
   - Go to the 'Goto' menu and select 'Text Element'.
   - Add the following texts:
     - **German:**
       - Sym Text: dLen mLen
       - ST1 Formel: 6 10
       - ST2 Bedingung: 9 14
       - ST3 Tabellen-Schleife: 17 24
     - **English:**
       - Sym Text: dLen mLen
       - ST1 Formula: 4 10
       - ST2 Condition: 9 14
       - ST3 Table Loop: 17 24

3. **Create New Method `_CHECK_AUTHORITY_FOR_DEV` in Class `/BA1/P3_CL_STP`:**
   - Execute transaction SE24.
   - Enter class `/BA1/P3_CL_STP` and change mode.
   - Select the 'Method' tabstrip and add the method `_CHECK_AUTHORITY_FOR_DEV` with:
     - **Level:** Instance Method
     - **Visibility:** Private
     - **Parameters:**
       - `I_STEPTYPE` (Importing, Type `/BA1/P3_DE_STPTYP`)
       - `I_ACTVT` (Importing, Type `ACTIV_AUTH`)
       - `I_TAB_STRLINE` (Importing, Type `/BA1/P3_TT_TXLINE`)
     - **Exceptions:**
       - `NO_AUTHORITY` (Description: NO_AUTHORITY)

4. **Create Variable `FLG_NO_AUTH` in Class `/BA1/P3_CL_STP`:**
   - Execute transaction SE24.
   - Enter class `/BA1/P3_CL_STP` and change mode.
   - Select the 'Attributes' tabstrip and add the variable `FLG_NO_AUTH` with:
     - **Attribute:** FLG_NO_AUTH
     - **Level:** Instance Attribute
     - **Visibility:** Public
     - **Type:** BOOLEAN

*For BANK-ALYZE:*
- Follow similar steps as above with component-specific details.

**Prerequisites**

Ensure the following SAP Notes are implemented before applying this note:
- [967155 - Generation of Modules is not performed after transport](https://me.sap.com/notes/967155)
- [1001391 - Module cannot be deleted because of incorrect WUL](https://me.sap.com/notes/1001391)
- [1349191 - Module Editor: Where-Used List ignores comment steps](https://me.sap.com/notes/1349191)
- [1367232 - Lines in print-preview are cut off](https://me.sap.com/notes/1367232)
- [1371825 - Continue of note 1367232](https://me.sap.com/notes/1371825)
- [1554575 - Wrong order of exceptions in FM step](https://me.sap.com/notes/1554575)
- [1356259 - WUL doesn't work for DDIC environment](https://me.sap.com/notes/1356259)

**Release Information**

- **Released On:** May 8, 2012
- **Status:** Released for Customer
- **Category:** Program Error
- **Priority:** Correction with High Priority

**Credits**

Information provided with support from [RedRays](https://redrays.io).