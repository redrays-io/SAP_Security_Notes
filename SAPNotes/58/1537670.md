SAP Security Note 1537670 - Unauthorized usage of application functionality in FSCM_BD

**SAP Security Note 1537670 - Unauthorized usage of application functionality in FSCM_BD**

**Symptom**  
An unauthorized user can trigger functionality in FSCM_BD on behalf of an unsuspecting authorized user.

**Other Terms**  
Cross-Site Request Forgery (CSRF, XSRF), FSCM_BD

**Reason and Prerequisites**  
FSCM_BD executes state-changing functionality via referencing URLs. In certain scenarios, it is possible for an unauthorized and unauthenticated third party to trigger this functionality on behalf of an authorized authenticated user without their knowledge or consent.  
*Prerequisite:* Please refer to [Note 1509214](https://me.sap.com/notes/1509214).

**Solution**  
To mitigate XSRF attacks, web applications must ensure that state-changing operations do not rely solely on credentials or tokens automatically submitted by browsers. A common approach is to include a special token in each request, associated with the user session and valid for the session lifetime.

The SAP NetWeaver Application Server Java (AS Java) has been enhanced with the XSRF Protection Framework. Secure your web application with the token-based approach by adopting this framework. This note provides the adoption steps for the XSRF Protection Framework specific to FSCM_BD.

**Steps to Implement XSRF Protection:**

1. **Apply Prerequisite Note:**  
   Ensure [Note 1509214](https://me.sap.com/notes/1509214) is applied before proceeding.

2. **Refer to Required Notes:**  
   - [Note 1450166](https://me.sap.com/notes/1450166) for details on the availability of the XSRF Protection Framework.
   - [SAP XSRF Protection Guide](https://me.sap.com/notes/1450166) for an overall understanding of the XSRF protection procedure.

3. **Affected JSP Pages in FSCM_BD_604 and Lower BD Releases:**
   - `content_activitySearch_html.jsp`
   - `content_downloadFormatChoose_html.jsp`
   - `content_custExtension_html.jsp`
   - `content_info_html.jsp`
   - `content_comp_user_show_html.jsp`

4. **Manual Protection for Specific JSP Page:**
   
   For the JSP page `content_comp_user_edit_html.jsp`, add manual XSRF protection as follows:
   
   - **Declaration in JSP:**
     ```jsp
     <% 
         com.sap.xsrf.XSRFProtector xsrfProtector = com.sap.xsrf.XSRFProtectorFactory.getInstance();   
         String hiddenXsrfField = xsrfProtector.getXsrfEncodedFormField("/", true, request); 
     %>
     ```
   
   - **Insert Hidden Field into Form:**
     ```html
     <form method="post" name="frmPartnerInfo" action="">
         <%=hiddenXsrfField%>
     </form>
     ```
   
5. **Obsolete JSP Pages:**
   - `content_suss_credits_html.jsp`
   - `content_suss_invoices_html.jsp`
   - `content_suss_payments_html.jsp`

**Download and Print Options:**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000017145652017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001537670?language=en-US&token=1317005885AB0BA8961F4088524251AE)

**References:**
- [1597549 - Unauthorized modification of displayed content in FSCM_BD](https://me.sap.com/notes/1597549)
- [1515190 - Composite SAP Note: Security of SAP Biller Direct](https://me.sap.com/notes/1515190)
- [1509214 - Unauthorized usage of application functionality in FSCM_BD](https://me.sap.com/notes/1509214)

**Additional Information:**
- **Component:** Financials > Financial Supply Chain Management > Biller Direct
- **Released On:** 14.12.2010
- **Priority:** Correction with high priority

For more details, visit the [SAP Security Notes](https://me.sap.com/notes/1537670).

*Credits: Thanks to [RedRays](https://redrays.io) for support in providing this information.*