2743329 - Switchable authorization checks for RFC module in In-House-Cash.

## Description

**UPDATE 9th February 2021**: This note has been re-released with the updated 'validity' information. We added the validity for the releases -
- S4CORE 102 102
- S4CORE 103 103
- S4CORE 104 104

This note describes switchable authorization checks for RFC module `IHC_PN_ST_INFO_GET` in the In House Cash Application.

### Symptom

Remote calls to RFC function modules are protected by checks on the authorization object `S_RFC`. Authorizations for `S_RFC` must be limited to the required minimum authorizations for all users to ensure system security. Many RFC function modules can be sufficiently protected using `S_RFC` authorization checks. These RFC function modules often do not perform additional functional authorization checks. Please see [SAP Note 2008727](https://me.sap.com/notes/2008727) for further information on RFC Security.

It was identified that `S_RFC` authorization checks might not be sufficient to ensure secure execution for RFC function modules covered by this note. Activate new switchable authorization checks and update corresponding roles if these RFC function modules are included in `S_RFC` authorizations in your system.

## Solution

New switchable authorization checks have been implemented. The checks are delivered inactive to ensure compatibility with your running processes. The checks can be activated in transaction SACF as described in the attached manual correction instruction.

### New Authorization Scenarios

The following new authorization scenarios can be maintained in transaction SACF after implementing this SAP note:

1. **Scenario 1**
   - `IHC_PN` - In House Cash Payment Order and Item actions

2. **Scenario 2**
   - `IHC_PRQ` - In House Cash Payment Request actions and Document Reversal

### Affected Business Processes and Roles

When checking the status of a payment order, ensure that the user processing the payment order has the necessary authorization to perform the action.

### Affected RFC Function Modules

- `IHC_PN_ST_INFO_GET`

### Implementation of the Switchable Authorization Check

The switchable authorization scenario and the switchable authorization checks are provided via a support package. They can be technically pre-implemented using the correction instructions below. After technical implementation via support package or correction instructions, the checks remain inactive until manual activation.

#### Activation of the Switchable Authorization Check

Follow the post-processing activities below after technical implementation to activate the authorization checks.

**For Scenario IHC_PN:**

1. **Step 1**: Create the authorization scenario definition in systems where they do not exist yet (transported as workbench objects in your landscape):
   - Start transaction SACF in the development system and check if scenario definition `IHC_PN` exists. If it exists, proceed to step 2.
   - If the scenario definition does not exist in SACF, download the file [IHC_PN.txt](https://me.sap.com/notes/0002743329/IHC_PN.txt) attached to this note.
   - Start transaction `SACF_TRANSFER`.
   - Select the radio button "Upload", select work area "Scenario Definition", deselect work area "Productive Scenarios", deselect "Test Mode", and execute (F8).
   - Choose the file `IHC_PN.txt` and confirm the upload.
   - Assign the scenario definition `IHC_PN` to the development package `FIN_IHC`.

2. **Step 2**: Individually activate the switchable authorization checks by creating productive authorization scenarios from scenario definitions in transaction SACF. [SAP Note 1922808](https://me.sap.com/notes/1922808) explains in section [4](https://me.sap.com/notes/1922808#4) how to ensure that authorized users have all required authorizations and how to activate the checks. Collective maintenance of authorization scenarios is done after system updates using transaction `SACF_COMPARE`.

**For Scenario IHC_PRQ:**

1. **Step 1**: Create the authorization scenario definition in systems where they do not exist yet:
   - Start transaction SACF in the development system and check if scenario definition `IHC_PRQ` exists. If it exists, proceed to step 2.
   - If the scenario definition does not exist in SACF, download the file [IHC_PRQ.txt](https://me.sap.com/notes/0002743329/IHC_PRQ.txt) attached to this note.
   - Start transaction `SACF_TRANSFER`.
   - Select the radio button "Upload", select work area "Scenario Definition", deselect work area "Productive Scenarios", deselect "Test Mode", and execute (F8).
   - Choose the file `IHC_PRQ.txt` and confirm the upload.
   - Assign the scenario definition `IHC_PRQ` to the development package `FIN_IHC`.

2. **Step 2**: Individually activate the switchable authorization checks by creating productive authorization scenarios from scenario definitions in transaction SACF. Refer to [SAP Note 1922808](https://me.sap.com/notes/1922808) for detailed instructions. Collective maintenance of authorization scenarios is done after system updates using transaction `SACF_COMPARE`.

### Message Creation

- Go to transaction `SE91`.
- Check if message numbers 650 and 651 with texts are present for Message Class '1Q'.
  - If not present, follow these steps in `SE91`:
    - **Message Class '1Q', Message number 650**:
      - Click 'Change'.
      - Enter the text: "Missing authorization to execute External RFC (Module: &)"
      - Save and go back.
    - **Message Class '1Q', Message number 651**:
      - Click 'Change'.
      - Enter the text: "Missing authorization for user & to perform activity & (Object &)"
      - Save and go back.
- Check if message numbers 850 and 851 with texts are present for Message Class 'IHC'.
  - If not present, follow these steps in `SE91`:
    - **Message Class 'IHC', Message number 850**:
      - Click 'Change'.
      - Enter the text: "Missing authorization to execute External RFC (Module: &)"
      - Save and go back.
    - **Message Class 'IHC', Message number 851**:
      - Click 'Change'.
      - Enter the text: "Missing authorization for user & to perform activity & (Object &)"
      - Save and go back.

## Support Package

### Software Component Versions and Support Packages

- **S4CORE 102**
  - Support Package: [SAPK-10204INS4CORE](https://me.sap.com/supportpackage/SAPK-10204INS4CORE)
- **S4CORE 103**
  - Support Package: [SAPK-10302INS4CORE](https://me.sap.com/supportpackage/SAPK-10302INS4CORE)

### Correction Instructions

- **Software Component**: S4CORE
- **Number of Correction Instructions**: 2
- **URL**: [Correction Instructions](https://me.sap.com/corrins/0002743329/19773)

## CVSS

**CVSS Score**: 6.3

**CVSS Vector**: `CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L`

- **Attack Vector (AV)**: Network (N)
- **Attack Complexity (AC)**: Low (L)
- **Privileges Required (PR)**: Low (L)
- **User Interaction (UI)**: None (N)
- **Scope (S)**: Unchanged (U)
- **Confidentiality Impact (C)**: Low (L)
- **Integrity Impact (I)**: Low (L)
- **Availability Impact (A)**: Low (L)

## Attachments

- [IHC_PRQ.TXT](https://me.sap.com/notes/0002743329/IHC_PRQ.txt) (2 KB)
- [IHC_PN.TXT](https://me.sap.com/notes/0002743329/IHC_PN.txt) (1.8 KB)

## Validity

### Software Components

- **S4CORE**
  - From: 102
  - To: 102
- **S4CORE**
  - From: 103
  - To: 103
- **S4CORE**
  - From: 104
  - To: 104

## References

This document does not refer to or is referenced by any other SAP Notes or KBAs.

## Rating

This document has not been rated yet.

## Side Effects

This document does not solve or cause any side effects.

---

*Credits: [RedRays.io](https://redrays.io) for supporting the information.*