SAP Security Note 887168 - XSS Protection in BSP Page Directives

```markdown
**SAP Security Note 887168 - XSS Protection in BSP Page Directives**

**Description**
This security note addresses Cross-Site Scripting (XSS) vulnerabilities in SAP BSP (Business Server Pages) applications. XSS attacks can occur when user input is not properly validated and is directly rendered in the HTTP response, allowing malicious scripts to execute in the user's browser.

**Symptom**
Vulnerable code may look like this:

```abap
<%@page language="abap"%>
<html><body><form>
  <% data: x type string.
     x = request->get_form_field( 'x' ).
  %>
  <input type=text name=x value="<%=x%>">
  <input type=submit>
</form></body></html>
```

In this example, input from the HTTP request is used directly in the response without validation, enabling potential XSS attacks.

**Solution**
To mitigate XSS vulnerabilities, it is essential to HTML encode all strings before rendering them. There are two primary approaches:

1. **Manual Encoding:**
   Developers can manually HTML encode user inputs:
   ```abap
   <% data: x type string.
      x = request->get_form_field( 'x' ).
      x = cl_http_utility=>html_encode( x ).
   %>
   <input type=text name=x value="<%=x%>">
   ```

2. **Automated Encoding with Page Attribute:**
   Enhance application security by adding the `forceEncode` attribute in the BSP page directive. This ensures all print statements are automatically HTML encoded:
   ```abap
   <%@page language="abap" forceEncode="html"%>
   <html><body><form>
     <% data: x type string.
        x = request->get_form_field( 'x' ).
     %>
     <input type=text name=x value="<%=x%>">
     <input type=submit>
   </form></body></html>
   ```
   The `forceEncode` attribute can be set to `html`, `url`, or `javascript`, depending on the encoding required.

   **Important:** Do not confuse the print statement encoding with BSP element attribute encoding. For BSP elements, encoding should be handled within the element's domain.

**Additional Information**
- **Affected Components:** BC-BSP (Basis Components > Business Server Pages)
- **Release Status:** Released for Customer
- **Released On:** 08.10.2009
- **Support Packages:** Available for various SAP_BASIS versions. Refer to [Support Package SAPKB62056](https://me.sap.com/supportpackage/SAPKB62056) and others listed in the note.

**References**
- [SAP Note 944279 - BSP Page Directive <%@page forceEncodeOtr="html"%> and <OTR>](https://me.sap.com/notes/944279)
- [SAP Note 891232 - BSP Security Relevant Changes](https://me.sap.com/notes/891232)
- [SAP Note 822881 - XSS Support for BSP-Extensions HTMLB, XHTMLB and PHTMLB](https://me.sap.com/notes/822881)
- [SAP Note 1411659 - Security fixes for SRM SUS, Vendor Evaluation, SRM ROS](https://me.sap.com/notes/1411659)

**Translations**
Available in multiple languages including Japanese, German, Portuguese, Spanish, French, Italian, Russian, Chinese, and Korean. [View Translations](https://me.sap.com/notes/0000887168)

**Attachments**
No attachments available.

**Corrections Info**
There are 3 correction instructions available for SAP_BASIS component. [View Corrections](https://me.sap.com/corrins/0000887168/41)

**Side Effects**
- No known side effects caused or solved by this document.

For more detailed information, visit the [SAP Security Notes](https://me.sap.com/) portal.

*Credits to [redrays.io](https://redrays.io) for support and provided information.*
```