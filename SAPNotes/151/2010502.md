SAP Security Note 2010502 - Missing Authentication in SAP Fiori Launchpad

---

**Title**: 2010502 - Missing Authentication in SAP Fiori Launchpad

**Type**: SAP Security Note  
**Version**: 5  
**Recency**: New  
**Language**: English  
**Category**: Consulting  
**Priority**: Correction with medium priority  
**Status**: Released for Customer  
**Released On**: 18.07.2014  
**Component**: Cross-Application Components > SAP UI Integration > SAP Fiori Launchpad services > Please use CA-FLP-FE-COR  

### Symptom

If a user logs out from SAP Fiori Launchpad, the current browser window may still contain session cookies for some systems.

Any person who has access to the same browser window can access these systems without having to authenticate; this person will use the system security session which had originally been opened for the user.

There is no issue if the user closes all browser windows as session cookies are then removed.

However, in cases where the user does **not** close all browser windows, the solution described below ensures that session cookies of all systems are removed on SAP Fiori Launchpad logout.

### Reason and Prerequisites

SAP Fiori Launchpad allows for accessing systems besides the SAP Fiori Launchpad front-end server, which serves the URL to start the SAP Fiori Launchpad, UI-related resources, as well as the REST and OData services for running SAP Fiori Launchpad.

SAP Fiori Launchpad logout **supports** complete logout for the following systems; in other words, if you integrate only such systems from SAP Fiori Launchpad, you do not need to apply the solution described in this note:

1. SAP Fiori Launchpad front-end server.
2. Enterprise Search system (AS ABAP).
3. Systems used to load remote tile catalogs such as SAP HANA KPI tiles for SAP Smart Business.
4. SAP Lumiraâ„¢ running in SAP Fiori Launchpad (Only from user interface add-on for SAP NetWeaver SP 09. For user interface add-on for SAP NetWeaver SP 08 and earlier, the solution described in this note needs to be applied.).
5. Systems accessed to start Web Dynpro ABAP or SAP GUI for HTML applications in SAP Fiori Launchpad based on report launchpad customizing with specific application types (not plain URL) - either through SAP Web Dispatcher or directly on the system.

SAP Fiori Launchpad logout **does not support** logout for all other cases, especially in the scenarios listed below.  
If you integrate systems for which logout is not supported, you need to apply the solution from this note in order to guarantee proper logout and session termination on these systems.

**Examples of unsupported scenarios:**

1. SAP Gateway systems (hub) that are not installed on the front-end server (other client, server, or system); these are used to connect to ABAP application back ends.
2. SAP HANA or other systems accessed, for example, using REST or OData but **not** used to load remote catalogs (except SAP Lumira from user interface add-on for SAP NetWeaver SP 09).

### Solution

Systems in SAP Fiori Launchpad are accessed using URLs requested from the browser via JavaScript. Thus, the browser's same origin policy applies and requires maintenance of corresponding routing rules on the SAP Web Dispatcher used to access SAP Fiori Launchpad. All systems not supported by SAP Fiori Launchpad logout have in common that there is a routing rule on SAP Web Dispatcher leading to a login to this system and creation of session cookie(s). For the ABAP and SAP HANA platform, all systems support logout by firing logout URL(s).

The solution idea is to do the following:

1. **On SAP Web Dispatcher**: Maintain a logout rule symmetric to the rule causing the system login so that the logout URLs are routed to the correct system.
2. **On the SAP Fiori Launchpad front-end server**: Define a custom "logout page" `logout.html` which ensures all logout URLs are requested. Define the URL to the logout page as the redirect URL of the logoff page for the ICF node `/sap/public/bc/icf/logoff`. Thus, the missing logouts are guaranteed to take place on logout from the front-end server.  
   **Note:** The logout page URL must use SAP Web Dispatcher as origin.

#### 1. Web Dispatcher Logout Rule

For the unsupported scenario "SAP Gateway not on front-end server", a rule leading to a login may look as follows in the SAP Web Dispatcher profile file (`sapwebdisp.pfl`):

```
wdisp/system_<rule number> = SID=<Gateway System ID>, EXTSRV=https://<server host and port>, SRCSRV=*:<Fiori Launchpad port>, SRCURL=/sap/opu/odata/
```

For a corresponding logout rule, it is recommended to use a URL segment parameter to be able to distinguish several systems of the same platform which have the same logout URL:

Add a corresponding modification rule to a file `modification_rule.txt` (example name):

```
if %{PATH} regimatch *;o=<Gateway System ID>* SetHeader x-sap-webdisp-target-sid <Gateway System ID> [break]
```

and add this modification rule file to the `sapwebdisp.pfl` via:

```
icm/HTTP/mod_<number> = PREFIX=/,FILE=modification_rule.txt
```

For the unsupported scenario "SAP HANA system accessed via OData but **not** used to load remote catalogs" both the rule leading to login and the modification rule for logout look quite similar (SAP HANA-specific parts marked **bold**):

```
wdisp/system_<number> = SID=<HANA System ID>, EXTSRV=https://<server host and port>, SRCSRV=*:<Fiori Launchpad port>, SRCURL=/sap/bi/;/sap/hana/;/sap/ui5/;/sap/vi/;/sap/viz/
```

```
if %{PATH} regimatch *;o=<HANA System ID>* SetHeader x-sap-webdisp-target-sid <HANA System ID> [break]
```

#### 2. Custom Logout Page

Create an HTML file `logout.html` as in the example below. You need to adapt the following (see lines marked **bold** in the example below):

1. For each ABAP system to logout from, add a `requestLogout` call with the logout URL matching the rule configured on SAP Web Dispatcher:

   ```javascript
   requestLogout("/sap;o=<ABAP system ID>/public/bc/icf/logoff");
   ```

2. For each HANA system to logout from, call the `requestHanaLogout` with the system ID from the corresponding SAP Web Dispatcher rule as a parameter:

   ```javascript
   requestHanaLogout("<HANA system ID>");
   ```

3. Redirect to the page to be displayed after finishing logout:

   ```javascript
   document.location = "<Page>";
   ```

**Example:**

```html
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <!-- Instead of this, you may include a jQuery version from your internal network if available-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
</head>
<body>
    <em id="message">Logout is in progress...</em>
    <script>
        (function () {
            "use strict";
            /*global document, jQuery*/
            var iPending = 0;

            function finishLogout() {
                iPending -= 1;
                if (iPending <= 0) { //logout done for all URLs
                    //Change message text on logout page
                    document.getElementById("message").innerHTML = "You are logged out";
                    //(3) Client-side redirect
                    document.location = "http://www.sap.com"; //REPLACE with the page to be displayed after finishing logout
                }
            }

            function requestHanaLogout(sSystem) {
                iPending += 1;
                jQuery.ajax({
                    type: "HEAD",
                    url: "/sap;o=" + sSystem + "/hana/xs/formLogin/token.xsjs",
                    headers: {
                        "X-CSRF-Token": "Fetch"
                    },
                }).done(function (oData, oStatus, oXhr) {
                    jQuery.ajax({
                        type: "POST",
                        url: "/sap;o=" + sSystem + "/hana/xs/formLogin/logout.xscfunc",
                        headers: {
                            "X-CSRF-Token": oXhr.getResponseHeader("X-CSRF-Token")
                        }
                    }).always(finishLogout);
                }).fail(finishLogout);
            }

            function requestLogout(sUrl) {
                iPending += 1;
                jQuery.get(sUrl).always(finishLogout);
            }

            // (1) ABAP platform: Add such a line for each system with the corresponding logout URL
            requestLogout("/sap;o=<ABAP system ID>/public/bc/icf/logoff");

            // (2) SAP HANA platform: Add such a line for each system with the system ID from the SAP Web Dispatcher rule
            requestHanaLogout("<HANA system ID>");
        }());
    </script>
</body>
</html>
```

### Links

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000017863552017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0002010502?language=en-US&token=067F0207F8FF6ED68E2E2911611C373C)
- [Share by Email](https://me.sap.com/notes/0002010502/E)
- [Open in New Window](https://me.sap.com/notes/0002010502/E)
- [Show Changes](https://me.sap.com/notes/0002010502/E)

### References

This document is referenced by [SAP Note 2463509](https://me.sap.com/notes/2463509): Sessions of Fiori Launchpad or Web Dynpro/SAP GUI for HTML applications are not deleted after user is logged off from Fiori Launchpad

---

Credits to [https://redrays.io](https://redrays.io) for support in providing this information.