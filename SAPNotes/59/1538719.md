1538719 - Single Sign-On Configuration for SAP (X)MII

## Symptom

Due to security settings in SAP NetWeaver (release 7.0 or CE 7.11), SAP MII users might need to provide credentials every time they want to:
- Open the MII workbench
- Test/execute their JSP, IRPT, HTML pages from within the MII workbench
- Execute MII Query/Display Templates in a new browser window

## Other Terms

MII, XMII, SSO, X.509, SPNego, Authentication, SessionIDRegenerationEnabled, Single Sign-On, Client Certificates, Secure Session Handling, SSH, Kerberos

## Reason and Prerequisites

The SAP NetWeaver `SessionIDRegenerationEnabled` parameter has been activated.

## Solution

Single Sign-On (SSO) should be configured in the SAP NetWeaver AS Java environment to avoid entering credentials. Both SAP NetWeaver AS Java and MII support SPNego (Kerberos) and X.509 certificate-based authentication.

### Configuration Steps for SPNego (Kerberos) SSO

1. **Install SPNego Add-on**
   - A SPNego add-on is required to configure SPNego for NW CE 7.11. Please follow the steps in [SAP Note 1457499](https://me.sap.com/notes/1457499).

2. **Client Configuration for SPNego**

   **For Microsoft Internet Explorer:**
   1. Open Internet Explorer and navigate to **Tools** > **Internet Options** > **Security** tab.
   2. Select the **Local Intranet** icon and click **Sites**.
   3. In the **Local Intranet** window, ensure that the "Include all local (Intranet) sites not listed in other zones" checkbox is selected, then click **Advanced**.
   4. Add the URL of your SAP MII system to the list of Websites. Click **OK** to close the **Local Intranet** window.
   5. Go to the **Advanced** tab in **Internet Options** and scroll to **Security** settings. Ensure that the "Enable Integrated Windows Authentication" box is selected. This requires restarting Internet Explorer.
   6. Click **OK** and restart Internet Explorer to apply the changes.

   **For Firefox (Mozilla):**
   1. Open Firefox.
   2. Type `about:config` in the address bar and press Enter.
   3. In the Filter box, type `network.negotiate-auth.trusted-uris`. Double-click the preference and enter the list of trusted domains, including the Microsoft Active Directory (AD) server host and the Build Forge server host (e.g., `it_directory.mycompany.com` and `it_buildforge.mycompany.com`). Click **OK**.
   4. Double-click `network.negotiate-auth.delegation-uris` and enter the list of sites to which the browser can delegate user authentication.

### Configuration Steps for X.509 Certificate-Based SSO

X.509 client certificates enable users to authenticate without entering a username and password.

1. **Prerequisites**
   - NetWeaver AS Java must be configured to support SSL with the necessary certificates.
   - The root certificates of the client certificate's Certification Authorities (CAs) must exist in a keystore view of the NetWeaver AS Java Key Storage or be available in the file system as a DER-encoded or Base-64-encoded certificate.

2. **Procedure**
   1. **Import Root Certificates**
      - Place the root certificate for each client certificate's CA as a 'CERTIFICATE' entry in the `ICM_SSL_<instance_ID>` view using the **Key Storage Management** feature of the SAP NetWeaver Administrator.
      - If the certificate exists in another Key Storage view, copy it to the corresponding view. Alternatively, import the certificate file to the NetWeaver AS Java Key Storage.

   2. **Configure VCLIENT Parameter**
      - Using the `VCLIENT` profile parameter of ICM for NetWeaver AS Java, decide whether to:
        - Request (but not require) that the user presents a client certificate for authentication.
        - Require that client certificates are used for authentication.

   3. **Configure ClientCertLoginModule**
      - Set up the `ClientCertLoginModule` to establish the NetWeaver AS Java User ID from the client certificate and to filter provided certificates.

   4. **Adjust Login Module Stacks**
      - Configure the login modules for applications that accept client certificates as the authentication mechanism.

   For more detailed instructions on setting up X.509 Single Sign-On, please refer to [SAP Documentation](https://me.sap.com/cw/docs/DOC-111578).

**Download for SNOTE:** [Download](https://notesdownloads.sap.com/note/0040000017147492017)

**PDF Version:** [Download PDF](https://me.sap.com/sap/support/sfm/notes/print/0001538719?language=en-US&token=9CA3236D4425078435945E8DC0DC1B16)

## References

- [SAP Note 1537813 - MII 12.1 SP08](https://me.sap.com/notes/1537813)
- [SAP Note 1457499 - SPNego Add-on](https://me.sap.com/notes/1457499)
- [SAP Note 1310561 - SAP J2EE Engine Session Fixation Protection](https://me.sap.com/notes/1310561)

Credits to [https://redrays.io](https://redrays.io) for support to provided information.