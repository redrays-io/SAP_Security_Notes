SAP Note 400241: Problems with ops$ or sapr3 connect to Oracle

```markdown
**SAP Note 400241 - Problems with ops$ or sapr3 connect to Oracle**

**Type:** SAP Security Note  
**Version:** 54  
**Released On:** 26.01.2010  
**Component:** Basis Components > Database Interface, Database Platforms > Oracle  
**Category:** Help for error analysis  
**Priority:** Correction with low priority  
**Status:** Released for Customer  
**Language:** English (Master Language: German)

### Symptom
Users encounter the following Oracle errors when attempting to connect:
- `ORA-01004: default username feature not supported; logon denied`
- `ORA-01017: invalid username/password; logon denied`
- `ORA-01031: insufficient privileges`
- `ORA-01403: no data found`
- `ORA-00942: table or view does not exist`
- `ORA-00980: synonym translation is no longer valid`

Additionally, messages like:
- `BR301W SQL error -1017 at location BrDbConnect-1`
- `BR310W Connect to database instance <sid> failed`

### Reason and Prerequisites
The issue arises because R/3 work processes and tools like R3trans require connecting to the database using the `sapr3` user. This connection can be established in two ways:

1. **Using OPS$ User:**
   - **1a.** Log on using the OPS$ user (`connect /@<sid>`) to retrieve the `sapr3` password from the `SAPUSER` table.
   - **1b.** Log on as `sapr3` using the retrieved password (`connect sapr3/<password>@<sid>`).

2. **Using Default Password:**
   - If the default password `sap` is still set for `sapr3`, directly log on using `connect sapr3/sap@<sid>`.

The OPS$ mechanism serves as a safety tool to obtain the `sapr3` password securely. Proper configuration of the OPS$ user, including correct naming conventions and permissions, is crucial for successful connections.

### Solution
Follow these steps to resolve connection issues:

1. **Execute SQL Statements:**
   - Run all specified SQL commands as `ora<sid>` (UNIX) or `<sid>adm` (NT) using SQLPLUS with `CONNECT / AS SYSDBA`.

2. **Configure OPS$ User on Windows:**
   - For Oracle 8.1.5 or higher, include the domain name in the OPS$ user (e.g., `OPS$<domain>\<os_user>`).
   - Verify the `USERDOMAIN` environment variable for the correct domain name.

3. **General Checks:**
   - Ensure only one `SAPUSER` table exists, owned by `OPS$<sid>ADM`.
   - On NT systems, verify that `sapservice<sid>` can access the `SAPUSER` table via a synonym.
   - Confirm that environment variables like `dbs_ora_schema` are correctly set if using alternative user setups.

4. **Handle Specific Oracle Errors:**
   - **ORA-01004:** Activate the OPS$ mechanism by setting `REMOTE_OS_AUTHENT = TRUE` in `init<sid>.ora` and restarting the database. On Windows, also set `SQLNET.AUTHENTICATION_SERVICE = (NTS)` in `sqlnet.ora`.
   - **ORA-01017:** Ensure correct setup of the OPS$ user, verify user permissions, and synchronize passwords in the `SAPUSER` table.
   - **ORA-01031, ORA-01403, ORA-00942, ORA-00980:** Follow the detailed error-specific instructions to adjust user permissions, recreate the `SAPUSER` table or synonyms, and ensure correct password entries.

5. **Additional References:**
   - [Note 50088](https://me.sap.com/notes/50088): Creating OPS$ users on Windows NT/Oracle
   - [Note 361641](https://me.sap.com/notes/361641): Creating OPS$ users on UNIX
   - [Note 134592](https://me.sap.com/notes/134592): Import of SAPDBA role

6. **Download and Print:**
   - [Download for SNOTE](https://notesdownloads.sap.com/note/0040000015003522017)
   - [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0000400241?language=en-US&token=6DC5F88E2EB73432D337AE16ADBFC5B9)

### References
This document refers to the following SAP Notes:
- [969519](https://me.sap.com/notes/969519)
- [951167](https://me.sap.com/notes/951167)
- [700548](https://me.sap.com/notes/700548)
- [662644](https://me.sap.com/notes/662644)
- [650796](https://me.sap.com/notes/650796)
- [569302](https://me.sap.com/notes/569302)
- [562863](https://me.sap.com/notes/562863)
- [437648](https://me.sap.com/notes/437648)
- [403004](https://me.sap.com/notes/403004)
- [134592](https://me.sap.com/notes/134592)

### Additional Actions
- Ensure that BR*TOOLS are configured correctly by importing the `SAPDBA` role as per [Note 134592](https://me.sap.com/notes/134592).
- Verify environment settings and user privileges to prevent inconsistency and unauthorized access.

For more detailed instructions and troubleshooting, refer to the [full SAP Note 400241](https://me.sap.com/notes/0000400241).

*Credits to [Redrays](https://redrays.io) for support to provided information.*
```