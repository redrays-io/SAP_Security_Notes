3576540 - Open Source Security Advisory: Best Practices for Securing Spring Boot Actuator Endpoints for applications running on BTP

**Symptom**

Java applications implemented with the Spring Framework are typically running on BTP Cloud Foundry and KYMA environments, in some cases also on the NEO environment.

The [Spring Boot Actuator](https://docs.spring.io/spring-boot/docs/2.5.6/reference/html/actuator.html) is a great way for developers to debug their Spring Boot applications respectively get telemetry data. It enables a number of URL endpoints which provide insights into the running application. While useful for debugging and monitoring applications (including in production), these features pose a security risk if they are accessible without appropriate authentication and authorization.

Improperly secured or publicly exposed Spring Boot Actuator endpoints can lead to potential security risks, including unauthorized access to sensitive application data like environment variables, memory dumps, and internal routing information. These misconfigurations can be exploited by attackers to gain insight into the applicationâ€™s runtime and health information, leading to data leakage or system compromise. It is critical to secure these endpoints to prevent security vulnerabilities such as remote code execution (RCE) or data theft.

Example endpoints that could expose sensitive data:

| Endpoint        | Description                                                          | Severity                                                                          |
|-----------------|----------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| shutdown        | Lets the application be gracefully shutdown.                        | **High:** Remote shutdown of the application                                      |
| env             | Prints environment variables of the application and operating system | **High:** Leaking access tokens which are stored as environment variables         |
| heapdump        | Return a Java heap dump file in hprof format                         | **High:** Access to entire application memory, including secrets, tokens, user data etc. |
| gateway         | Enables monitoring and interaction with a Spring Cloud Gateway application | **High:** Potential remote code execution ([CVE-2022-22947: Spring Cloud Gateway Code Injection Vulnerability](https://www.cve.org/CVERecord?id=CVE-2022-22947)) |
| sbom            | The sbom endpoint provides information about the software bill of materials (SBOM). | **Medium:** An attacker could extract information about vulnerable libraries running on the application |
| health          | Shows the current health of the application                          | **Low** (depending on the information the health endpoint is exposing)           |

An application is affected if all of the following conditions are met:

1. Application is implemented with the Spring Boot Framework  
2. Existing application dependencies for the Spring Boot Starter Actuator ([spring-boot-starter-actuator](https://me.sap.com))  
   - Maven example: `mvn dependency:tree | grep spring-boot-starter-actuator`  
3. Enabled actuator endpoints (application configuration in properties / yaml)  
   - **Remark:** In current versions by default only the "health" endpoint is enabled in Web applications  
4. Missing authentication and authorization for the actuator endpoints  
   - The actuator endpoints are not properly secured. For example, actuator paths are not part of the corresponding Security Configuration class.

It is recommended to check the conditions above with a Java application developer.

Since this is a best practices advisory, there is no **CVSS score (0)** applied to this.

### Other Terms

Security misconfiguration, Spring Boot Actuator, Opensource Security

### Reason and Prerequisites

The issue arises from Spring Boot Actuator endpoints being either left exposed to the public or not secured with proper access control mechanisms, allowing unauthorized access.

### Solution

**Please consider the below mentioned best practices to secure Spring Boot Actuator endpoints:**

1. **Remove the Actuator feature if not Needed**: If Spring Boot Actuator is not essential, remove it from the project dependencies to avoid any unnecessary exposure.
2. **Disable unnecessary Actuator endpoints**: Only endpoints in Spring Boot Actuator which are necessary to run the application should be enabled.
3. **Enable Authentication & Access Control**: Use Spring Security and Role-Based Access Control (RBAC) to restrict access to critical endpoints. (Note: criticality is given by the information the endpoint might expose).
4. **Upgrade Dependencies**: Ensure that all dependencies, including Spring Boot and Actuator, are kept up to date to mitigate known vulnerabilities and improve security.

By securing and reviewing these endpoints, you can reduce the attack surface and minimize the risk of sensitive data exposure.

Credits to [redrays.io](https://redrays.io) for support to provided information.