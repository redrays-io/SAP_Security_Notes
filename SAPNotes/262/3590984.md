3590984 - [CVE-2024-56337] Time-of-check Time-of-use (TOCTOU) Race Condition vulnerability in Apache Tomcat within SAP Commerce Cloud

### Symptom

SAP Commerce Cloud uses versions of Apache Tomcat which contain a TOCTOU Race Condition ([CVE-2024-56337](https://www.cve.org/CVERecord?id=CVE-2024-56337)) vulnerability.

In certain conditions, an unauthenticated attacker could exploit CVE-2024-56337. If successfully exploited, the vulnerability could fully compromise the system's confidentiality, integrity, and availability. However, the success of this exploitation depends on a server setting that remains beyond the attacker's control and **SAP Commerce is not exploitable out of the box**.

### Other Terms

Time-of-check Time-of-use Race Condition, [CVE-2024-56337](https://www.cve.org/CVERecord?id=CVE-2024-56337)

### Reason and Prerequisites

SAP Commerce Cloud is shipped with Apache Tomcat versions which contain the **CVE-2024-56337** vulnerability.

For users running Tomcat on a case-insensitive file system with the default servlet write enabled, additional configuration is required for Java 17. Specifically, the system property `sun.io.useCanonCaches` must be set to `false` (it defaults to `false`).

SAP Commerce Cloud is **not exploitable out of the box** because:

- The Tomcat servlet is readonly by default, as detailed in the [Tomcat Default Servlet Documentation](https://tomcat.apache.org/tomcat-9.0-doc/default-servlet.html).
- There is no `web.xml` in SAP Commerce Cloud that enables writes on any servlets.
- The system property `sun.io.useCanonCaches` is not overwritten in SAP Commerce.

SAP still increases the version of Apache Tomcat via an update to safeguard customers.

### Solution

SAP Commerce Cloud addresses this potential vulnerability by upgrading Apache Tomcat to a version which does not contain the Time-of-check Time-of-use (TOCTOU) Race Condition vulnerability. The following patches contain the improved configuration:

- SAP Commerce Cloud Patch Release 2205.37
- SAP Commerce Cloud Update Release 2211.38

The [Software Downloads](https://me.sap.com/notes/0003590984/S) of these or later patches and update releases are available in the SAP Support Portal:

- [Software Downloads for the customers of SAP Commerce Cloud in the Public Cloud](https://launchpad.support.sap.com/#/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=NEXT&HEADER=Y&FUNCTIONBAR=Y&EVENT=TREE&NE=NAVIGATE&ENR=73555000100800001224&V=MAINT&TA=ACTUAL/SAP%20COMMERCE%20CLOUD%20V2).
- [Software Downloads for the customers who use SAP Commerce on premise](https://launchpad.support.sap.com/#/softwarecenter/template/products/%20_APP=00200682500000001943&_EVENT=DISPHIER&HEADER=Y&FUNCTIONBAR=N&EVENT=TREE&NE=NAVIGATE&ENR=67837800100800007216&V=INST&TA=ACTUAL&PAGE=SEARCH/SAP%20COMMERCE).

For information about installing patches and update releases, see [Update Releases](https://help.sap.com/docs/SAP_COMMERCE_CLOUD_PUBLIC_CLOUD/75d4c3895cb346008545900bffe851ce/cba026d2b36c4ab18f89525df92cc815.html?locale=en-US) and [Patch Releases](https://help.sap.com/docs/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/cba026d2b36c4ab18f89525df92cc815.html?locale=en-US). After installing a SAP Commerce Cloud patch, customers need to re-build and re-deploy the updated SAP Commerce Cloud version.

- Customers of *SAP Commerce Cloud in Public Cloud* should follow these [build](https://help.sap.com/viewer/0fa6bcf4736c46f78c248512391eb467/LATEST/en-US/79763857d2264a189cb577fc90de0fea.html) and [deploy instructions](https://help.sap.com/viewer/0fa6bcf4736c46f78c248512391eb467/LATEST/en-US/72e126a98eb14b668709be9946070e5c.html).
- Customers of *SAP Commerce OnPrem* should follow these [build and deploy instructions](https://help.sap.com/viewer/a74589c3a81a4a95bf51d87258c0ab15/LATEST/en-US/8bb0ad2786691014b930c18dd4cd7851.html).

### Workaround

Workaround is not available.

_Credits: [redrays.io](https://redrays.io) for support to provided information._