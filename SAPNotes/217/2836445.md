2836445 - [CVE-2020-6183] Unprivileged Access to Technical Data Using SAPOSCOL of SAP Host Agent

**Description**

### Symptom
The SAP Oscollector allows an unauthenticated attacker to query the background service that would otherwise be restricted to authorized users. The SAP Oscollector, typically exposed only internally, can be attacked from within the network. Exploiting this vulnerability allows the attacker to obtain statistics such as CPU, RAM, directory size, and more. Additionally, the attacker may be able to stop the collection process, affecting the service's availability. If the attacker lacks access to the SAPOSCOL binary, they could copy it to their home folder and perform the attack.

### Other Terms
- Unprivileged read
- Shared memory
- Permissions
- [CVE-2020-6183](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-6183)

### Reason and Prerequisites
A malicious user can run SAPOSCOL and read data stored in the SAPOSCOL process. The SAPOSCOL process on Linux and Unix-like operating systems runs under the root user and creates shared memory to inform other processes about system information. The shared memory is public with read/write permissions for anyone.

If an unprivileged user downloads the SAPOSCOL binary from official SAP repositories or creates their own program, they can read or write to the shared memory by sending requests to the main SAPOSCOL process and receiving responses containing data with root privileges (e.g., directory sizes).

**Solution**

This correction ensures that the shared memory is created with read/write permissions only for the root user or users in the "sapsys" group, restricting access to the SAPOSCOL main process to those users.

- **For Linux:**
  - The solution is enabled by default. If there are negative impacts, you can disable it by adding the profile parameter `ipc/shm_permission_1002 = 0777` to the HostAgent profile `/usr/sap/hostctrl/exe/host_profile`.

- **For Unix:**
  - The solution is disabled by default to avoid impacting other consumers. Enable it by adding the profile parameter `ipc/shm_permission_1002 = 0770` to the HostAgent profile `/usr/sap/hostctrl/exe/host_profile` and as the profile parameter of work processes.

The functionality is available with the version of SAP Host Agent mentioned in this SAP Security Note.

**CVSS**

- **Score:** 5.3
- **Vector:** [CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L](https://www.first.org/cvss/v3.0/specification-document)

  | Key                        | Value                     |
  |----------------------------|---------------------------|
  | Attack Vector (AV)         | Local (L)                 |
  | Attack Complexity (AC)     | Low (L)                   |
  | Privileges Required (PR)   | Low (L)                   |
  | User Interaction (UI)      | None (N)                  |
  | Scope (S)                  | Unchanged (U)             |
  | Confidentiality Impact (C) | Low (L)                   |
  | Integrity Impact (I)       | Low (L)                   |
  | Availability Impact (A)    | Low (L)                   |

**References**
- [SAP Note 2836445](https://me.sap.com/notes/0002836445)

**Validity**
- **Software Component:** SAP Host Agent
- **From Version:** 7.21
- **To Version:** 7.21

**Support Package Patches**
- **SAP Host Agent 7.21 SP045 000045:** [Download](https://me.sap.com/sap/support/swdc/notes?cvnr=67838200100200018473&support_package=SP045&patch_level=000045)

**References by Other Documents**
- [SAP Note 3042761](https://me.sap.com/notes/3042761) - ST06 error "Timeliness check of snapshot data not possible (no collector timestamp)" for Application Server

**Credits**
Information provided with support from [Redrays.io](https://redrays.io).