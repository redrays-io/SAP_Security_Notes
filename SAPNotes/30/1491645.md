1491645 - Unauthenticated system access via RFC or HTTP

**Symptom**

"This Security Note has been updated. For more detailed information, see Security Note 1605516."

Under certain conditions, an RFC or HTTP connection to an SAP system might be established even though incomplete authentication information is passed.

**Reason and Prerequisites**

Under specific conditions, it is possible to execute RFC or HTTP calls without successfully authenticating to the receiver system.

**Solution**

To resolve this issue, apply the following measures within your ABAP systems:

1. **Apply Kernel Patches and ABAP Corrections**
   - **Kernel Patches:** Ensure your system's kernel is patched to versions **higher or equal** to those mentioned under the 'SP Patch Level' tab.
   - **ABAP Corrections:** Apply the ABAP corrections attached to this note. Both kernel patches and ABAP corrections must be applied to all application servers to ensure all internal RFC and HTTP communications operate securely.

   **Download Links:**
   - [Download for SNOTE](https://me.sap.com/notes/0040000008827692017)
   - [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0001491645?language=en-US&token=7EB9B9500EB107DBB6186A20BC2B863C)

2. **Update External Trust Relations**
   - **Patch Both Systems:** Ensure that both the trusting and trusted systems have the necessary kernel and ABAP patches applied.
   - **Recreate Trust Relations:** Use transaction `SMT1` to delete existing trust relations and recreate them. This ensures they operate with the enhanced security level.
   - **Analyze Trust Relations:** Refer to [SAP Note 1498973](https://me.sap.com/notes/1498973) for an analysis report and update report to upgrade existing trust relations.

**Manual Activities**

- **Release 46C (SAP_BASIS)**
  - Perform manual corrections as outlined in the attached PowerPoint files:
    1. [NEW_DATA_EL_46C.ppt](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000373372010&iv_version=0011&iv_guid=507C904A4D5497448717F5F0BD481FC9)
    2. [NEW_FM_46C.ppt](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000373372010&iv_version=0011&iv_guid=6F4B6396D77E3545A3404F383088F170)

- **Release 620 (SAP_BASIS)**
  - Create the function module `RFC_ACCESS_TRUSTED_SEC_KEY` in the function group `QRFC`. Refer to [NEW_FM_620.ppt](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000373372010&iv_version=0011&iv_guid=33A7B4D33672CF4D84B8541C169DB3F4).

**Attachments**

- [NEW_DATA_EL_46C.ppt](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000373372010&iv_version=0011&iv_guid=507C904A4D5497448717F5F0BD481FC9) (1147 KB)
- [NEW_FM_46C.ppt](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000373372010&iv_version=0011&iv_guid=6F4B6396D77E3545A3404F383088F170) (1445 KB)
- [NEW_FM_620.ppt](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000373372010&iv_version=0011&iv_guid=33A7B4D33672CF4D84B8541C169DB3F4) (575 KB)

**References**

- [Update #1 to Security Note 1491645](https://me.sap.com/notes/1605516)
- [Deleting SECSTORE entries during system export/system copy](https://me.sap.com/notes/1532825)
- [Problem with trust relationship after using HMAC](https://me.sap.com/notes/1579570)
- [RFC failure during upgrade when using HMAC](https://me.sap.com/notes/1523313)

**Preconditions**

Ensure the following SAP Notes and Components are considered before applying the patches:

- [Unauthenticated system access via RFC or HTTP](https://me.sap.com/notes/1491645)
- [HTTP Client: special proxy configuration is ignored](https://me.sap.com/notes/961732)
- [Passport processing in Internet Communication Framework](https://me.sap.com/notes/981557)
- [HTTP client: Avoiding memory leaks](https://me.sap.com/notes/998479)
- [Problem with FQHN as message server host name in SMT2](https://me.sap.com/notes/1415150)
- [Downporting the function group SECSTORE_REMOTE to 7.0x](https://me.sap.com/notes/1393375)
- [Error if redirect from HTTP protocol to HTTPS](https://me.sap.com/notes/1426409)

**Support Package Information**

Refer to the [Support Package](https://me.sap.com/supportpackage/SAPKB46C62) section for applicable patches based on your SAP_BASIS version.

**Credits**

Information provided with support from [redrays.io](https://redrays.io).