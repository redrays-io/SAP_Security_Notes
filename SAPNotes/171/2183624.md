SAP Security Note 2183624 - Potential Information Leakage Using Default SSFS Master Key in HANA

**SAP Security Note 2183624 - Potential Information Leakage Using Default SSFS Master Key in HANA**

*Released On:* August 5, 2015

---

### **Symptom**
Using the initial **Secure Store in the File System (SSFS)** master key for your SAP HANA database installation can lead to potential information leakage. By default, this master key may be the same across all HANA installations unless explicitly changed, posing a security risk if unauthorized users gain file system access.

### **Reason and Prerequisites**
If you utilize SAP HANA's database encryption features, such as **data volume encryption** or internal data encryption services, HANA stores cryptographic keys in the SSFS on the file system. The SSFS master key is protected by operating system permissions, requiring access by the `<sid>adm` user. 

**Important:** Prior to revisions **85.05 for SPS08**, **97.1 for SPS09**, and **101 for SPS10**, the SSFS master key defaults to the initial key across installations, increasing the risk of information leakage.

### **Solution**
SAP recommends generating an individual SSFS master key for your system either after installation or by obtaining a HANA pre-installed system from a hardware vendor. You can achieve this by:

1. **Upgrading to a Respective Revision:**
   - This method automatically sets an individual key during installation or update.
   - **Recommended Revisions:**
     - **Rev. 85.05** for SPS08
     - **Rev. 97.1** for SPS09
     - **Rev. 101** for SPS10

2. **Explicitly Changing the SSFS Master Key:**
   - Follow the detailed key change procedure outlined below.

**Detailed Key Change Procedure:**

1. **Log In:**
   - Log on to the SAP HANA system host as the operating system user `<sid>adm`.

2. **Shut Down the System:**
   - Use the `sapcontrol` program:
     ```bash
     /usr/sap/hostctrl/exe/sapcontrol -nr <instance_no> -function Stop
     ```

3. **Generate a New Master Key and Re-encrypt SSFS:**
   - Use the `rsecssfx` program:
     ```bash
     RSEC_SSFS_DATAPATH=/usr/sap/<SID>/SYS/global/hdb/security/ssfs 
     RSEC_SSFS_KEYPATH=<directory_of_key_file> 
     rsecssfx changekey $(rsecssfx generatekey -getPlainValueToConsole)
     ```

4. **Configure the Key File Location:**
   - Edit the `global.ini` file located at `/usr/sap/<sid>/SYS/global/hdb/custom/config/global.ini`.
   - Add the following lines:
     ```
     [cryptography]
     ssfs_key_file_path = <directory_of_key_file>
     ```

5. **Restart SAP HANA:**
   - Restart the system to apply changes.

**Notes:**
- **Downtime Required:** Changing the SSFS master key requires system downtime.
- **Distributed Systems:** Ensure every host can access the key file location.
- **Multitenant Database Containers (MDC):** Change the SSFS master key for the entire instance, not per tenant.

For system replication setups, refer to [SAP Note 2194396](https://me.sap.com/notes/2194396).

### **References**
- [View SAP Security Note 2183624](https://me.sap.com/notes/2183624)
- [Additional Related Notes](https://me.sap.com/notes/2183624#references)

---

**Credits:** Supported by [redrays.io](https://redrays.io).