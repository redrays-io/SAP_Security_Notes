1503236 - Application configuration due to J2EE security settings

## Symptom

You aim to enhance the security of your web applications by activating the security settings of SAP J2EE. However, enabling these settings can lead to issues with certain Web Channel applications or functions. This SAP Security Note provides the necessary configuration settings to address these problems.

## Reason

New security settings were introduced for the NetWeaver Application Server Java (SAP J2EE) to increase the security of web applications. These settings include:

- **SessionIdRegeneration**
- **SystemCookiesDataProtection**
- **SystemCookiesHTTPSProtection**
- **SecuritySessionIDHTTPSProtection**

These enhancements help protect session data and secure cookies but require appropriate application configurations to function correctly.

## Prerequisites

Ensure you have the following before applying the solutions:

- Appropriate Support Packages for CRM releases.
- Implementation of Notes [1492234](https://me.sap.com/notes/1492234), [1501922](https://me.sap.com/notes/1501922), or [1501919](https://me.sap.com/notes/1501919).

## Solution

To support security sessions in Web Channel applications, authentication must be carried out using the User Management Engine (UME) logon application of J2EE. Depending on your application scenario (B2B or B2C), follow the respective configuration steps below.

### 1. B2B Scenario Applications (e.g., E-Commerce B2B, E-Service B2B, Business-on-Behalf)

**J2EE Security Settings:**
- `SessionIdRegenerationEnabled = true`
- `SystemCookiesDataProtection = true`
- `SystemCookiesHTTPSProtection = true`

**Extended Configuration Management (XCM) Settings:**
- `SSLEnabled = true`  
  This redirects to HTTPS when the login function is called.
- Configure UME authentication to enable session ID regeneration.

### 2. B2C Scenario Applications (e.g., E-Commerce B2C, E-Service B2C, Collaborative Show Room)

**J2EE Security Settings:**
- `SessionIdRegenerationEnabled = true`
- `SystemCookiesDataProtection = true`
- `SecuritySessionIDHTTPSProtection = true`
- `SystemCookiesHTTPSProtection = false`  
  This allows initiating requests with HTTP and switching to HTTPS during checkout.

**Extended Configuration Management (XCM) Settings:**
- `SSLEnabled = true`
- `SSLSwitchEnabled = false`  
  Configure these settings in `General Application Settings -> Customer -> b2c -> b2cconfig`.

**Basket Recovery Configuration:**
- `ReInvokeEnabled = true`
- In the application configuration, choose the "Javabasket" basket type.
- Activate:
  - `usedatabaseBasket = true`
  - `basketRecoveryForUnknwonUser = true`  
    This ensures the shopping basket is saved and recoverable even if the user is not logged in.

## References

- [SAP Note 1777016](https://me.sap.com/notes/1777016) - Additional XSRF Protection switch in the XCM
- [SAP Note 1548767](https://me.sap.com/notes/1548767) - Unauthorized use of functions in CRM Web Channel
- [SAP Note 1501922](https://me.sap.com/notes/1501922) - The recall of the B2C application does not work
- [SAP Note 1501919](https://me.sap.com/notes/1501919) - Start.jsp enhancements
- [SAP Note 1492234](https://me.sap.com/notes/1492234) - No SessionIDRegeneration in CRM Web Channel B2C/B2B Scenario
- [SAP Note 1310561](https://me.sap.com/notes/1310561) - SAP J2EE Engine Session Fixation Protection
- [SAP Note 894446](https://me.sap.com/notes/894446) - ECO: Using UME logon application in SAP E-Commerce

## Download

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000017227572017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001503236?language=en-US&token=FB3D1FCF075ECF4B11C5752A3ADA0FB8)

---

*Credits to [redrays.io](https://redrays.io) for support in providing this information.*