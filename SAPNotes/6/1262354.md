SAP Security Note 1262354: SAP E-Sourcing Ethical Security Hack: Cross-Site Framing

**Symptom**

SAP E-Sourcing customers using Microsoft® Internet Explorer may be vulnerable to a cross-site framing attack due to an access validation error. Cross-site framing occurs when other sites embed the SAP E-Sourcing application within a frame, potentially allowing phishing or spoofing attacks that can steal user data.

**Other Terms**

- Friendly Embedding Domain URL Pattern
- JavaScript regular expressions

**Reason and Prerequisites**

To exploit the cross-site framing vulnerability, the following conditions must be met:

1. A user navigates to a malicious site that embeds the SAP E-Sourcing application within a frame. This can happen by following a link or visiting a spoofed site.
2. The user is using Microsoft Internet Explorer.

The vulnerability is limited to keyboard events, where malicious JavaScript can capture keystrokes and send them to an attacker.

**Solution**

**Introduction**

This security issue is related to the use of SAP E-Sourcing with Microsoft Internet Explorer. Additionally, some customers may need to embed SAP E-Sourcing into another website, such as an enterprise portal. This security fix addresses both scenarios.

A new configurable property, `system.friendlyEmbeddingDomains`, has been introduced to control which internet domains (e.g., `*.mytrusteddomain.com`) are considered "friendly" for embedding SAP E-Sourcing. If the top-level URL matches a friendly domain, SAP E-Sourcing continues to function normally. Otherwise, it reloads in the browser's top frame, removing any wrapping frames.

**Property Description**

- **Property Name:** `system.friendlyEmbeddingDomains`
- **Availability:** Not available by default. Must be configured by a system or enterprise administrator.

**Configuration Steps:**

1. Navigate to **Setup → Configuration → System Properties**.
2. Click **Create** to add the new property `system.friendlyEmbeddingDomains` under the System Category.

**Setting the Property Value**

The value should be a JavaScript regular expression that matches the host names of trusted embedding domains. Examples:

- To allow only `ides.sap.com`:
  ```
  ^ides\.sap\.com$
  ```

- To allow multiple specific domains:
  ```
  (^ides\.sap\.com$)|(ides\.sap-ag\.de$)
  ```

- To allow all subdomains of `sap.com`:
  ```
  \.sap\.com$
  ```

**New Behavior Based on `system.friendlyEmbeddingDomains`**

- **If the embedding domain matches the regular expression:** SAP E-Sourcing operates in embedded mode.
- **If the embedding domain does not match:** SAP E-Sourcing reloads in the browser's top frame without any wrapping frames.

**Additional Resources**

- [Microsoft JavaScript Regular Expressions](http://msdn.microsoft.com/en-us/library/1400241x(VS.85).aspx)
- [Mozilla JavaScript Regular Expressions](http://developer.mozilla.org/En/Core_JavaScript_1.5_Reference:Global_Objects:RegExp)

**Download and Documentation**

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000016912982017)
- [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0001262354?language=en-US&token=FA4A2A9DACDE0224E9F293A50B847987)

For more details, visit the [SAP Support Portal](https://me.sap.com/).

*Credits to [Redrays.io](https://redrays.io) for support in providing this information.*