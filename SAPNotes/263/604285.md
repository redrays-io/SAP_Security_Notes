604285 - J2EE: Security vulnerability by unprotected HTTP PUT method

**SAP Security Note 604285**

**Description**

**Symptom**
- By default, there are no restrictions for the HTTP PUT method.
- Authentication is not required to upload a file.

**Reason and Prerequisites**
- The HTTP PUT method handler in the SAP J2EE Engine Release 6.20 is unprotected by default.
- This allows file upload operations without requiring user authentication or authorization.
- Potential risks include filling up the server's file system or uploading and executing malicious programs, rendering the server unavailable.

**Solution**

**1. Procedure for J2EE 6.20 SP1 - SP10**
- **Restrict the HTTP PUT method** in each web application deployed on your SAP J2EE Engine.
- **Steps:**
  1. Update the `web.xml` file of each application with the following security constraints:

     ```xml
     <security-constraint>
         <web-resource-collection>
             <web-resource-name>Protected Area</web-resource-name>
             <http-method>PUT</http-method>
             <url-pattern>/*</url-pattern>
         </web-resource-collection>
         <auth-constraint>
             <role-name>$SAP_J2EE_Engine_default_put_role</role-name>
         </auth-constraint>
     </security-constraint>
     <login-config>
         <auth-method>BASIC</auth-method>
         <realm-name>Upload Protection</realm-name>
     </login-config>
     <security-role>
         <role-name>$SAP_J2EE_Engine_default_put_role</role-name>
     </security-role>
     ```

  2. Edit the `web.xml` file within the EAR file of your application.
  3. Update or redeploy the application using the deploy interface.
  - **Note:** Only changes in the `web.xml` file will be applied. Other modifications on the local disk remain unaffected.

**2. J2EE 6.20 SP11**
- **Global Protection of the PUT Method:**
  - Modify the `global-web.xml` file located at `cluster\server\services\servlet_jsp\global-web.xml`.
  - Uncomment and activate the security constraint tags as shown below:

    ```xml
    <security-constraint>
        <web-resource-collection>
            <web-resource-name>Protected Area</web-resource-name>
            <http-method>PUT</http-method>
            <url-pattern>/*</url-pattern>
        </web-resource-collection>
        <auth-constraint>
            <role-name>$SAP_J2EE_Engine_default_put_role</role-name>
        </auth-constraint>
    </security-constraint>
    <login-config>
        <auth-method>BASIC</auth-method>
        <realm-name>Upload Protection</realm-name>
    </login-config>
    <security-role>
        <role-name>$SAP_J2EE_Engine_default_put_role</role-name>
    </security-role>
    ```

  - Restart the applications to apply the changes.
  - **Optional:** For applications without a `login-config` in their `web.xml`, add the following:

    ```xml
    <login-config>
        <auth-method>BASIC</auth-method>
        <realm-name>Upload Protection</realm-name>
    </login-config>
    ```

**3. J2EE 6.20 SP12 and Newer**
- **Default Behavior:**
  - The HTTP PUT implementation is disabled by default.
  - If enabled via the `HttpPutEnabled` property, ensure to protect it as described for SP11.
- **Steps to Enable PUT Implementation:**
  1. Set the `HttpPutEnabled` property to `true` in the HTTP service settings.
  2. Apply the security constraints as outlined in the SP11 solution.

**4. J2EE 6.30**
- The HTTP PUT implementation has a different approach. Refer to the official [SAP documentation](https://me.sap.com/notes/604285) for detailed instructions.

**References**
- [SAP Note 606733 - SAP J2EE - Composite SAP Note on Security of Basis 6.20](https://me.sap.com/notes/606733)
- [SAP Note 602194 - SAP FSCM - Biller Direct: Stopping PUT Requests](https://me.sap.com/notes/602194)

**Available Translations**
- Various languages available. [View Translations](https://me.sap.com/notes/604285/D)

**Attachments**
- No attachments available.

**Download Links**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000015417252017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0000604285?language=en-US&token=761626A51F50E75CBD9A877E59B8324C)

*Credits: Information supported by [RedRays.io](https://redrays.io)*