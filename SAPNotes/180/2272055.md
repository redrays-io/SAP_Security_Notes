2272055 - Switchable authorization checks for RFC in Conditions Master Data

**Symptom**

This SAP note describes new switchable authorization checks for RFC function modules in Conditions Master Data external interface.

**Other Terms**

SACF, RFC, authorization, Conditions Master data.

**Reason and Prerequisites**

Remote calls to RFC function modules are protected by checks on the authorization object `S_RFC`. Authorizations for `S_RFC` must be limited to the required minimum authorizations for all users to ensure system security. Many RFC function modules can be sufficiently protected using `S_RFC` authorization checks. These RFC function modules often do not perform additional functional authorization checks. Please see [SAP note 2008727](https://me.sap.com/notes/2008727) for further information on RFC Security.

It was identified that `S_RFC` authorization checks might not be sufficient to ensure secure execution for RFC function modules covered by this note. Activate new switchable authorization checks and update corresponding roles if these RFC function modules are included in `S_RFC` authorizations in your system.

**Solution**

New switchable authorization checks have been implemented. The checks are delivered inactive to ensure compatibility with your running processes. The checks can be activated in transaction SACF as described in the attached manual correction instruction. See [note 1922808](https://me.sap.com/notes/1922808) for additional information on the switchable authorization check framework (SACF).

**New authorization scenario(s)**

The following new authorization scenario can be maintained in transaction SACF after implementation of this SAP note:

| Scenario           | Description                                   |
|--------------------|-----------------------------------------------|
| CRM_COND_XIF       | Authorization check for Conditions XIF RFC Modules |

The authorization object `/SAPCND/CM` is used to check the proper authorization of the user for the respective functions.

**Affected RFC function modules**

| Scenario      | Function module                 | Auth. object | Param1   | Param2 | Param3 |
|---------------|---------------------------------|--------------|----------|--------|--------|
| CRM_COND_XIF  | CRMXIF_COND_REC_COMPL_SAVE       | /SAPCND/CM   | ACVTC=02 |        |        |
| CRM_COND_XIF  | CRMXIF_CONDITION_RECORD_SAVE     | /SAPCND/CM   | ACVTC=02 |        |        |
| CRM_COND_XIF  | CRMXIF_CONDITION_SCALE_SAVE      | /SAPCND/CM   | ACVTC=02 |        |        |
| CRM_COND_XIF  | CRMXIF_CONDITION_SEL_DELETE      | /SAPCND/CM   | ACVTC=02 |        |        |
| CRM_COND_XIF  | CRMXIF_COND_REC_SLIM_SAVE        | /SAPCND/CM   | ACVTC=02 |        |        |

**Implementation of the switchable authorization check**

The switchable authorization scenario and the switchable authorization checks are provided via a support package. They can be technically pre-implemented via the correction instructions below. After technical implementation via support package or correction instructions, the checks remain inactive until manual activation.

**Activation of the switchable authorization check**

Follow the post-processing activities below after technical implementation to activate the authorization checks.

1. **Create the authorization scenario definition in older support packages (transported in your landscape):**
   - Start transaction SACF and check if scenario definition `CRM_COND_XIF` exists. If it exists, go to step 2.
   - If the scenario definition does not exist in SACF, download the file `CRM_COND_XIF.txt` attached to this note.
   - Start transaction `SACF_TRANSFER`.
   - Select the radio button "Upload", select work area "Scenario Definition", deselect work area "Productive Scenarios", deselect "Test Mode", and execute (F8).
   - Choose the file `CRM_COND_XIF.txt` and confirm the upload.
   - Assign the scenario definition `CRM_COND_XIF.txt` to development package `CRMXIF_CONDITION_TECHNIQUE`.

2. **Create the productive authorization scenario from the scenario definition (transported in your landscape):**
   - Start transaction SACF, select "Scenario Definition", select the "Scenario Name" described above, and execute (F8).
   - Double-click on the scenario definition and press the button "Scenario" (or press F5) to transfer the scenario definition to a productive scenario.
   - Choose the initial scenario status "Active" or "Logging".
     - **Active:** Activates the authorization check and logging to Security Audit Log.
     - **Logging:** Activates logging to Security Audit Log. The authorization check will always pass, allowing you to identify users that require the authorizations being checked.
   - Use report `RSAU_SELECT_EVENTS` to identify users that require authorizations due to the authorization scenario. Analyze message IDs DUO and DUP.

3. **Activate logging of SACF relevant audit messages in the Security Audit Log (not transported, configuration required in all systems of your landscape):**
   - Ensure that Security Audit Log is activated in transaction SM19, tab "Kernel Parameters".
   - Activate the following message IDs in a static Security Audit Log configuration:
     - DUO (Authorization check on object &A in scenario &B successful)
     - DUP (Authorization check on object &A in scenario &B failed)
     - DUQ (Active scenario &A for switchable authorization check was changed - &B)

4. **Adjust your roles to provide those users with the authorizations that require them due to the new authorization scenario.**
   - Use report `RSAU_SELECT_EVENTS` to identify users that require authorizations due to the authorization scenario.
   - Authorization checks for productive authorization scenarios with status "Active" or "Logging" can also be analyzed using the system trace for authorizations (transactions STAUTHTRACE or ST01).

**Attachments**

- [CRM_COND_XIF.TXT](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000240962016&iv_version=0001&iv_guid=6CAE8B28C50B1EE683B8113E950FCC05) (472 KB)

**References**

- [SAP Note 2236076](https://me.sap.com/notes/2236076) - Architectural change to avoid syntax errors when calling CL_RFC=>CHECK_EXTERNAL and CL_SACF=>AUTH_CHECK_SPEC

**Validity**

Applicable to the following software component versions:

- BBPCRM 700
- BBPCRM 701
- BBPCRM 702
- BBPCRM 712
- BBPCRM 713
- BBPCRM 714

**Support Packages**

Refer to the respective support package URLs for your BBPCRM version:

- [SAPKU70018](https://me.sap.com/supportpackage/SAPKU70018) for BBPCRM 700
- [SAPKU70115](https://me.sap.com/supportpackage/SAPKU70115) for BBPCRM 701
- [SAPKU70217](https://me.sap.com/supportpackage/SAPKU70217) for BBPCRM 702
- [SAPKU71210](https://me.sap.com/supportpackage/SAPKU71210) for BBPCRM 712
- [SAPKU71312](https://me.sap.com/supportpackage/SAPKU71312) for BBPCRM 713
- [SAPK-71402INBBPCRM](https://me.sap.com/supportpackage/SAPK-71402INBBPCRM) for BBPCRM 714

**Correction Instructions**

- Number of Correction Instructions: 5
- [Correction Instructions URL](https://me.sap.com/corrins/0002272055/63)

**Preconditions**

Requires SAP Note 2236076 to be applied for the following BBPCRM releases:

- 700
- 701
- 702
- 713

**Credits**

Credits to [Red Rays](https://redrays.io) for support in providing this information.