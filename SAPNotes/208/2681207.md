2681207 - [CVE-2018-2465] Missing XML Validation Vulnerability in SAP HANA Extended Application Services Classic Model

**Symptom**

**UPDATE 20 September 2018**: This note has been re-released with updated *Reason and Prerequisites* and *Solution* information.

SAP HANA, Extended Application Services classic model OData parser does not sufficiently validate XML. By exploiting this vulnerability, an unauthorized hacker can cause the database server to crash.

**CVSS Information**

- **CVSS v3 Base Score**: 7.5 / 10
- **CVSS v3 Base Vector**:
  - **Attack Vector (AV)**: Network (N)
  - **Attack Complexity (AC)**: Low (L)
  - **Privileges Required (PR)**: None (N)
  - **User Interaction (UI)**: None (N)
  - **Scope (S)**: Unchanged (U)
  - **Confidentiality Impact (C)**: None (N)
  - **Integrity Impact (I)**: None (N)
  - **Availability Impact (A)**: High (H)

SAP provides this CVSS v3 base score as an estimate of the risk posed by the issue reported in this note. This estimate does not take into account your own system configuration or operational environment. It is not intended to replace any risk assessments you are advised to conduct when deciding on the applicability or priority of this SAP security note. For more information, see the FAQ section at [SAP Security Notes](https://me.sap.com/support/sfm/notes).

**Other Terms**

SAP HANA, XS engine, XS classic, XSC, OData, [CVE-2018-2465](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-2465)

**Reason and Prerequisites**

The vulnerability can be exploited if applications using OData services are enabled on Extended Application Services classic model. This affects:

- Applications which are part of the SAP HANA shipment (like the SAP HANA user self-service tool, which is not enabled by default),
- Additional applications by SAP or other vendors,
- Any customer-built application.

If authentication is not enforced for an enabled application using OData, an anonymous attacker can exploit the vulnerability. The attacker needs network access to the HTTP/HTTPS port of the SAP HANA database XS engine classic model.

**Solution**

The vulnerability has been fixed with:

- Revision 122.13 for SAP HANA 1.00 SPS 12,
- Revision 12.02 for SAP HANA 2.0 SPS 1,
- Revision 22 for SAP HANA 2.0 SPS 2.

SAP HANA 2.0 SPS 3 is not affected. Update to these or later versions.

If an immediate update is not possible, reduce the attack surface by:

1. Limiting network access to the Extended Application Services classic model to trustworthy users.
2. Enforcing authentication to applications using OData services via Extended Application Services classic model and restricting access to trustworthy users.

**Identifying Vulnerable Packages**

Use the following query to identify OData packages without enforced authentication:

```sql
SELECT DISTINCT T1.PACKAGE_ID
FROM (
    SELECT * FROM "_SYS_REPO"."ACTIVE_OBJECT" WHERE OBJECT_SUFFIX = 'xsodata'
) AS T1
INNER JOIN (
    SELECT * FROM "_SYS_REPO"."ACTIVE_OBJECT" 
    WHERE OBJECT_SUFFIX LIKE 'xsaccess' 
    AND (CDATA LIKE '%"authentication": null%' OR CDATA LIKE '%"authentication":null%')
) AS T2
ON LEFT(T1.PACKAGE_ID, LENGTH(T2.PACKAGE_ID)) = T2.PACKAGE_ID;
```

**Additional Protection Measures**

Packages reported by this query might be protected from anonymous access by other means, such as:

- Deactivation,
- Authentication enforcement on a lower-level package,
- Applications not being explicitly exposed.

By default, the following OData services are protected by these other means: `sap.hana.xs.formLogin.profile`, `sap.hana.xs.selfService.user.db`.

**References**

- [Download for SNOTE](https://me.sap.com/notes/0040000001779512018)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0002681207?language=en-US&token=8E765C5FCC92CBC1AD21C8432BED914F)
- [Edit Note](https://me.sap.com/sap/support/notes/edit/0002681207)
- [Show Changes](https://me.sap.com/notesLatestChanges/0002681207/E/diff)

**Credits**

Thanks to [Redrays.io](https://redrays.io) for support in providing this information.