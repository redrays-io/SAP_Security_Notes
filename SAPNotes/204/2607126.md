SAP Security Note 2607126 - Cross-Site Request Forgery vulnerability in Enterprise Services Repository of SAP Process Integration

**Description**

**Symptom**
Enterprise Services Repository of SAP Process Integration (PI) allows an attacker to trick an authenticated user into sending an unintended request to the web server. This vulnerability is due to insufficient CSRF protection.

**Impacts of CSRF Vulnerabilities:**
- Attacker could take actions on behalf of an authenticated user
- Loss of non-repudiation

**Other Terms**
- Open redirect
- Cross-site redirect
- Cross-domain redirect
- XSRF
- Session riding
- SAP Process Orchestration (PO)
- SAP Process Integration (PI)
- Enterprise Services Repository (ESR)
- HTTP Method Invocation (HMI)

**Reason and Prerequisites**
The vulnerability exists because of missing CSRF protection in the HMI layer.

**Solution**
An appropriate CSRF protection has been implemented with the Support Packages and Patches referenced in this SAP Security Note.

**CVSS Score**
- **Score:** 6.3
- **Vector:** CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:L

**Affected Software Components and Versions**
- **MESSAGING**: 7.31, 7.40, 7.50
- **SAP_XIESR**: 7.31, 7.40, 7.50
- **SAP_XITOOL**: 7.31, 7.40, 7.50
- **SAP_XIAF**: 7.31, 7.40, 7.50
- **SAP_XIGUILIB**: 7.31, 7.40, 7.50
- **FRAMEWORK**: 7.31, 7.40, 7.50

**Support Package Patches**
- **XI ADAPTER FRAMEWORK 7.50**
  - [SP018 Patch 000005](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73554900100200001663&support_package=SP018&patch_level=000005)
  - [SP019 Patch 000000](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73554900100200001663&support_package=SP019&patch_level=000000)
  - [SP020 Patch 000000](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73554900100200001663&support_package=SP020&patch_level=000000)
- **JAVA FRAMEWORK OFFLINE 7.50**
  - [SP018 Patch 000001](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73554900100200001591&support_package=SP018&patch_level=000001)
  - ... *(additional patches can be listed similarly)*

For a complete list of support package patches, visit the [SAP Support Portal](https://me.sap.com/notes/0002607126).

**Manual Activities**
```
<P><br/><br/>------------------------------------------------------------------------<br/>|Manual Activity                                            |<br/>------------------------------------------------------------------------<br/>|VALID FOR                                                 XI ESR       |<br/>| Release 7.50        All Support Package Levels                |<br/>------------------------------------------------------------------------<br/><br/><B>Caution</B>: You have to perform this manual activity separately in each system into which you transport the Note for implementation.<br/><br/>To enable the protection, check whether Exchange Profile Property (PI case) / AII Property (PO case) "com.sap.aii.ib.server.hmi.xsrfProtection" exists. If so, change its value to 'true'. In case the property doesn't exist yet (this can happen in PI case if the master.xml was not re-imported), create it manually in section "IntegrationBuilder.Directory".<br/></P> <br/>  
```

**Side Effects**
This document is causing side effects:
- **SAP Note 2969210**: [ESR Mapping lookup not functioning](https://me.sap.com/notes/0002969210)

**Additional Actions**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000001605172021)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0002607126?language=en-US&token=82464A28E747BA35CB9147F7921F5B31)
- [Edit Note](https://me.sap.com/sap/support/notes/edit/0002607126) *(Visible if you have appropriate permissions)*

**Credits**
Credits to [redrays.io](https://redrays.io) for support to provided information.