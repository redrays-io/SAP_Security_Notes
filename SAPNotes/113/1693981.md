1693981 - Unauthorized modification of displayed content

**Symptom**

File upload can be abused by an attacker, allowing them to modify displayed application content without authorization, and to potentially obtain authentication information from other legitimate users.  
Also other attacks are possible with file upload.

**Other Terms**

File upload, Virus Scan Profile, SAP Virus Scan Interface

**Reason and Prerequisites**

Several attacks are possible with files uploaded to file repositories. In general, virus scanners will not find files designed for this specific attack type.

**Solution**

SAP provides an enhanced virus scan interface including options for content protection. To use this protection:

1. **Connect a virus scanner** to the SAP system supporting active content block and MIME detection/filter. See [SAP note 1494278](https://me.sap.com/notes/1494278) for available virus scanners and features. If in doubt, contact your virus scanner provider. See [Link 1](http://help.sap.com/saphelp_nw73ehp1/helpdata/en/e3/aa783f181b0866e10000000a114084/frameset.htm) for general documentation on how to connect a virus scanner to the SAP system.
2. **Implement SAP notes 1640285 and 1669429** or the corresponding support packages (more notes may be necessary, see below).
3. **Create or adapt a default virus scan profile.** See [Link 1](http://help.sap.com/saphelp_nw73ehp1/helpdata/en/e3/aa783f181b0866e10000000a114084/frameset.htm) for general documentation. This default profile should cover 80%-100% of your use cases. All other profiles should use this default profile (check 'Active' and 'Use Reference' and leave 'Ref. Profile' and 'Default Profile' empty). Most applications will use the same profile configuration parameters as the default profile. For these applications, leave 'Evaluate Profile Configuration Param.' empty. For applications needing different MIME types, check 'Evaluate Profile Configuration Param.' and maintain the profile parameters as needed by this application. The profile parameters of the default profile will be ignored.

**Notes:**

- If you save the 'Virus Scan Profile' configuration and see the warning: _'Profile parameters exist, but evaluation has not been activated'_ for profiles delivered by SAP, make sure to check 'Evaluate Profile Configuration Param.' for these profiles.
- Depending on your support package level, additional SAP notes may be required to enable application-specific profiles.

**Hints for the virus scan profile:**

- It is possible to specify which file types (MIME types) are allowed. Restrict the number of allowed MIME types to the minimum needed. If possible, set the profile configuration parameter `CUST_ACTIVE_CONTENT` to `1`.
- Make a risk assessment. Ask your virus scan provider for help.

**Example for the default profile:**

In the 'Virus Scan Profile' view, check 'Active', 'Evaluate Profile Configuration Param.' and 'Default Profile'.

In the 'Profile Configuration Parameters' view (the meaning of the configuration parameters detailed discussed in note 1640285):

- `CUST_CHECK_MIME_TYPE`: `1` (enable MIME type check).
- `CUST_ACTIVE_CONTENT`: `1` (block files with active content).
- `CUST_MIME_TYPES_ARE_BLACKLIST`: `1` (listed MIME types will be blocked, any other types will be allowed).

**MIME Types:**

- `text/html`
- `text/thtml`
- `application/xhtml+xml`
- `text/javascript`
- `application/javascript`
- `application/x-javascript`
- `application/ecmascript`
- `application/java-archive`
- `application/x-jar`
- `application/x-java-jar`
- `application/x-shockwave-flash`
- `application/x-silverlight-app`
- `application/x-silverlight`
- `application/x-silverlight-2`

**Note:** This is an example only. Using a MIME type whitelist instead of a blacklist will increase security but might not be acceptable from a functional point of view. Make sure to create all virus scan profiles according to your business and security needs. Make a risk assessment.

**Related Information:**

[Note 817623](https://me.sap.com/notes/817623) describes how non-SAP applications can use the Virus Scan Interface (VSI).

**Link to Virus Scan Interface (VSI) documentation:**

1. [SAP Help Portal - Virus Scan Interface (VSI) Documentation](http://help.sap.com/saphelp_nw73ehp1/helpdata/en/e3/aa783f181b0866e10000000a114084/frameset.htm)

**Actions:**

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000017403982017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001693981?language=en-US&token=74CEEA273035BA1F535F90EF65581B0E)
- [Share by Email](https://me.sap.com/notes/1693981/share-email)
- [Open in New Window](https://me.sap.com/notes/1693981/open-new-window)

---

*Credits to [RedRays](https://redrays.io) for supporting the provision of this information.*