2965287 - [CVE-2020-6363] Insufficient Session Expiration in SAP Commerce Cloud

**Header Data**

- **SAP Note/KBA:** 2965287
- **Type:** SAP Security Note
- **Version:** 7
- **Recency:** New
- **Language:** English
- **Master Language:** English
- **Category:** Program error
- **Priority:** Correction with low priority
- **Release Status:** Released for Customer
- **Released On:** 13.10.2020
- **Component:** Customer Engagement and Commerce > SAP Commerce > SAP Commerce

**Title**

2965287 - [CVE-2020-6363] Insufficient Session Expiration in SAP Commerce Cloud

**Description**

### Symptom

SAP Commerce Cloud exposes several web applications that maintain sessions with a user. These sessions are established after the user has authenticated with username/passphrase credentials. The user can change their own passphrase, but this does not invalidate active sessions that the user may have with SAP Commerce Cloud web applications, which gives an attacker the opportunity to reuse old session credentials, resulting in Insufficient Session Expiration.

**Impacts of Insufficient Session Expiration are:**
- An increased risk that stolen username/passphrase credentials may be abused
- In particular, the user has no means to fully recover from situations where they know that they leaked their passphrase

### Other Terms

Insufficient Session Expiration, Missing Session Invalidation,Â [CVE-2020-6363](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-6363)

### Reason and Prerequisites

The missing session invalidation after passphrase change affects several web applications of SAP Commerce Cloud, including:
- hac
- Backoffice
- SmartEdit
- Accelerator storefronts

### Solution

SAP Commerce Cloud addresses this issue by releasing patches that enable operators to activate session invalidation after passphrase change. These patch releases implement session invalidation after passphrase change for all affected SAP Commerce Cloud web applications. Upon passphrase change (either by the user themselves or by an administrator) all sessions of the user are invalidated, with the exception of the user's session that triggered the passphrase change (if applicable).

**The following patch releases address this issue:**
- [SAP Commerce Cloud Patch Release 1808.29](https://cxjira.sap.com/browse/PATCH-7995)
- [SAP Commerce Cloud Patch Release 1811.27](https://cxjira.sap.com/browse/PATCH-7996)
- [SAP Commerce Cloud Patch Release 1905.19](https://cxjira.sap.com/browse/PATCH-7997)
- [SAP Commerce Cloud Patch Release 2005.3](https://cxjira.sap.com/browse/PATCH-7998)

The corresponding [Software Downloads for SAP Commerce Cloud](https://me.sap.com/#/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=NEXT&_HEADER=Y&_FUNCTIONBAR=Y&_EVENT=TREE&_NE=NAVIGATE&_ENR=67837800100800007216&_V=MAINT&_TA=ACTUAL/SAP%20COMMERCE) are available in the SAP Support Portal. For information about installing patches, see [About Patch Releases](https://help.sap.com/viewer/a74589c3a81a4a95bf51d87258c0ab15/2005/en-US/8c25978386691014b4abdd61376acd24.html).

**Manual Correction Steps:**

Please be aware that the session invalidation feature provided by the above patches is optional. It will **not** be active by default after the respective patch is installed. (This is for backward compatibility reasons.)

To activate session invalidation after passphrase change, set the following SAP Commerce Cloud configuration properties after the patch is installed:

```
session.staleness.detection.enabled=true
session.staleness.detection.{extension-name}.enabled=true
oauth2.revoke.tokens.on.user.password.change=true
```

- The first form enables session invalidation after passphrase change for all SAP Commerce Cloud web applications that establish cookie-based sessions with the user.
- The second form can be used to override this behavior for a specific web application extension of SAP Commerce Cloud, as identified by the placeholder `{extension-name}`. Usage of the second form is not required if the first form is used and should apply to all SAP Commerce Cloud web applications.
- Finally, the third form ensures that oAuth tokens issued by the SAP Commerce Cloud oauth2 extension will also be invalidated. It will ensure that all access tokens and refresh tokens that have been issued for a user will be invalidated once the user changes their passphrase.

As mentioned, all these configuration properties default to false in the published patch releases. In order to address this vulnerability, the operator of SAP Commerce Cloud must explicitly set them to true. This default behavior may or may not change in future releases of SAP Commerce Cloud.

**CVSS**

- **CVSS Score:** 3.7
- **CVSS Vector:** [CVSS:3.0/AV:N/AC:H/PR:L/UI:R/S:U/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:R/S:U/C:L/I:L/A:N)

  - **Attack Vector (AV):** Network (N)
  - **Attack Complexity (AC):** High (H)
  - **Privileges Required (PR):** Low (L)
  - **User Interaction (UI):** Required (R)
  - **Scope (S):** Unchanged (U)
  - **Confidentiality Impact (C):** Low (L)
  - **Integrity Impact (I):** Low (L)
  - **Availability Impact (A):** None (N)

**Actions**

- [Mark as Favorite](#) / [Unmark as Favorite](#)
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000001714222020)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0002965287?language=en-US&token=B37931F9617313DD93A507A74638543D)
- [Share by Email](#)
- [Open in New Window](#)

For more details, visit [SAP Support Portal](https://me.sap.com/).

*Credits to [redrays.io](https://redrays.io) for support in providing this information.*