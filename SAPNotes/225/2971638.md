2971638 - [CVE-2020-6369] Hard-coded Credentials in CA Introscope Enterprise Manager (Affected products: SAP Solution Manager and SAP Focused Run)

---

### Symptom

**UPDATE 9th November 2021**: This note has been re-released with updated ‘Solution’ information. Manual instructions are provided for the customers who are still using Introscope 10.5 or older version of 10.7 (older than 10.7.0.307)

CA Introscope Enterprise Manager's releases 10.7.0.306 or lower, allow unauthenticated attackers to bypass the authentication if the default passwords for Admin and Guest have not been changed by the administrator. This may impact the confidentiality of the service.

### Other Terms

Hard-coded Password, Hard-coded Username, Hard-coded Key, [CVE-2020-6369](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-6369)

### Reason and Prerequisites

This vulnerability only applies to your installation if the default passwords for the pre-defined users Admin and Guest have not been changed.

### Solution

**Note**: If you use CA Introscope Enterprise Manager less than 10.5, you have to update to 10.7. If you install Introscope Enterprise Manager 10.7 SP0 Patch 2 (10.7.0.307) or higher, no action is required. The details are available in [Note 2909673](https://me.sap.com/notes/2909673).

**Determine Enterprise Manager Version:**

The solution depends on the CA Introscope Enterprise Manager release that is actually used. To determine the exact version, check the file `<EM_HOME>/logs/IntroscopeEnterpriseManager.log` and search for a line like this:

```
[INFO] [main] [Manager] Introscope Enterprise Manager Release 10.5.2.113 (Build 995502)
```

The line is written to the log during startup of the Enterprise Manager. Search e.g. for the string "Enterprise Manager Release". If you do not find such a line, restart the Enterprise Manager to generate it. You will find version numbers like 10.5.2.113 (10.5) or 10.7.0.279 (10.7).

**Patch Description:**

If your Enterprise Manager version is **older than 10.5** you have to upgrade to release 10.7 as described below. Introscope Enterprise Manager 10.7 has been tested to be compatible with SAP Solution Manager 7.2 SP05 and higher.

If you have SAP Solution Manager 7.1 or an older version of SAP Solution Manager 7.2 (<SP05), you have to update/upgrade your SAP Solution Manager.

The solution is to deploy an additional Enterprise Manager plugin that blocks the passwords for the pre-defined users Admin and Guest if they still have default values. If the passwords for Admin and Guest have been changed anyway, this plugin does not change anything. Additionally defined users are not touched either. The same fix can be applied to Introscope Enterprise Manager 10.5 and 10.7.

**To implement the fix proceed as follows:**

1. Download the attached file [com.sap.introscope.em.pwdcheck-10.7.0.jar](https://userapps.support.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=002075125800001802372020&iv_version=0007&iv_guid=00109B36BCAE1EDB8192598A01A200E2) (for CA Introscope Enterprise Manager 10.5 and 10.7)
2. Copy the file into the folder `product/enterprisemanager/plugins` of your Introscope Enterprise Manager installation. Default installation location is `/usr/sap/ccms/apmintroscope`, but you may have chosen a different location during installation.
3. Restart the Introscope Enterprise Manager:
    - On Windows, restart the corresponding Windows Service "Introscope Enterprise Manager"
    - On Unix/Linux, use `EMCtrl.sh stop` and `EMCtrl.sh start` to trigger the restart
4. The new plugin will replace the existing hash for the user in `config/users.xml` with the string `"password_blocked_by_SAP"` and issue a line in the file `logs/IntroscopeEnterpriseManager.log` whenever the default password was changed, e.g.:

    ```
    [WARN] [main] [Manager.SapPwdCheckBean] Will disable default password for user Admin. To set a new custom password use tools/SHA2Encoder or the user management functionality in SAP Solution Manager configuration step 'Define CA Introscope'.
    ```

**Important**: After applying the fix you will have to set new credentials for the CA Introscope Enterprise Manager. Furthermore, connectivity between SAP Solution Manager / SAP Focused Run and Introscope will break. It must be restored manually.

In case you are still using Introscope 10.5 or if you have not upgraded to 10.7 version 10.7.0.307 or higher, you may in addition want to block other users with default credentials, even if they have no authorization for CA Introscope content. To block these credentials:

1. Open `config/users.xml` in a text editor.
2. For all default technical users (system, analyst, cemadmin, config, incident): In the `<user>` element replace `password="(some string)"` with `password="password_blocked_by_SAP"`.
3. Save the file. No restart of the Enterprise Manager is needed.

There are two options to set new credentials for CA Introscope Enterprise Manager access:

1. **Use SAP Solution Manager configuration step "Define CA Introscope"** to set Introscope credentials. This updates the credentials on Introscope side and in SAP Solution Manager. Write access for the diagnostics agent to the Introscope EM configuration files is needed in this case (should be granted typically anyway).
2. **Manual approach** directly editing the configuration files in your Enterprise Manager installation. This requires maintaining these credentials on SAP Solution Manager / SAP Focused Run side afterwards.

In any case, consider defining dedicated users for each user accessing Introscope and for each SAP Solution Manager accessing Introscope. For example, use the SAP Solution Manager SID as the name for the connection users.

**Details for using "Define CA Introscope" in SAP Solution Manager:**

1. Start the SAP Solution Manager Launchpad with an admin account
2. Click on the Tile "Configuration (All Scenarios)"
3. Navigate to "Cross Scenario Configuration" > "Mandatory Configuration" > "Infrastructure Preparation"
4. Go to Step 4 "Define CA Introscope"
5. Click **Edit** to activate edit mode
6. In the table, select an Enterprise Manager for which you want to set custom credentials
7. Click "User Management" to open the user management dialog
8. Select an existing user and update the password or add a new user. For new users, grant the permissions "read,run_trace". Make sure that the radio box in the first column selects the right table row.
9. Click "OK" to close the dialog.
10. Click "Save" to apply the changes.
11. Click "Refresh" to see if the connection is working: The "Status" column must show a green icon, indicating that the Enterprise Manager is online for SAP Solution Manager.

**Details for the manual approach:**

*Note: The steps here are also described in the Introscope Setup Guide, section "User Management". These steps are only needed if the diagnostics agent has no write access to the `users.xml` and `domains.xml` files of the Enterprise Manager.*

1. Decide if you want to use the existing accounts Admin and Guest or create new accounts. Adding new accounts requires changing `domains.xml` in addition to `users.xml` and is described in the setup guide.
2. Run the command `SHA2Encoder` to encode your new password:
    - Open a command/terminal window in the folder `tools` of your Introscope installation.
    - Run `SHA2Encoder mypasswd`, where `mypasswd` is your new password
    - The command will output the encoded password
3. Open the file `<EM_HOME>/config/users.xml` in a text editor. Locate the attribute `password="..."` for the user account that you want to change and paste the encoded password here. Save the file.
4. The change becomes active without the need to restart the Enterprise Manager.
5. Follow the steps above to set the password on SAP Solution Manager side.

### CVSS

**CVSS Score:** 7.5

**CVSS Vector:** [CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator)

- **Attack Vector:** Network (N)
- **Attack Complexity:** Low (L)
- **Privileges Required:** None (N)
- **User Interaction:** None (N)
- **Scope:** Unchanged (U)
- **Confidentiality Impact:** High (H)
- **Integrity Impact:** None (N)
- **Availability Impact:** None (N)

### Attachments

- [com.sap.introscope.em.pwdcheck-10.7.0.jar](https://userapps.support.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=002075125800001802372020&iv_version=0007&iv_guid=00109B36BCAE1EDB8192598A01A200E2) (9 MB)

### References

- [2909673 - Introscope 10.7 Release Notes](https://me.sap.com/notes/2909673)
- [2534316 - Introscope 10.5 Release Notes for changes and open issues](https://me.sap.com/notes/2534316)

---

*Credits to [redrays.io](https://redrays.io) for support in providing this information.*