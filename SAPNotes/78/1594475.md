1594475 - Potential denial of service in all programs using iXML

**Symptom**

An attacker can remotely exploit a program using iXML, rendering it, and potentially the resources that are used to serve a program using iXML, unavailable.

**CVSS Information**

- **CVSS Base Score:** 4.0
- **CVSS Base Vector:** AV:N/AC:L/AU:SC:N/I:N/A:P

SAP provides this CVSS base score as an estimate of the risk posed by the issue reported in this note. This estimate does not take into account your own system configuration or operational environment. It is not intended to replace any risk assessments you are advised to conduct when deciding on the applicability or priority of this SAP security note. For more information, see the FAQ section at [https://service.sap.com/securitynotes/](https://service.sap.com/securitynotes/).

**Other Terms**

DoS, denial of service, iXML, DTD, XML, XSLT

**Reason and Prerequisites**

The problem is caused by a resource exhaustion condition. An attacker can launch a specifically crafted request that causes the process to consume excessive resources. As a result, no other processes can allocate new resources, rendering the system unavailable. This condition can be intentionally provoked by an attacker to cause a denial of service.

**Solution**

Please apply the patch level mentioned in this note at least. The patch provided in this note includes corrections of ABAP programs, new profile parameters, corrections of the SAP kernel (`disp+work.exe`), and corrections of the iXML DLL (`dw_xml.dll`).  
Please note that the basic security solution is delivered by the patch level mentioned in this note.

With the support package mentioned in this note, extensions of the basic security solution are made available to developers using iXML. It is not possible to apply these changes via correction instructions.  
By implementing this note, iXML provides new options for DTD processing to avoid Denial of Service attacks by using XML bombs.

**Protection Against XML Bombs:**

1. **Administrator (System Wide)**
   - Set the new profile parameter `ixml/dtd_restriction` to `expansion`.
   - Set the new profile parameter `ixml/xml_expansion_factor` to a proper value. The default is 10.

2. **Programmer (For the Current Parsed XML Document)**
   - Use the new method `SET_DTD_RESTRICTION` of the interface `IF_IXML_ISTREAM`.
   - Use the new method `SET_MAX_EXPANSION` of the interface `IF_IXML_ISTREAM` to set a program-specific threshold.

**How to Protect Your XML Services:**

- If you are not providing services that may be vulnerable to XML bombs, you can retain your current settings.
- To protect all your services, set the profile parameter `ixml/dtd_restriction` to `expansion`. This may slightly slow down XML processing. If you encounter false DoS detections, consider increasing the value of the `ixml/xml_expansion_factor`.
- Each service can have its individual settings by using the new methods of the `IF_IXML_ISTREAM` interface.
- When using XSLT programs, create an iXML IStream based on your source XML document and use this IStream in the `CALL TRANSFORMATION` statement instead of the former XML input.
- Alternatively, replace your XSLT programs with Simple Transformation programs, which do not support DTDs.

**Validity**

This note is valid for the following software components:

- **KRNL32NUC**
  - From 4.6DEXT to 4.6DEX2
  - From 6.40 to 6.40EX2
  - From 7.00 to 7.01
  - From 7.10 to 7.20
  - From 7.20EXT to 7.20EXT

- **KRNL32UC**
  - Similar versions as KRNL32NUC

- **KRNL64NUC**
  - Similar versions as KRNL32NUC

- **KRNL64UC**
  - Similar versions as KRNL32NUC plus version 8.00 and 8.02

- **SAP_BASIS**
  - Versions from 610 to 731 with specific support packages

- **KERNEL**
  - Versions from 4.6D to 8.02 with specific support packages

For detailed information on supported versions and support packages, visit [https://me.sap.com/](https://me.sap.com/).

**References**

This document refers to:
- [1744122 - Untrusted XML Input parsing possible in iXML applications](https://me.sap.com/notes/1744122)
- [1741441 - iXML mini parser: Protection against attacks via a DTD](https://me.sap.com/notes/1741441)
- [1729293 - Untrusted XML input parsing possible in GRMG](https://me.sap.com/notes/1729293)
- [1712860 - iXML: Protection against attacks via a DTD](https://me.sap.com/notes/1712860)

**Side Effects**

This document is causing side effects in:
- [1744122 - Untrusted XML Input parsing possible in iXML applications](https://me.sap.com/notes/1744122)

*Credits to [https://redrays.io](https://redrays.io) for support to provided information.*