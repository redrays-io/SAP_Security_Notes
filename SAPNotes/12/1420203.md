SAP Security Note 1420203: Enable foreign access to a stateful HTTP session

**SAP Note Details**
- **Number**: 1420203
- **Type**: SAP Security Note
- **Version**: 23
- **Recency**: Updated
- **Language**: English (Master Language: German)
- **Category**: Program error
- **Priority**: Correction with high priority
- **Status**: Released for Customer
- **Released On**: 02.02.2012
- **Component**: Internet Communication Framework (BC-MID-ICF)

**Title**
Enable foreign access to a stateful HTTP session

**Description**
The Internet Communication Framework (ICF) runtime currently rejects foreign access to a stateful HTTP session, returning a "400 Session not found" error (refer to [Note 1301591](https://me.sap.com/notes/1301591)).

**Symptom**
Foreign access attempts to a stateful HTTP session result in a "400 Session not found" error.

**Reason and Prerequisites**
Access is rejected if conditions outlined in [Note 1301591](https://me.sap.com/notes/1301591) are met. To enable foreign access in specific scenarios, enhancements to the ICF and the interface `IF_HTTP_SERVER` are necessary.

**Solution**
1. **Implement Method `ENABLE_FOREIGN_SESSION_ACCESS`**:
   - Create an HTTP URL with a session access token.
   - Transfer this URL to a foreign HTTP caller to execute requests in the userâ€™s context.
   
2. **Prerequisites for Token Creation**:
   - Convert the HTTP session to a stateful session using `SET_SESSION_STATEFUL_VIA_URL`.
   - Specify a mandatory URL path in transaction SICF as an end node service.
   - Optionally, specify a user ID to enforce specific logon data.
   - Optionally, restrict session access tokens to single use with the `one_time_access_token` parameter.

3. **Session Access Process**:
   - Tokens are created and returned in HTTP response headers.
   - Foreign callers use the session access URL and token to access the stateful session.

**Attachments**
- [SHTTP840.pdf](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000717372009&iv_version=0023&iv_guid=39883E72E67C184AAB30649E4D8D1321)
- [icfservdesc.pdf](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000717372009&iv_version=0023&iv_guid=87F5D140296E3745A5E5E354A8F3DDD3)
- [Icflogin.pdf](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000717372009&iv_version=0023&iv_guid=2BBD39C31FBDB54092F4163D4BCF867A)
- [Add_Type_Group_ABAP.pdf](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000717372009&iv_version=0023&iv_guid=E88553DCC26A354A8329CAFB689BDB83)
- [CL_HTTP_SERVER_NET_PRIV.pdf](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000717372009&iv_version=0023&iv_guid=EFBA6D5179048D49B2D73AF4ECA6338E)

**References**
This note refers to several other SAP Notes, including:
- [1666244](https://me.sap.com/notes/1666244): cFolders: Composite SAP Note - Security
- [1658516](https://me.sap.com/notes/1658516): Applets fail due to XSRF protection (COOKIE_NOT_FOUND)
- [1442046](https://me.sap.com/notes/1442046): HTTP 400 - Session not found (for public & stateful Service)
- [1301591](https://me.sap.com/notes/1301591): HTTP 400 - Session not found (Stateful HTTP communication)
  
**Validity**
Applicable to multiple SAP BASIS and KERNEL versions, including 6.40, 7.00, 7.01, 7.02, etc. Please refer to the [Support Package](https://me.sap.com/supportpackage/SAPKB62070) for detailed version compatibility.

**Correction Instructions**
Manual implementation is required for certain steps, including enhancements to specific structures and classes in the SAP system. Detailed instructions are provided in the attached PDFs.

**Prerequisites**
Ensure all related SAP Notes are reviewed and the system meets the required software component versions before applying this security note.

For more detailed information and correction instructions, refer to the official SAP Note: [1420203 - Enable foreign access to a stateful HTTP session](https://me.sap.com/notes/1420203).

**Credits**
Credits to [RedRays](https://redrays.io) for supporting the provision of this information.