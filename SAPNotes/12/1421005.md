1421005 - Secure configuration of the message server

**Header Data**
- **SAP Note/KBA:** 1421005
- **Type:** SAP Security Note
- **Version:** 8
- **Recency:** Updated
- **Language:** English
- **Master Language:** German
- **Category:** Installation information
- **Priority:** HotNews
- **Release Status:** Released for Customer
- **Released On:** 07/17/2013
- **Component:** BC-CST-MS
  - **Path:** Services & Support > KBAs & Notes > Basis Components > Client/Server Technology > Message Service

**Title**
1421005 - Secure configuration of the message server

**Description**

### Symptom
Malicious clients can log on to the message server of your SAP system and assume the identity of an application server.
You want to configure the message server in such a way that external clients cannot pose any risks to the operation of the system.

### Other Terms
- `rdisp/msserv`
- `rdisp/msserv_internal`

### Reason and Prerequisites
External clients (RFC SAP GUI) access the message server to balance the load between the individual application servers. To do this, the message server must also be accessible from outside the server network. Depending on the scenario, an access may also be required from outside the demilitarized zone (DMZ) or from the Internet.

However, the application servers also use the message server for communication within a system.

In the past, these functions were enabled via connections to the same TCP port of the message server.

This note provides you with instructions about how you can configure your message server so that clients from outside the server network cannot log on to the system as an application server. For background information about the configuration options that are introduced here, see [Note 821875](https://me.sap.com/notes/821875).

### Solution

#### Systems with kernel version 640 and higher:

1. **Ensure that your system has the correct kernel patch level.**
   - The minimum patch level is listed in the following table:

     | Kernel release | Patch level |
     |----------------|-------------|
     | 6.40           | 321         |
     | 7.00           | 246         |
     | 7.01           | 82          |
     | 7.10           | 190         |
     | 7.11           | 77          |
     | 7.20           | 33          |

2. **Define an internal message server port (`rdisp/msserv_internal`).**
   - It is essential that this is different from the standard message server port. It is recommended to configure this parameter in the DEFAULT profile of the system to prevent inconsistent settings on different application server instances.

3. **Use the parameter `ms/acl_info` to define a message server access list.**
   - This parameter must refer to a file that the message server can read and that contains access control entries in accordance with [Note 821875, section 3](https://me.sap.com/notes/821875,section,3).
   - For each host on which an application server can run, ensure that an entry exists that enables this host to access the internal port of the message server.

#### Systems with kernel version 46D:

1. **Ensure that your system has the correct kernel patch level.**
   - A secure connection is available as of kernel patch level 2508.

2. **Define an internal message server port (`rdisp/msserv_internal`).**
   - It is essential that this is different from the standard message server port. It is recommended to configure this parameter in the DEFAULT profile of the system to prevent inconsistent settings on different application server instances.

3. **Set up a packet filter on the host of the message server.**
   - Configure the packet filter to permit accesses to the internal port of the message server only from hosts where an application server of the relevant system runs or can run.
   - If no packet filter is available on the host of the message server, set up an external firewall with the relevant rules.

#### Systems with kernel versions 3.1I, 4.0B, or 4.5B:

In these kernel versions, the functions of the internal message server ports and the access control lists are not available.

To ensure that external clients cannot log on to the message server of your SAP system and can output as application servers, comply with the following rules:

- Implement a firewall that protects the server network or the central instance from external accesses.
- Ensure that external clients and servers cannot bypass the firewall to access the message server host (e.g., via a VPN or SAProuter).
- In the firewall, open only those TCP ports that require clients or external servers to access the dispatcher or the gateway of the central instance. Typically, these are the TCP ports `32<nn>` and `33<nn>` (where `<nn>` stands for the instance number).
- Open the TCP ports required for other server services on the host of the central instance.
- Do **not** open the port of the message server; external clients and servers should not be able to access this. Use the parameter `rdisp/msserv` to define this port.
- Test the firewall by attempting to connect from a client to the message server port of the central instance via telnet. This connection attempt should fail.

**Note:** These measures mean that you lose load balancing for clients and external servers. To ensure that connections of clients, other servers, and external servers continue to work, deactivate load balancing for these connections and configure the connection directly to one of the application servers of the system.

**Actions**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000016948312017)
- [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0001421005?language=en-US&token=53211D75A447D4FA38BAB506A8BBB22E)
- [Share by Email](#)
- [Open in New Window](#)
- [Show Changes](/notesLatestChanges/0001421005/E/diff)

**References**
- [1879601 - Secure setup of the standalone enqueue server](https://me.sap.com/notes/1879601)
- [1504652 - Consulting: Secure Configuration of Application Server ABAP](https://me.sap.com/notes/1504652)
- [888889 - Automatic checks for security notes using RSECNOTE (outdated)](https://me.sap.com/notes/888889)
- [821875 - Security settings in the message server](https://me.sap.com/notes/821875)

This document is referenced by:
- [2391089 - MsSCommInit: NiBufListen(3901) (rc=NIESERV_USED) on AIX](https://me.sap.com/notes/2391089)
- [2795681 - Securing SAP RFC Gateway and SAP Message Server](https://me.sap.com/notes/2795681)
- [2040644 - Secure Internal Server Communication](https://me.sap.com/notes/2040644)
- [888889 - Automatic checks for security notes using RSECNOTE (outdated)](https://me.sap.com/notes/888889)
- [1504652 - Consulting: Secure Configuration of Application Server ABAP](https://me.sap.com/notes/1504652)

**Attachments**
- No attachments available.

**Support Package Patches**
- [SAP KERNEL 6.40 32-BIT UNICODE SP316 Patch 000316](https://me.sap.com/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=DISPHIER&HEADER=Y&FUNCTIONBAR=N&EVENT=TREE&NE=NAVIGATE&ENR=01200314690200004051&V=MAINT)
- [SAP KERNEL 6.40 64-BIT UNICODE SP316 Patch 000316](https://me.sap.com/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=DISPHIER&HEADER=Y&FUNCTIONBAR=N&EVENT=TREE&NE=NAVIGATE&ENR=01200314690200004052&V=MAINT)
- *(Additional support package links omitted for brevity)*

**CVSS**
- **CVSS Score:** 0
- **CVSS Vector:** N/A

**Rate this document**
- **Rated Helpful:** 0 people
- **Quality Rating:** 0.0/5

---

*Credits to [redrays.io](https://redrays.io) for support and information.*