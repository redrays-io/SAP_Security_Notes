2781873 - [CVE-2019-0322] Denial of service (DOS) in SAP Commerce Cloud

## Symptom

*SAP Commerce Cloud* (previously known as *SAP Hybris Commerce*) allows an attacker to prevent legitimate users from accessing a service, either by crashing or flooding the service.

Some well-known impacts of Denial of Service vulnerability are:

- Long response delays and service interruptions, thus degrading the service quality experienced by legitimate users
- Direct impact on availability

## Other Terms

DoS, DDoS, Distributed Denial of Service, Uncontrolled Resource consumption, Resource Exhaustion, [CVE-2019-0322](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-0322)

## Reason and Prerequisites

This DoS vulnerability affects all instances of SAP Commerce Cloud that expose JMX remote access with a vulnerable default Tomcat `server.xml` configuration file.

Instances that use a customized `server.xml` may also be affected if they expose a `JmxRemoteLifecycleListener` in an insecure manner.

The default Tomcat `server.xml` configuration file shipped with the latest patch releases of SAP Commerce Cloud (see solution section) is not vulnerable anymore. Thus, instances that use the latest Tomcat `server.xml` configuration file are not affected by this vulnerability.

## Solution

**Fix this vulnerability by updating to the latest patch release of SAP Commerce Cloud, which deactivates JMX remote access.**

These are the patch releases that fix this vulnerability:

- [SAP Commerce Cloud Patch Release 1811.6](https://jira.hybris.com/browse/PATCH-5905)
- [SAP Commerce Cloud Patch Release 1808.10](https://jira.hybris.com/browse/PATCH-5904)
- [SAP Hybris Commerce 6.7.0.15 Patch Release](https://jira.hybris.com/browse/PATCH-5903)
- [SAP Hybris Commerce 6.6.0.18 Patch Release](https://jira.hybris.com/browse/PATCH-5902)
- [SAP Hybris Commerce 6.5.0.21 Patch Release](https://jira.hybris.com/browse/PATCH-5901)
- [SAP Hybris Commerce 6.4.0.24 Patch Release](https://jira.hybris.com/browse/PATCH-5900)
- [SAP Hybris Commerce 6.3.0.30 Patch Release](https://jira.hybris.com/browse/PATCH-5899)

The corresponding [software downloads for SAP Hybris Commerce](https://launchpad.support.sap.com/#/softwarecenter/template/products/%20_APP=00200682500000001943&_EVENT=DISPHIER&EVENT=TREE&NE=NAVIGATE&ENR=67837800100800007216&V=INST&TA=ACTUAL) are available in the SAP Support Portal.

Please always update to the latest available patch release for your version of SAP Commerce Cloud, or upgrade to the latest patch release of a newer version of SAP Commerce Cloud.

Follow the [update procedure for SAP Commerce Cloud patch releases](https://help.hybris.com/1811/hcd/8c25978386691014b4abdd61376acd24.html).

### Post-Update Mitigation Steps

After updating an existing instance of SAP Commerce Cloud to the latest patch release, the following additional steps are required. *(These steps are not required when setting up a new instance of SAP Commerce Cloud from scratch, using the latest patch release.)*

1. Go to `<HYBRIS_CONFIG_DIR>/tomcat/conf` directory to edit the `server.xml` file.
2. In `server.xml`, disable the listener for the `org.apache.catalina.mbeans.JmxRemoteLifecycleListener` class by commenting it out.
3. Save `server.xml`.
4. Go to `<HYBRIS_CONFIG_DIR>` and edit your `local.properties` file.
5. In your properties file, edit the `tomcat.generaloptions` property and remove the following options from it:
   ```
   -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dorg.tanukisoftware.wrapper.WrapperManager.mbean=true
   ```
6. Save your properties file.
7. Run `ant server`.

### Side-Effects

After updating and applying the above mitigation steps, JMX remote access to your SAP Commerce Cloud instance will be disabled. If you require JMX remote access functionality, make sure that it can only be accessed by authorized users, via a secure (TLS) channel. Do not rely on default passwords or keys. For information about configuring JMX remote access in a secure manner, see the [Secure Configuration](https://help.sap.com/viewer/9433604f14ac4ed98908c6d4e7d8c1cc/1811/en-US/c8145542c2564bb29f6cf2fb6fe67b90.html) guide.

## CVSS

**CVSS Score:** 6.5  
**CVSS Vector:** [CVSS:3.0/AV:A/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:A/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H)

- **Attack Vector (AV):** Adjacent (A)
- **Attack Complexity (AC):** Low (L)
- **Privileges Required (PR):** None (N)
- **User Interaction (UI):** None (N)
- **Scope (S):** Unchanged (U)
- **Confidentiality Impact (C):** None (N)
- **Integrity Impact (I):** None (N)
- **Availability Impact (A):** High (H)

**Credits:** [redrays.io](https://redrays.io)