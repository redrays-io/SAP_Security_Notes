3142773 - [CVE-2021-44228] Remote Code Execution vulnerability associated with Apache Log4j 2 component used in SAP Commerce

**Symptom**

SAP Commerce uses a version of the Open Source component Apache Log4j which has vulnerabilities [CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228), [CVE-2021-45046](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45046), [CVE-2021-45105](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45105), and [CVE-2021-44832](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44832).

**Other Terms**

- RCE
- Command Injection
- OS command injection

**Reason and Prerequisites**

This vulnerability affects all installations of SAP Commerce, including:
- **SAP Commerce Cloud in Public Cloud**
- **SAP Commerce Cloud in SAP Infrastructure**
- **SAP Commerce OnPrem**

**Solution**

SAP Commerce addresses these vulnerabilities by upgrading the open-source Log4j library to version **2.17.1** or later, which mitigates the listed vulnerabilities.

The following SAP Commerce patch releases contain the updated Log4j library:
- [SAP Commerce Cloud Patch Release 2105.6](https://help.sap.com/viewer/eed845124da0491e875df8139c4e6e8c/2105/en-US/f9b65161e1e645249542e59f42f64a7b.html)
- [SAP Commerce Cloud Patch Release 2011.16](https://help.sap.com/viewer/eed845124da0491e875df8139c4e6e8c/2011/en-US/f9b65161e1e645249542e59f42f64a7b.html)
- [SAP Commerce Cloud Patch Release 2005.21](https://help.sap.com/viewer/eed845124da0491e875df8139c4e6e8c/2005/en-US/f9b65161e1e645249542e59f42f64a7b.html)
- [SAP Commerce Cloud Patch Release 1905.37](https://help.sap.com/viewer/eed845124da0491e875df8139c4e6e8c/1905/en-US/f9b65161e1e645249542e59f42f64a7b.html)

The [Software Downloads](https://me.sap.com/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=NEXT&HEADER=Y&FUNCTIONBAR=Y&EVENT=TREE&NE=NAVIGATE&ENR=67837800100800007216&V=MAINT&TA=ACTUAL/SAP%20COMMERCE) for these or later patches are available in the SAP Support Portal.

**Manual Remediation Steps**

For information on installing SAP Commerce patches, see [About Patch Releases](https://help.sap.com/viewer/eed845124da0491e875df8139c4e6e8c/LATEST/en-US/8c25978386691014b4abdd61376acd24.html).

After installing a SAP Commerce patch, customers need to rebuild and redeploy the updated SAP Commerce version:

- **SAP Commerce Cloud in Public Cloud**: Follow the [build](https://help.sap.com/viewer/0fa6bcf4736c46f78c248512391eb467/LATEST/en-US/79763857d2264a189cb577fc90de0fea.html) and [deploy](https://help.sap.com/viewer/0fa6bcf4736c46f78c248512391eb467/LATEST/en-US/72e126a98eb14b668709be9946070e5c.html) instructions.
- **SAP Commerce Cloud in SAP Infrastructure**: Follow the [build instructions](https://help.sap.com/viewer/d0224eca81e249cb821f2cdf45a82ace/LATEST/en-US/8b6ded0d86691014a6fab18e171c1f91.html) and request deployment through a support ticket.
- **SAP Commerce OnPrem**: Follow the [build and deploy instructions](https://help.sap.com/viewer/a74589c3a81a4a95bf51d87258c0ab15/LATEST/en-US/8bb0ad2786691014b930c18dd4cd7851.html).

**Workaround**

Assess the workaround applicability for your SAP landscape prior to implementation. This workaround is a temporary fix and not a permanent solution. SAP strongly recommends applying the corrections outlined in the security note.

The workaround consists of removing the Java class file `JNDILookup.class` from all Log4j library JAR files shipped with SAP Commerce.

Additional Knowledge Base Articles (KBAs) detailing the workaround:
- [KBA 3130939](https://me.sap.com/notes/3130939) for **SAP Commerce Cloud in Public Cloud**
- [KBA 3130982](https://me.sap.com/notes/3130982) for **SAP Commerce Cloud in SAP Infrastructure**
- [KBA 3130967](https://me.sap.com/notes/3130967) for **SAP Commerce OnPrem**

**CVSS Details**

- **Score**: 10.0
- **Vector**: [CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H](https://nvd.nist.gov/vuln-metrics/cvss)

**Affected Software Components**

- **HY_COM** versions:
  - 1905
  - 2005
  - 2011
  - 2105

**Available Languages**

- Deutsch
- 日本語
- Português (Machine Translation)
- Español (Machine Translation)
- Français (Machine Translation)
- Italiano (Machine Translation)
- Русский (Machine Translation)
- 中文 (Machine Translation)
- 한국어 (Machine Translation)

**Resources**

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000000153282022)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0003142773?language=en-US&token=0F75DCE61690D7BB709F07325F8E78FC)

Credits to [redrays.io](https://redrays.io) for support in providing this information.