1609546 - Unauthorized modification of stored content in BC-SRV-RM

### Description

**Symptom**
BC-SRV-RM can be abused by a malicious user, allowing them to modify application content, persist the modified content without authorization, and potentially obtain authentication information from other legitimate users.

**Other Terms**
Stored cross-site scripting, XSS, BC-SRV-CM, BC-SRV-RM

**Reason and Prerequisites**
Some BSP pages in BC-SRV-RM result in a stored cross-site scripting issue. This vulnerability allows malicious users to permanently modify displayed content on a website, embedding content that is rendered automatically without targeting victims individually. Stored XSS can also be used to steal another user's authentication information, such as data related to their current session. A malicious user who gains access to this data may impersonate the user and access all information with the same rights as the target user. If an administrator is impersonated, the security of the application may be fully compromised.

### Solution

It is recommended to upgrade to the following Support Packages (SPs) to apply the corrections. If upgrading is not possible, please apply this note.

**Release | SP**
--- | ---
731 | [SAPKB73005](https://me.sap.com/supportpackage/SAPKB73005)
730 | [SAPKB73005](https://me.sap.com/supportpackage/SAPKB73005)
720 | [SAPKB72006](https://me.sap.com/supportpackage/SAPKB72006)
711 | [SAPKB71108](https://me.sap.com/supportpackage/SAPKB71108)
710 | [SAPKB71014](https://me.sap.com/supportpackage/SAPKB71014)
702 | [SAPKB70210](https://me.sap.com/supportpackage/SAPKB70210)
701 | [SAPKB70111](https://me.sap.com/supportpackage/SAPKB70111)
700 | [SAPKB70026](https://me.sap.com/supportpackage/SAPKB70026)
640 | [SAPKB64029](https://me.sap.com/supportpackage/SAPKB64029)
620 | [SAPKB62071](https://me.sap.com/supportpackage/SAPKB62071)

### Correction Instructions

There are 9 correction instructions available. You can access them [here](https://me.sap.com/corrins/0001609546/41).

### Manual Activities

Execute the following steps to correct the issue (applicable for releases 620 & 640):

1. Execute `SE80`.
2. Select 'BSP Application' from the dropdown and enter the BSP application name (e.g., `SRMCLFRM`) in the box below, then press `<enter>`.
3. Select the application node and click on the 'Expand all' button to expand the application tree structure.
4. Locate the BSP pages under 'Views', 'Pages with flow logic', or 'Page fragments' folders.
5. Double-click the page to be changed (refer to the BSP page names listed below) and use the 'display <-> change' button to enter change mode.
6. Navigate to the 'Layout' tab and replace the following statement (it will be the first statement in the layout):
   ```
   <%@page language="abap"%>
   ```
   with:
   ```
   <%@page language="abap" forceEncode="html"%>
   ```
7. Save and activate the page.

**BSP Applications and Pages to Correct:**

- **SRMCLFRM**
  - `EXCEPTION.HTM`
  - `SP.HTM`
  - `SPE.HTM`
  - `START`
- **SRM_DEMO_BSPEXT**
  - `EXAMPLE1.HTM`
  - `EXAMPLE2.HTM`
  - `EXAMPLE3.HTM`
- **SRM_DEMO_NOTE**
  - `IVIEW.HTM`
- **SRM_DEMO_RECORD**
  - `IVIEW.HTM`
  - `SESSION.HTM`
- **SRM_DOCVIEW**
  - `ALPROPERTIES.HTM`
  - `BUTTONS.HTM`
  - `CREATE.HTM`
  - `DISPLAY.HTM`
  - `DISPLAYALDOC.HTM`
  - `ERROR.HTM`
  - `OFFICEINTEGRATION.HTM`
  - `OFFICEINTEGRATIONJS.HTM`
  - `PROPERTIES.HTM`
  - `UPLOAD.HTM`
- **SRM_DOC_TEST**
  - `EXAMPLE3.HTM`
- **SRM_GENSP_QUERY**
  - `QUERY2.HTM`
- **SRM_NOTE**
  - `BUTTONS.HTM`
  - `NOTE.HTM`
- **SRM_ORGANIZER**
  - `ORGANIZER.HTM`
  - `ORG_ELEMENTS.HTM`
  - `ORG_FOLDERS.HTM`
  - `ORG_NAVI.HTM`
- **SRM_PROP**
  - `DISPLAY.HTM`
- **SRM_RECORD**
  - `REC.HTM`
- **SRM_URL**
  - `BUTTONS.HTM`
  - `VIEW.HTM`

For release 620, the following BSP pages also need to be corrected:

- **SRM_REC**
  - `BUTTONS.HTM`
  - `MORE_COLUMNS.HTM`
  - `NODE_PROPERTIES.HTM`
  - `PROPERTIES.HTM`
  - `REC.HTM`
  - `ROW.HTM`
  - `TABLE_BODY.HTM`
  - `TABLE_HEADER.HTM`

### Support Package

Ensure all relevant Support Packages are applied to your system. You can download the necessary SPs from the following links:

- [SAPKB62071](https://me.sap.com/supportpackage/SAPKB62071)
- [SAPKB64029](https://me.sap.com/supportpackage/SAPKB64029)
- [SAPKB70026](https://me.sap.com/supportpackage/SAPKB70026)
- [SAPKB70111](https://me.sap.com/supportpackage/SAPKB70111)
- [SAPKB70210](https://me.sap.com/supportpackage/SAPKB70210)
- [SAPKB71014](https://me.sap.com/supportpackage/SAPKB71014)
- [SAPKB71108](https://me.sap.com/supportpackage/SAPKB71108)
- [SAPKB72006](https://me.sap.com/supportpackage/SAPKB72006)
- [SAPKB73005](https://me.sap.com/supportpackage/SAPKB73005)

### References

No additional references are provided for this document.

---

*Credits: [RedRays.io](https://redrays.io) for support in providing this information.*