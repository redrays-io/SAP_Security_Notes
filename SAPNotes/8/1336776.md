1336776 - External commands: Security for calling side

### Symptom
In transaction SM49, we deliver a number of predefined external commands that are used by various applications.  
For several of these commands, the user must enter a parameter string when calling them.  
The user must enter a useful parameter string, however, the fact that the user can enter any parameter string poses a security risk.

### Other Terms
External commands, SM49, SXPG_COMMAND_EXECUTE, S_LOG_COM, check module

### Reason and Prerequisites
Currently (May 2009), the situation is as follows:

The component BC-CCM-BTC-EXT provides a framework (`SM49`, `SXPG_COMMAND_EXECUTE`, `SXPG_CALL_SYSTEM`, `SXPG_COMMAND_EXECUTE_LONG`) that you can use to start an operating system command, script, or executable program on the local or remote host from an ABAP program.  
The delivered, predefined external commands do not originate from the component BC-CCM-BTC-EXT. Most of the delivered commands allow you to enter any parameter string when called, which is then transferred to the predefined command.

It is clear that such access to the operating system command line poses a security risk.

The framework makes or made three security mechanisms available on the calling side:

1. (See also [Note 854060](https://me.sap.com/notes/854060))  
   To call an external command, a relevant authorization of the object `S_LOG_COM` is required. The command name is part of this authorization object. You can assign authorizations at the command name level.

2. Up to the publication of [Note 864152](https://me.sap.com/notes/864152), the system executed a hard-coded check when an external command was called. This check searched for certain special characters in the parameter string that potentially posed a security risk. If the parameter string contained a special character, the command was rejected.  
   Some SAP applications or customer-defined applications want to use these special characters in a harmless context, which was prevented by the check.  
   Following several customer complaints, this check was deactivated.  
   Performing the same check for all external commands is unsuitable.

3. You can define a check module in the definition of an external command. This can be a separate individual function module for each external command.  
   The function `SXPG_DUMMY_COMMAND_CHECK` provides a template for the interface of such a check module.  
   The option to perform a security check for each external command is not used for any command.

### Solution
The following results from the description above:

1. **End users must not be authorized for external commands for which any parameter string can be assigned.** Due to the security risk, such authorizations should only be assigned restrictively.

2. **If an SAP application requires several users or even end users to call up an external command for which any parameter string can be entered, open a message under the component that belongs to the application.** Mention this [Note 1336776](https://notesdownloads.sap.com/note/0040000016785122017) in the message.  
   The application then has to choose from multiple alternatives to exclude the security risk.

   a) The application has to check whether an alternative exists for the external command. For example, an external command is not required to display a file. You can use ABAP functions for that.

   b) The application must check whether the external command can be supplied with the parameter string within the source code so that there is no dialog with the end user who enters the parameter string.

   c) The application must provide a separate check module for the command. For example, you can define a regular expression that contains only the permitted parameter strings.  
      The check module would then check the parameter string against the regular expression.  
      *(Note: There are ABAP commands to process regular expressions.)*  
      Logically, such an individual check module cannot be supplied by the framework itself.  
      The component BC-CCM-BTC-EXT may provide help for technical questions regarding the framework, for example, about the delivery of the check module.

### Actions
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000016785122017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001336776?language=en-US&token=8FC54EDFD176E2D97ECEFADBE679D090)
- [Edit Note](https://me.sap.com/sap/support/notes/edit/0001336776)
- [Share by Email](https://me.sap.com/)
- [Open in New Window](https://me.sap.com/)

*Note: Links that start with "/" have been prefixed with `https://me.sap.com`.*

Credits to [redrays.io](https://redrays.io) for support to provided information.