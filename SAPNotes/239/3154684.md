3154684 - [CVE-2021-44228] Remote Code Execution vulnerability associated with Apache Log4j 2 component used in SAP Work Manager

**Symptom**

SAP Work Manager utilizes vulnerable versions of the Apache Log4j 2 component, which are affected by the following CVEs:

- [CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228)
- [CVE-2021-45046](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45046)
- [CVE-2021-45105](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45105)
- [CVE-2021-44832](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44832)

**Reason and Prerequisites**

This vulnerability affects on-premise SMP installations of SAP Work Manager. Cloud installations (ACE) are not impacted.

**Solution**

Upgrade to the following versions which include the updated Log4j libraries:

- **SAP Work Manager:** [6.6.1](https://me.sap.com/file/0030000000074292022)
- **SAP Inventory Manager:** [4.4.1](https://me.sap.com/file/0030000000074302022)

**Workaround**

If immediate upgrading is not feasible, apply the following temporary workaround by replacing the Log4j libraries:

1. **Download Fixed Libraries:**
   - [Log4j2 2.17.1](https://logging.apache.org/log4j/2.x/download.html) (for Java 8)
   - [Log4j2 2.12.4](https://logging.apache.org/log4j/log4j-2.12.4/download.html) (for Java 7)

2. **Replace JAR Files:**
   - Unzip the downloaded archive.
   - Replace the existing JAR files in your application deployment package:
     - `log4j-core.jar` (SMP only)
     - `log4j-api.jar`
     - `log4j-to-slf4j.jar` (ACE only)
   - Rename the JARs to match the original filenames if necessary.

3. **Deploy and Restart:**
   - Publish the updated application deployment package via the SMP cockpit.
   - Restart the SMP server to ensure the old classes are purged from the classloader.

**Troubleshooting**

If the application fails to start after updating the JAR files:

- Remove the `JndiLookup.class` directly from the `log4j-core.jar`:
  1. Open `log4j-core.jar` as a ZIP file.
  2. Delete `org/apache/logging/log4j/core/lookup/JndiLookup.class`.
  3. Save the modified JAR and replace the existing one following the steps above.

**CVSS Details**

- **CVSS Score:** 10.0
- **Vector:** [CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator)

**Affected Software Components**

- **WORKMGRDEPLOYMENT:** Versions 6.4 to 6.6
- **INVENTORYMGRDEPLOYMENT:** Versions 4.3 to 4.4

For more details, refer to the [SAP Security Note 3154684](https://notesdownloads.sap.com/note/0040000000293142022).

**Credits**

Credits to [https://redrays.io](https://redrays.io) for support in providing this information.