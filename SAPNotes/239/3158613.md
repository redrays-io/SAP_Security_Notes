Update 1 to Security Note 3022622: Code Injection Vulnerability in SAP MII [CVE-2021-21480]

**Symptom**
This security note is an update to [Security Note 3022622](https://me.sap.com/notes/3022622). The fix provided in Security Note 3022622 is no longer valid.

- Customers should implement this security note for a complete fix.
- Customers who have previously implemented [Security Note 3022622](https://me.sap.com/notes/3022622) should also implement this security note for a complete fix.

SAP MII allows users to create dashboards and save them as JSP through the SSCE (Self Service Composition Environment). An attacker can intercept a request to the server, inject malicious JSP code in the request, and forward it to the server. When this dashboard is opened by users with at least the `SAP_XMII_Developer` role, the malicious content in the dashboard gets executed, leading to remote code execution on the server. This allows for privilege escalation. The malicious JSP code can contain certain OS commands, enabling an attacker to read sensitive files on the server, modify files, or even delete contents on the server, thereby compromising the confidentiality, integrity, and availability of the server hosting the SAP MII application. Additionally, an attacker authenticated as a developer can use the application to upload and execute a file, permitting them to execute operating system commands and fully compromise the server hosting the application.

**Solution**
Implement the Support Packages and Patches referenced by this SAP Note.

A Virus Scan interface has been implemented for all file upload/import scenarios within MII. A NetWeaver Administrator should configure and enable the Virus Scan profile "XMII_VSI," which will then be used by MII. MII will support `BLOCKEXTENSIONS` and `BLOCKMIMETYPES` parameters provided by the profile. Using the virus scanner profile, the NetWeaver Administrator can restrict JSP creation by an XMII developer.

**Workaround**
Please assess the workaround applicability for your SAP landscape prior to implementation.

Note that this workaround is a temporary fix and is not a permanent solution. SAP strongly recommends applying the corrections outlined in the security note, which can be done in lieu of the workaround or after the workaround is implemented.

By default, MII is designed to support JSP creation. Customers should provide access to SSCE only to authorized users. All JSP content should be validated manually before moving it to production systems.

**CVSS**
- **Score:** 9.1
- **Vector:** [CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H](https://www.first.org/cvss/cvss-v3-0)

**Support Package Patches**
- [XMII 15.5 SP000 Patch Level 000003](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73555000100200014920&support_package=SP000&patch_level=000003)
- [XMII 15.2 SP003 Patch Level 000046](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73555000100200008331&support_package=SP003&patch_level=000046)
- [XMII 15.1 SP006 Patch Level 000072](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73554900100200001716&support_package=SP006&patch_level=000072)
- [XMII 15.3 SP001 Patch Level 000033](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73554900100200010399&support_package=SP001&patch_level=000033)
- [XMII 15.4 SP001 Patch Level 000021](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73555000100200013327&support_package=SP001&patch_level=000021)

For more details and to download the necessary patches, visit the [SAP Notes](https://me.sap.com/notes/3158613).

_Credits to [Red Rays](https://redrays.io) for support and information._