3490515 - [CVE-2024-39597] Improper Authorization Checks on Early Login Composable Storefront B2B sites of SAP Commerce

# SAP Security Note 3490515 - CVE-2024-39597

## Symptom

In SAP Commerce, a user can misuse the forgotten password functionality to gain access to a Composable Storefront B2B site for which early login and registration is activated, without requiring the merchant to approve the account beforehand. If the site is not configured as an isolated site, this can also grant access to other non-isolated early login sites, even if registration is not enabled for those sites.

## Other Terms

Improper Access Control, Authorization issues, [CVE-2024-39597](https://www.cve.org/CVERecord?id=CVE-2024-39597)

## Reason and Prerequisites

SAP Commerce Cloud allows administrators to enable the [Early Login and Registration](https://help.sap.com/docs/SAP_COMMERCE_CLOUD_PUBLIC_CLOUD/7e47d40a176d48ba914b50957d003804/8ac4edc486691014af43e39b142bc29a.html#early-login-and-registration) feature for a B2B site:

- If early login is enabled, users are required to authenticate before browsing the site.
- If registration is enabled, users can send registration requests, which the merchant can review before admitting users to the site.

This issue occurs when both early login and registration are set to "true". It does not affect setups that utilize classic accelerator storefronts and is specific to B2B scenarios.

- **Isolated Sites**: Only the targeted site is affected.
- **Non-Isolated Sites**: Registration can grant access to other non-isolated composable storefront sites with early login enabled, even if registration is disabled for those sites.

Access is only granted to the sites where the user can see similar or less data than users approved by the merchant. Access is maintained until the registration is rejected by the merchant, at which point the account is removed.

## Solution

SAP Commerce Cloud addresses this vulnerability by not sending password reset emails if the customer requesting a password reset was not approved beforehand by the merchant. The following patches contain the improvements:

- [SAP Commerce Patch Release 2205.27](https://help.sap.com/docs/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html)
- [SAP Commerce Cloud Update Release 2211.25](https://help.sap.com/docs/SAP_COMMERCE_CLOUD_PUBLIC_CLOUD/75d4c3895cb346008545900bffe851ce/f9b65161e1e645249542e59f42f64a7b.html)

The [Software Downloads](https://me.sap.com/notes/0003490515/D) of these or later patches are available in the SAP Support Portal:

- [Software Downloads for SAP Commerce Cloud in the Public Cloud](https://me.sap.com/mynotes?tab=Search&sortBy=Relevance&filters=themk%25253Aeq~'CEC*'%25252BreleaseStatus%25253Aeq~'CustomerRelease'%25252BsecurityPatchDay%25253Aeq~'NotRestricted'%25252BfuzzyThreshold%25253Aeq~'0.9'&flag=mynotes)
- [Software Downloads for SAP Commerce On-Premise](https://me.sap.com/mynotes?tab=Search&sortBy=Relevance&filters=themk%25253Aeq~'SAP%20Commerce'%20KBA&flag=mynotes)

For information about installing patches, see [About Update Releases](https://help.sap.com/docs/SAP_COMMERCE_CLOUD_PUBLIC_CLOUD/75d4c3895cb346008545900bffe851ce/8c25978386691014b4abdd61376acd24.html?locale=en-US). After installing a SAP Commerce Cloud patch, customers need to re-build and re-deploy the updated SAP Commerce Cloud version.

### Workaround

Please assess the workaround applicability for your SAP landscape prior to implementation. Note that this workaround is a temporary fix and is not a permanent solution. SAP strongly recommends you apply the corrections outlined in the security note, which can be done in lieu of the workaround or after the workaround is implemented.

**Manual Remediation Steps:**

1. If Early Login is enabled on an isolated Composable Storefront B2B site, disable Registration on the same site.
2. If Early Login is enabled on one of multiple non-isolated Composable Storefront B2B sites, disable Registration for all non-isolated sites.
3. For details about configuring Early Login and Registration, see [Early Login and Registration](https://help.sap.com/docs/SAP_COMMERCE_CLOUD_PUBLIC_CLOUD/7e47d40a176d48ba914b50957d003804/8ac4edc486691014af43e39b142bc29a.html#early-login-and-registration).

Credits: [redrays.io](https://redrays.io) for support in providing this information.