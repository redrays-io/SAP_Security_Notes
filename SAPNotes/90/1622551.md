1622551 - Verb Tampering issues in LMCFG

## Symptom

Problems with authorization and authentication checks in conjunction with the use of unusual HTTP methods exist in CTC.

## Other Terms

- **Verb Tampering**
- **HTTP method**
- **CTC**

## Reason and Prerequisites

CTC contains Verb Tampering vulnerabilities, posing a risk of information disclosure if accessed with unexpected HTTP methods. Verb Tampering attacks can be executed from arbitrary network locations and can lead to indirect attacks on target systems.

**Prerequisites:**
1. The `SAP_ungranted_role` should never be granted to any user.
2. Ensure [SAP Note 1445998](https://me.sap.com/notes/1445998) is applied to disable `invokerservlet` (Not required for NW 7.20 SP03 and above). While Verb-Tampering and InvokerServlet problems and solutions are not prerequisites of each other, it is recommended to apply both fixes.

## Solution

### Apply Official Patch

- **Download for SNOTE:** [0040000017295382017](https://notesdownloads.sap.com/note/0040000017295382017)
- **PDF Version:** [Download PDF](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001622551?language=en-US&token=5E7423972EAACFD84AA09945EC73BEE6)

Apply the official patch from the [SAP Service Marketplace](https://me.sap.com/) to automatically update the `web.xml` file with the required changes.

### Manual Implementation or Workarounds

If no patch is available for your specific release, consider the following options:

#### Manual Implementation

1. **Modify `web.xml` Files:**
   - Locate the `<security-constraint>` section in the `web.xml` files of the affected SDAs.
   - Remove all `<http-method>` elements within this section.
2. **Redeploy SDAs:**
   - Redeploy the modified SDAs on the application server.
3. **Restart AS Java Server:**
   - Ensure the AS Java server is restarted to apply changes.

#### Workaround #1: Disable Application Aliases

1. **Access SAP NetWeaver Administrator:**
   - Navigate to `https://<host>:<port>/nwa`.
2. **Navigate to Application Aliases:**
   - Go to Configuration > Connectivity/Infrastructure > Java HTTP Provider Configuration > Virtual Hosts > Application Aliases.
3. **Deactivate Specific Aliases:**
   - Remove the "Active" flag from the following aliases:
     - `ctc/additional` (For 7.1x, 7.2x, and 7.3x)
     - `ctc/a1s` (For 7.1x and 7.2x only)
4. **Save Changes:**
   - Click the "Save" button.

**Note:** Do not use this workaround if CTC functionality is actively used, as it will disrupt internal access.

#### Workaround #2: Prevent Remote Connections to CTC through URL Blocking

**Filter the following URL patterns via firewall or IDS to prevent remote access:**

- **For SAP NetWeaver 7.1x and 7.2x:**
  - `http(s)://[SERVER]:[PORT]/ctc/a1s/*`
  - `http(s)://[SERVER]:[PORT]/ctc/a1s/servlet/*`
  - `http(s)://[SERVER]:[PORT]/ctc/additional/*`
  - `http(s)://[SERVER]:[PORT]/ctc/additional/servlet/*`
  - `http(s)://[SERVER]:[PORT]/ctc/additional/ConfigServlet`

- **For SAP NetWeaver 7.3x:**
  - `http(s)://[SERVER]:[PORT]/ctc/additional/*`
  - `http(s)://[SERVER]:[PORT]/ctc/additional/servlet/*`
  - `http(s)://[SERVER]:[PORT]/ctc/additional/ConfigServlet`

**Note:** These workarounds block access but do not eliminate the underlying vulnerability.

## Validity

This SAP Security Note is applicable to the following versions of the LM CONFIGURATION component:

- **7.10 to 7.31**
- **LMCFG-BYD 7.20**

Refer to the [Support Package Patches](https://me.sap.com/notes/0001622551#SupportPackage) section in the SAP Note for detailed patch information.

## References

- This document is referenced by [1740018 - Briefing at Black Hat conference on July 26th, 2012](https://me.sap.com/notes/1740018).

---

*Credits to [Red Rays](https://redrays.io) for support in providing this information.*