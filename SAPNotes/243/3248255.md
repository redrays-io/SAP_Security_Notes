SAP Security Note 3248255 - CVE-2022-41266 Cross-Site Scripting (XSS) Vulnerability in SAP Commerce

**Symptom**
Due to lack of proper input validation, SAP Commerce Webservices 2.0 Swagger UI allows malicious inputs from untrusted sources, which can be leveraged by an attacker to execute a DOM Cross-Site Scripting (XSS) attack. As a result, an attacker may be able to steal user tokens and achieve full account takeover, including access to administrative tools in SAP Commerce.

**Other Terms**
- DOM XSS
- [CVE-2022-41266](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41266)

**Reason and Prerequisites**
The vulnerability originates from the open-source library `springfox-swagger-ui`, which includes a repackaged version of `swagger-ui`. This packaged version of `swagger-ui` contains the DOM-based XSS vulnerability.

**Solution**
SAP Commerce addresses this vulnerability by integrating a newer version of the `swagger-ui` library. The following patch releases address this vulnerability:

- [SAP Commerce Cloud Patch Release 2205.7](https://help.sap.com/docs/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html)
- [SAP Commerce Cloud Patch Release 2105.18](https://help.sap.com/docs/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html?version=2105)
- [SAP Commerce Cloud Patch Release 2011.28](https://help.sap.com/docs/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html?version=2011)
- [SAP Commerce Cloud Patch Release 2005.33](https://help.sap.com/docs/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html?version=2005)
- [SAP Commerce Cloud Patch Release 1905.49](https://help.sap.com/docs/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html?version=1905)

The [Software Downloads](https://me.sap.com/#/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=NEXT&HEADER=Y&FUNCTIONBAR=Y&EVENT=TREE&NE=NAVIGATE&ENR=67837800100800007216&V=MAINT&TA=ACTUAL/SAP%20COMMERCE) for these or later patches are available in the SAP Support Portal. For information about installing patches, see [About Patch Releases](https://help.sap.com/viewer/a74589c3a81a4a95bf51d87258c0ab15/2105/en-US/8c25978386691014b4abdd61376acd24.html).

After installing a patch, customers need to rebuild and redeploy the updated SAP Commerce version:

1. **SAP Commerce Cloud in Public Cloud:** Follow the [build](https://help.sap.com/viewer/0fa6bcf4736c46f78c248512391eb467/LATEST/en-US/79763857d2264a189cb577fc90de0fea.html) and [deploy](https://help.sap.com/viewer/0fa6bcf4736c46f78c248512391eb467/LATEST/en-US/72e126a98eb14b668709be9946070e5c.html) instructions.
2. **SAP Commerce Cloud on SAP Infrastructure:** Follow the [build instructions](https://help.sap.com/viewer/d0224eca81e249cb821f2cdf45a82ace/2105/en-US/8b6ded0d86691014a6fab18e171c1f91.html) and request a deployment through a support ticket.
3. **SAP Commerce On-Premise:** Follow the [build and deploy instructions](https://help.sap.com/viewer/a74589c3a81a4a95bf51d87258c0ab15/LATEST/en-US/8bb0ad2786691014b930c18dd4cd7851.html).

**Workaround**
Please assess the workaround applicability for your SAP landscape prior to implementation. Note that this workaround is a temporary fix and is not a permanent solution. SAP strongly recommends applying the corrections outlined in the security note, which can be done in lieu of the workaround or after the workaround is implemented.

If you cannot apply the patch, the following workaround is available:

- **Remove Swagger UI Functionality:**
  - Remove any use of `swagger-ui` in SAP Commerce, **or**
  - Block access to Swagger consoles via firewall rules on the host, WAF, or similar solutions.

*Note: This workaround will remove the ability to test and use SAP Commerce APIs via Swagger consoles.*

**Affected Versions**
This vulnerability affects the following SAP Commerce versions:
- 1905
- 2005
- 2011
- 2105
- 2205

**CVSS**
- **Score:** 8.0
- **Vector:** [CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:N)

**References**
For more information, refer to the [SAP Support Portal](https://me.sap.com/) and the official [CVE-2022-41266](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41266) entry.

---

*Credits to [redrays.io](https://redrays.io) for support in providing this information.*