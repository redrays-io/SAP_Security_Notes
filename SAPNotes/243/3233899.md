3233899 - [CVE-2023-33987] Request smuggling and request concatenation vulnerability in SAP Web Dispatcher

**Symptom**

This vulnerability includes two attack scenarios with the following CVSS ratings and impacts:

1. **Scenario 1:**
   - **CVSS Vector:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:N/I:N/A:H
   - **CVSS Score:** 8.6
   - **Impact:** An unauthenticated attacker can send maliciously crafted requests to the SAP Web Dispatcher, potentially causing the backend server to become temporarily unavailable, significantly affecting availability.

2. **Scenario 2:**
   - **CVSS Vector:** CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:C/C:L/I:L/A:H
   - **CVSS Score:** 8.1
   - **Impact:** Similar to Scenario 1, but additionally allows the attacker to read or modify information on the server, impacting both confidentiality and availability.

**Other Terms**
- HTTP Request Smuggling
- HTTP Response Smuggling
- HTTP Smuggling
- [CVE-2023-33987](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-33987)

**Affected Components**
- **SAP Web Dispatcher:** Versions supporting HTTP/2 are affected.
- **SAP NetWeaver Application Server ABAP:** Affected if using HTTP/2 with certain configurations.
- **SAP HANA Extended Application Services (XS Classic and XS Advanced):** Affected if HTTP/2 is explicitly enabled.

**Solution**

### Workaround (General Information)
Disable HTTP/2 by setting the profile parameter `icm/HTTP/support_http2=FALSE`. This can be done without a system restart using the administration UI, `wdispmon`, `sapcontrol`, transaction RZ11, or SMICM. Disabling HTTP/2 may reduce UI performance by up to 20%, depending on the application scenario and network conditions.

### Correction
Apply the necessary patches provided in SAP Note [3233899](https://me.sap.com/notes/3233899). The correction involves updating the SAP Web Dispatcher and related components using the following archives:

- **Standalone SAP Web Dispatcher:** Use `SAPWEBDISP.SAR`. Follow the instructions in [SAP Note 908097](https://me.sap.com/notes/908097) for patch installation and refer to [SAP Note 3115889](https://me.sap.com/notes/3115889) for differences between standalone and embedded deployments.
  
- **Embedded SAP Web Dispatcher:** Use `dw.sar` or `SAPEXE.SAR` and `SAPEXEDB.SAR`. Follow SAP's recommendations for patching the SAP kernel as outlined in [Support Package Patches](https://me.sap.com/notes/2083594).

### Detailed Steps

1. **Disable HTTP/2:**
   - **Standalone/Embedded SAP Web Dispatcher:**
     - Set `icm/HTTP/support_http2=FALSE` in the instance or DEFAULT profile.
     - Change can be made during runtime without a restart.
   
   - **SAP NetWeaver Application Server ABAP:**
     - Set `icm/HTTP/support_http2=FALSE` via transaction RZ11 or SMICM.
   
   - **XS Classic:**
     - Set `icm/HTTP/support_http2=false` in `webdispatcher.ini` under the profile section on the SYSTEM layer.
     - No restart required.
   
   - **XS Advanced:**
     - Add `icm/HTTP/support_http2=false` to `/hana/shared/<SID>/xs/controller_data/controller/router/webdispatcher/conf/sapwebdisp.template` and restart XS Advanced.

2. **Apply Patches:**
   - Download the appropriate SAR files from [SAP Support](https://me.sap.com/).
   - Follow the patch installation instructions in the respective SAP Notes.
   - Ensure the latest Support Package Stack Kernel is applied as per [SAP Note 2083594](https://me.sap.com/notes/2083594).
   - Review regression notes before installation as per [SAP Note 1802333](https://me.sap.com/notes/1802333).
   - For detailed patching instructions, refer to [SAP Note 19466](https://me.sap.com/notes/19466).

**References**
- [SAP Note 3233899](https://me.sap.com/notes/3233899)
- [SAP Note 908097](https://me.sap.com/notes/908097)
- [SAP Note 3115889](https://me.sap.com/notes/3115889)
- [SAP Note 2083594](https://me.sap.com/notes/2083594)
- [SAP Note 1802333](https://me.sap.com/notes/1802333)
- [SAP Note 19466](https://me.sap.com/notes/19466)
- [Update Strategy for the Kernel of the Application Server ABAP in On-Premise Landscapes](https://support.sap.com/deployment-strategies-kernel-abap.pdf)

**Credits**
Thanks to [RedRays.io](https://redrays.io) for supporting the provision of this information.