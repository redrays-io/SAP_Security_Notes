3239152 - [CVE-2022-41204] Account hijacking through URL Redirection vulnerability in SAP Commerce login form

**Summary**

A critical vulnerability (CVE-2022-41204) has been identified in SAP Commerce that allows attackers to hijack user accounts through URL redirection. This vulnerability enables attackers to manipulate the login URL, inject malicious code, and redirect user credentials to a server controlled by the attacker. Successful exploitation can compromise the confidentiality, integrity, and availability of the affected system.

**Details**

- **SAP Note Number:** 3239152
- **Type:** SAP Security Note
- **Version:** 3
- **Priority:** HotNews
- **Status:** Released for Customer
- **Released On:** October 14, 2022
- **Component:** Customer Engagement and Commerce > SAP Commerce > SAP Commerce

**Vulnerability Description**

An attacker can modify the SAP Commerce login page URL to inject code that redirects form submissions to an external server. This allows attackers to steal user credentials and gain unauthorized access to user accounts. The vulnerability affects SAP Commerce installations with the OAuth extension enabled (enabled by default).

**Affected Versions**

The vulnerability affects the following SAP Commerce Cloud Patch Release versions:

- 1905.46
- 2005.30
- 2011.25
- 2105.15
- 2205.4

**Solution**

SAP Commerce addresses this vulnerability by sanitizing URL paths and applying HTML output encoding to URLs in the OAuth login page. Customers should apply the relevant patch releases listed above to mitigate this vulnerability.

**Workarounds**

If applying the patch is not immediately possible, consider the following temporary workarounds:

1. **Disable OAuth Extension**
   - Remove the `oauth2` extension from your SAP Commerce installation if not in use.
   - **Side Effects:** This may disrupt functionalities that rely on the OAuth extension, including SmartEdit Module, Assisted Service Module, and integrations with systems like PWA storefronts (e.g., Spartacus).

2. **Filter Suspicious Requests**
   - Implement HTTP request filtering to block URLs containing suspicious patterns.
   - Example directives:
     ```
     RedirectMatch 404 "(.*)&[sS][oO][lL];(.*)"
     RedirectMatch 404 "^(.*[/])?[.][.]([/;].*)?$"
     ```
   - **Side Effects:** May block legitimate custom URLs using specific patterns. Ensure thorough testing before deployment.

**Additional Information**

- **CVSS Score:** 9.6
- **CVSS Vector:** CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H

For more detailed information and to access the patches, visit the [SAP Support Portal](https://me.sap.com/).

**References**

- [CVE-2022-41204](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41204)
- [FAQ on Account Hijacking Vulnerability](https://me.sap.com/notes/3246352)

**Credits**

Information provided with support from [RedRays.io](https://redrays.io).