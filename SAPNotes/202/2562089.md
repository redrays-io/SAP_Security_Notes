2562089 - [CVE-2018-2367] Directory Traversal Vulnerability in ABAP File Interface

### Symptom

ABAP File Interface allows an attacker to exploit insufficient validation of path information provided by users, enabling characters representing 'traverse to parent directory' to pass through to the file APIs.

**Impacts of Directory Traversal Vulnerability:**
- **Confidentiality:** Attacker could read content of arbitrary files on the remote server and expose sensitive data.
- **Integrity:** Attacker could overwrite, delete, or corrupt arbitrary files on the remote server.

### CVSS Information

**CVSS v3 Base Score:** 6.6 / 10  
**CVSS v3 Vector:** AV:N/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H

**Detailed Breakdown:**
- **Attack Vector (AV):** Network (N)
- **Attack Complexity (AC):** High (H)
- **Privileges Required (PR):** High (H)
- **User Interaction (UI):** None (N)
- **Scope (S):** Unchanged (U)
- **Confidentiality Impact (C):** High (H)
- **Integrity Impact (I):** High (H)
- **Availability Impact (A):** High (H)

*SAP provides this CVSS v3 base score as an estimate of the risk posed by the issue reported in this note. This estimate does not take into account your own system configuration or operational environment. It is not intended to replace any risk assessments you are advised to conduct when deciding on the applicability or priority of this SAP security note. For more information, see the FAQ section at [SAP Security Notes](https://support.sap.com/securitynotes).*

### Reason and Prerequisites

This security note is relevant only if file paths have been maintained in the database table **SPTH**.

ABAP applications can use relative paths to access files in or underneath the working directory (DIR_HOME in Transaction AL11). These relative paths can be maintained in the table SPTH and are not converted into absolute paths. This is critical if a relative path breaks out of the working directory. If the corresponding absolute path has been maintained in table SPTH, this SPTH entry will not be used.

### Solution

To change the behavior so that relative paths breaking out of the working directory are converted into absolute paths, follow these steps:

1. **Implement the Correction Instruction:**
   - Apply the correction instructions provided in this [SAP Note 2562089](https://me.sap.com/notes/0002562089) or the corresponding Support Package. Note that for compatibility reasons, the correction itself does not change the behavior; the manual steps outlined below are necessary.

2. **Set Profile Parameter:**
   - Set the profile parameter `abap/path_normalization` (described in [SAP Note 2551541](https://me.sap.com/notes/2551541)) to the value `"ext"`.

3. **Validate and Maintain Paths:**
   - With relative paths now being converted into absolute paths, verify if these paths are already maintained in table SPTH.
   - If missing, maintain these absolute paths in table SPTH using transaction **SM30**.

**Additional Rule for Windows:**
If the ABAP application server runs on Microsoft Windows, a relative path with a drive letter different from the current working directory's drive letter is rejected. This behavior is equivalent to failing the AUTHORITY-CHECK with the authority object 'S_PATH'.

**Using Variables for Paths:**
To facilitate maintaining absolute paths in SPTH, the correction allows the use of variables such as:
- `<P=DIR_INSTANCE>/some_subdir/`
- `<P=DIR_DATA>/Some_Application_<P=_SY_MANDT_>/`

**Supported Variables:**
- DIR_CCMS
- DIR_DATA
- DIR_EXECUTABLE
- DIR_GLOBAL
- DIR_HOME
- DIR_INSTALL
- DIR_INSTANCE
- DIR_LOGGING
- DIR_PERF
- DIR_PROFILE
- DIR_TEMP
- DIR_TRANS
- INSTANCE_NAME
- SAPLOCALHOST
- SAPSYSTEM
- SAPSYSTEMNAME
- _SY_MANDT_

*Values of these variables can be displayed in transactions **RZ11** and **AL11**, except for `_SY_MANDT_`, which represents the client of the user session. Using these variables does not require setting the profile parameter `abap/path_normalization` to `"ext"`.*

### References

- [SAP Note 2551541](https://me.sap.com/notes/2551541) - Metadata for profile parameter abap/path_normalization

### Download Links

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000000279692018)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0002562089?language=en-US&token=518521A4614CA6E97115B8ADE6B0A1BA)

### Credits

Credits to [Redrays](https://redrays.io) for support in providing the information.