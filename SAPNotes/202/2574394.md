2574394 - Configure Diagnostics Agents to Check the Solution Manager Server Certificate

**Description**

Authenticate the Solution Manager at the Diagnostics Agent and prevent man-in-the-middle attacks.

This note describes how to set up the connection between Diagnostics Agents and the Solution Manager for the highest possible connection security by using standard TLS mechanisms. It also specifies how to verify the server's identity using X509 certificates and manage trusted Certificate Authorities (CAs).

**Solution**

**1. Preparing the AS Java**
1. Configure SSL on the AS Java as described in [KBA 1770585](https://me.sap.com/notes/0001770585).
2. Configure the P4S port for the J2EE NetWeaver Application Server per [KBA 2419031](https://me.sap.com/notes/2419031). Verify the configuration by following [KBA 2268643](https://me.sap.com/notes/2268643).

**2. Setup Server Authentication**
1. Start the Solution Manager Launchpad by transaction **SM_WORKCENTER**.
2. Click the **Agents Administration** tile to open the **Agent Framework** application.
3. Click **Agent Admin â€“ All Agents** to start the **Agent Administration** application.
4. **Enable secure P4 connections**
   - Go to the **Agent Connectivity** tab, select **MS/P4 SSL** for all or selected Diagnostics Agents, and click **Apply** or **Apply for All**.
5. **Upload the CA to the Diagnostics Agents**
   - If the server certificate is signed by a CA not known to the agent, upload it to the agent's key store by going to the **Agent Security** tab, selecting the relevant Diagnostics Agents, and clicking **Update list of trusted CAs**.
6. **Enable server authentication**
   - Switch maintenance mode on: Go to the **Agents** tab and click **Maintenance Mode On**.
   - Enable server verification: Go to the **Agent Security** tab, click **Refresh**, ensure the **P4S Status** is green, and click **Enable SSL Certificate Verification**.
   - Switch maintenance mode off: Go to the **Agents** tab and click **Maintenance Mode Off**.
7. **Verify Security State**
   - Check the current security state of each Diagnostics Agent in the **Agent Security** tab under **Agent Security Configuration**. Server authentication is active if there is a **Yes** in the corresponding row.

**References**
- [How to configure the P4S port for the J2EE NetWeaver Application Server (KBA 2419031)](https://me.sap.com/notes/2419031)
- [How to Configure the P4S Port with SAP Solution Manager 7.2 (KBA 2268643)](https://me.sap.com/notes/2268643)
- [How to configure SSL on the AS Java (KBA 1770585)](https://me.sap.com/notes/0001770585)

**Download and Print**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000001159112018)
- [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0002574394?language=en-US&token=3EA061856B7F17D3A5237C1451EF13DF)

*Credits to [redrays.io](https://redrays.io) for supporting the provision of this information.*