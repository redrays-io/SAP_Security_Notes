SAP Security Note 1902162: Code Injection Vulnerability in CRM-MKT-EAL

**SAP Security Note 1902162 - Code Injection Vulnerability in CRM-MKT-EAL**

**Symptom**
CRM-MKT-EAL contains code that permits the execution of arbitrary program code of the user's choice. An attacker can control the behavior of the system or potentially escalate privileges by executing malicious code without having legitimate credentials.

**Reason and Prerequisites**
The program code allows defining and executing user-defined code that changes the system's behavior. A valid and authenticated user is required. Depending on the code, a user can:
- Inject and run their own code
- Obtain additional information that should not be displayed
- Modify or delete data
- Modify the system's output
- Create new users with higher privileges
- Perform a denial of service attack

**Solution**
With the correction of this note, the following changes are made to the process of creating and using mapping formats in external list management:

1. **Authorization Enhancements**
   - Mapping rules of type 'Code' can now only be edited or activated if the user has the necessary authorizations.
   - Users must have authorization `S_DEVELOP` for object type `MFCD`, object name `MF_CODE`, and activity `02` to enter ABAP code.
   - Activation of mapping rules of type 'Code' requires authorization `CRM_MAP_FM` with activity `63`.

2. **Process Changes**
   - The Edit button for mapping rules is now only enabled for authorized users.
   - An Activate button has been added to ensure that only active mapping rules can be used for uploading external lists.
   - Existing mapping formats with mapping rules of type 'Code' will become inactive after implementing this note and need to be manually activated.

**Manual Activities**
Detailed manual activities include creating DDIC elements, data elements, enhancing structures, creating messages, program texts, persistency mappings, OTR texts, and enhancing authority objects. These steps are crucial for implementing the security measures described.

**Download and Resources**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000011238212017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0001902162?language=en-US&token=97A4672A68FF359A6570959C8FF4A538)
- [Compare Versions](https://me.sap.com/notesLatestChanges/0001902162/E/diff)
- [Edit Note](https://me.sap.com/sap/support/notes/edit/0001902162)
- [Show Changes](https://me.sap.com/notesLatestChanges/0001902162/E/diff)

**Prerequisites**
Ensure that the following SAP Notes are implemented before applying this security note:
- [SAP Note 1505757](https://me.sap.com/notes/1505757) - Fields cannot be mapped in Productive Systems
- [SAP Note 1902162](https://me.sap.com/notes/1902162) - Code injection vulnerability in CRM-MKT-EAL

**Side Effects**
After implementing this note, existing mapping formats with mapping rules of type 'Code' will become inactive and must be manually activated. Ensure that users activating these rules have the appropriate authorizations.

**CVSS Score**
Currently, there is no CVSS score assigned to this vulnerability.

For more detailed information and support, visit the [SAP Support Portal](https://me.sap.com/).

*Credits to [Redrays.io](https://redrays.io) for providing the information.*