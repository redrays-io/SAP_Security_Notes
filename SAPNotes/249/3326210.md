SAP Security Note 3326210 - [CVE-2023-30743] Improper Neutralization of Input in SAPUI5

**Symptom**

**UPDATE 13th June 2023**: This note has been re-released with updated 'Solution' and 'Workaround' information.

Due to improper neutralization of input in SAPUI5, the `sap.m.FormattedText` control allows injection of untrusted CSS. This blocks userâ€™s interaction with the application. Additionally, without URL validation by the application, the vulnerability could enable attackers to read or modify user information through phishing attacks.

**Other Terms**

CSS injection, Clickjacking, SAPUI5, [CVE-2023-30743](https://www.cve.org/CVERecord?id=CVE-2023-30743)

**Reason and Prerequisites**

The issue arises from insufficient CSS sanitization.

**Solution**

The affected `sap.m.FormattedText` SAPUI5 control has added the necessary restrictions to existing sanitization.

To apply this SAPUI5 fix on an AS ABAP system, refer to the following table:

| SAP_UI | SAPUI5  |
|--------|---------|
| 750    | 1.38.61 |
| 754    | 1.71.56 |
| 755    | 1.84.34 |
| 756    | 1.96.21 |
| 757    | 1.108.13 |
| 758    | 1.114.0 |

**Other SAPUI5 versions receiving the fix:**
- 1.102.19
- 1.111.3
- 1.113.0 and above

For NetWeaver Java systems, update to `UISAPUI5JAVA26P_2-80000708.SCA` or higher versions. Fixes are delivered only for supported SAPUI5 versions and the latest released service pack. SAPUI5 JAVA SCA 7.50 is release independent. The SAPUI5 SCA 7.50 service pack release can be installed on the same or lower SP level of a NetWeaver 7.50-based JAVA system.

**Workaround**

Please assess the applicability of the workaround for your SAP landscape before implementation. Note that this workaround is a temporary fix and not a permanent solution. SAP strongly recommends applying the corrections outlined in the security note, either instead of or after implementing the workaround.

A workaround is available only if you are developing custom UI5 applications and should be applied by your development team. No workaround is available for standard SAPUI5 applications.

**Workaround Steps:**
- Sanitize by removing the values of the `style` and `class` attributes in the HTML input of `sap.m.FormattedText` control and the following controls:
  - `sap.m.FormattedText`: Sanitize the `htmlText` property.
  - `sap.m.FeedListItem`: Sanitize the `text` property.
  - `sap.m.IllustratedMessage`: Sanitize the `description` property if `enableFormattedText` is enabled.
  - `sap.m.InputBase` (and all subclasses): Sanitize the `formattedValueStateText` property.

If unsure whether your application uses these controls, sanitize any untrusted HTML set as data input to the UI5 controls layer of your application.

**CVSS**

- **Score:** 7.1
- **Vector:** [CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L](https://nvd.nist.gov/vuln-metrics/cvss)

**Affected Software Components:**
- SAP_UI: Releases 750 to 758
- UI_700: Release 200

**References**
- [How to upgrade the SAPUI5 library in Java](https://me.sap.com/notes/2426484)
- [ABAP SAPUI5 patch version update](https://me.sap.com/notes/3155948)

**Download Links:**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000000555842023)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0003326210?language=en-US&token=071157F5E2E9CB141D17FDAAC598CE4A)

For more details, visit the [SAP Support Portal](https://me.sap.com/).

*Credits to [redrays.io](https://redrays.io) for support in providing this information.*