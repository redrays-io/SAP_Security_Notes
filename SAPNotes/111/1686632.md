SAP Security Note 1686632 - Positive Lists for RFC Callback

**SAP Security Note 1686632 - Positive Lists for RFC Callback**

A new SAP Security Note addressing vulnerabilities related to RFC callbacks has been released. This update is crucial for ensuring that your SAP systems are protected against potential unauthorized executions via RFC callbacks.

**Symptom**

When using a synchronous RFC in ABAP, function modules can potentially execute remote-enabled modules in the context of the RFC caller. This is only possible if the caller has the necessary RFC authorizations and the callback hasn't been prohibited by RFC_CALLBACK_REJECTED (see [SAP Note 1515925](https://me.sap.com/notes/1515925)).

**CVSS Information**

- **Base Score:** 6.0
- **Vector:** AV:N/AC:M/AU:S/C:P/I:P/A:P

**Reason and Prerequisites**

The vulnerability arises when using the ABAP statement `CALL FUNCTION <func> DESTINATION <DEST>` to call a synchronous RFC. This can allow an attacker to execute unauthorized function modules if proper authorizations are not in place.

**Solution**

There are two solutions based on your SAP_BASIS and Kernel versions:

### a) For SAP_BASIS 7.00 and later with Kernel 7.21 or higher:

- **Implement configurable whitelists:** Determine required configuration through the log mechanism.
- **Configuration:** Adjust the dynamic profile parameter `rfc/callback_security_method` with values ranging from 0 (Emergency mode) to 3 (Most secure mode).
- **Additional Steps:** 
  - Create necessary ABAP Dictionary objects.
  - Apply manual activities as per the correction instructions.

### b) For SAP_BASIS 6.20 and 6.40 with Kernel 6.40, or SAP_BASIS 7.00 to 7.31 with Kernel 7.20:

- **Modify program source code:** Whitelisting via configuration is not possible; source code modifications are required.
- **Configuration:** Adjust the dynamic profile parameter `rfc/reject_callback` with values 0 to 2 to control RFC callback behavior.

**Download and Resources**

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000010019052017)
- [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0001686632?language=en-US&token=C2FDF5AF4B11A10EB34A9D25818CE6B1)

**References**

For detailed steps and additional information, refer to the following SAP Notes:

- [SAP Note 2102941](https://me.sap.com/notes/2102941) - Update 1 to Security Note 1686632
- [SAP Note 2058946](https://me.sap.com/notes/2058946) - Maintenance of callback positive lists before Release 7.40
- [SAP Note 2002096](https://me.sap.com/notes/2002096) - Wrong originally called function in RFC callback check
- [SAP Note 1968729](https://me.sap.com/notes/1968729) - SAL: Message definition for RFC callback
- [SAP Note 1515925](https://me.sap.com/notes/1515925) - Preventing RFC callbacks during synchronous RFC

**Prerequisites**

Ensure that your system meets the following kernel requirements before applying the solutions:

- **Solution A:** Kernel with at least patch levels 7.21 SP 321, 7.41 SP 044, or 7.42 SP 009.
- **Solution B:** Kernel with at least patch levels 6.40 SP 422 or 7.20 SP 217.

**Impact**

Implementing these measures will significantly reduce the risk of unauthorized RFC callbacks, strengthening the security posture of your SAP environment.

**Credits**

Thanks to [Redrays.io](https://redrays.io) for supporting the provision of this information.