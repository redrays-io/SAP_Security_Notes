1687334 - Potential information disclosure XML Encrypted SOAP messages

**Symptom**
An attacker can discover information related to XML Encrypted SOAP messages sent to NW ABAP. This information could be leveraged to tailor attacks specifically against XML Encrypted SOAP messages. Refer to the publication by Tibor Jager and Juraj Somorovsky, ["How To Break XML Encryption"](https://me.sap.com/notes/0001687334), presented at the 18th ACM Conference on Computer and Communications Security (CCS), 2011.

**CVSS Information**
- **Base Score:** 4.3
- **Vector:** AV:N/AC:M/AU:N/C:P/I:N/A:N

**Reason and Prerequisites**
- **Affected Systems:** Web services configured to use XML Encryption in NW ABAP. Note that web services utilizing SSL are not impacted by this issue.

**Solution**
- **For NW ABAP 7.20:** The correction provided disables the use of XML Encryption in web services.
- **For Other Releases:** 
  1. **Check for Usage of XML Encryption:** Use the report [WSS_ENCRYPTION_CHECK](https://me.sap.com/corrins/0001687334/41) attached to this note to verify if your system is utilizing XML Encryption.
  2. **Apply Corrections:** If your system is affected, follow the [correction instructions](https://me.sap.com/corrins/0001687334/41) provided in this note.
  3. **Alternative Mitigation:** Reconfigure the affected web services to use SSL for transport protection instead of XML Encryption.

**Attachments**
- [WSS_ENCRYPTION_CHECK.txt](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000186132012&iv_version=0009&iv_guid=5C39C2C88B300E4FAFC3D53BA83A2C7A)

**References**
- This document is referenced by [2728308 - SRT: Error in WSRM Soap Application](https://me.sap.com/notes/2728308).

**Validity**
Applicable to the following SAP_BASIS software components:
- Versions 700 to 731
- Specific support packages include SAPKB70027, SAPKB70028, SAPKB70112, SAPKB70212, SAPKB71015, SAPKB71016, SAPKB71110, SAPKB72008, SAPKB73008, SAPKB73105, and SAPKB73104.

**Correction Instructions**
1. **Change Structure SEC_DSIG_SIGNATURE:**
   - Transaction SE11
   - Add new component:
     - **Field Name:** C14N_SIGNEDINFO
     - **Data Type:** RAWSTRING
   - Activate the structure (ignore warnings).

2. **Create Database Table SEC_ST_REPLAY_DB:**
   - Transaction SE11
   - Table for replay detection
   - Transparent table, Package: SOAP_SECURITY, Delivery class: L, Data class: APPL1, Size category: 3
   - Define fields: ID, TR_ID, LOCATION, CREATED, EXPIRES, UNAME
   - Activate the table (ignore warnings).

3. **Create/Change Messages WSS 019 and WSS 051:**
   - Transaction SE80
   - Package: SOAP_SECURITY - Message class WSS
   - Define:
     - **019:** 'Signature check failed - WP: &1 SSF_PAB: &2'
     - **051:** 'XML decryption key &1 found in SEC_ST_REPLAY_DB'

4. **Create Texts for Reports:**
   - **Report WSS_SETUP (Transaction SE38):**
     - Text symbol 002 = WS Security Options
     - Selection text C_CBC = Detect XML CBC attack
   - **Report WSSE_TOKEN_CACHE_CLEANUP:**
     - Selection text LIFETIME = Lifetime in sec

**Credits**
Thanks to [redrays.io](https://redrays.io) for supporting the provision of this information.