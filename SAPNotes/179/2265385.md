2265385 - Switchable authorization checks for RFC in Product Catalog

**SAP Note Number**: 2265385  
**Type**: SAP Security Note  
**Version**: 2  
**Recency**: Updated  
**Language**: English  
**Master Language**: English  
**Category**: Program error  
**Priority**: Correction with medium priority  
**Status**: Released for Customer  
**Released On**: 22.12.2016  
**Component**: Internet Sales Catalog (CRM-ISA-CAT)

### Title
**2265385 - Switchable authorization checks for RFC in Product Catalog**

### Description
#### Symptom
This SAP note describes new switchable authorization checks for RFC function modules in Product Catalog.

#### Other Terms
SACF, RFC, authorization, PCT, PCAT, CAT, Catalog, Product Catalog.

#### Reason and Prerequisites
Remote calls to RFC function modules are protected by checks on the authorization object `S_RFC`. Authorizations for `S_RFC` must be limited to the required minimum authorizations for all users to ensure system security. Many RFC function modules can be sufficiently protected using `S_RFC` authorization checks. These RFC function modules often do not perform additional functional authorization checks. Please see [SAP note 2008727](https://me.sap.com/notes/2008727) for further information on RFC Security.

It was identified that `S_RFC` authorization checks might not be sufficient to ensure secure execution for RFC function modules covered by this note. Activate new switchable authorization checks and update corresponding roles if these RFC function modules are included in `S_RFC` authorizations in your system.

#### Solution
New switchable authorization checks have been implemented. The checks are delivered inactive to ensure compatibility with your running processes. The checks can be activated in transaction SACF as described in attached manual correction instruction. See [note 1922808](https://me.sap.com/notes/1922808) for additional information on the switchable authorization check framework (SACF).

**New authorization scenario(s)**
The following new authorization scenarios can be maintained in transaction SACF after implementation of this SAP note.

| Scenario | Description |
|----------|-------------|
| CRM_PCAT_1 | Authorization Check for Product Catalogs (1) |

The authorization objects `COM_PCAT` and `COM_PC_LOC` are used to check the proper authorization of the user for the respective functions.

**Affected business processes and roles**

| Scenario | Description |
|----------|-------------|
| CRM_PCAT_1 | API function modules used by different product Catalog functionalities. |

**Affected RFC function modules**

A comprehensive list of RFC function modules affected by this note along with their respective authorization objects and parameters is available in the [attachment](https://me.sap.com/userapps/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000073352016&iv_version=0002&iv_guid=6CAE8B27F67B1ED682F3CF368A114D2A).

**Implementation of the switchable authorization check**

The switchable authorization scenario and the switchable authorization checks are provided via support package. They can be technically pre-implemented via correction instructions. After technical implementation via support package or correction instructions, the checks remain inactive until manual activation.

**Activation of the switchable authorization check**

Follow the post-processing activities below after technical implementation to activate the authorization checks.

1. **Create the authorization scenario definition in older support packages (transported in your landscape):**
    - Start transaction `SACF` and check if scenario definition `CRM_PCAT_1` exists. If it exists, go to step 2.
    - If the scenario definition does not exist in `SACF`, download the file `CRM_PCAT_1.txt` attached to this note.
    - Start transaction `SACF_TRANSFER`.
    - Select radio button "Upload", select work area "Scenario Definition", deselect work area "Productive Scenarios", deselect "Test Mode", and execute (F8).
    - Choose the file `CRM_PCAT_1.txt` and confirm upload.
    - Assign the scenario definition `CRM_PCAT_1.txt` to development package `COM_PRDCAT`.

2. **Create the productive authorization scenario from the scenario definition (transported in your landscape):**
    - Start transaction `SACF`, select "Scenario Definition", select the "Scenario Name" described above, and execute (F8).
    - Double-click on the scenario definition and press the button "Scenario" (or press F5) to transfer the scenario definition to a productive scenario.
    - Choose the initial scenario status "Active" or "Logging".
        - **Active**: Activates the authorization check and logging to Security Audit Log in the current system and all systems where the productive scenario will be transported to.
        - **Logging**: Activates logging to Security Audit Log in the current system and all systems where the productive scenario will be transported to. In status "Logging," the authorization check will always pass irrespective of the actual user authorizations. You can use this status to identify users that require the authorizations that are being checked.
    - Using report `RSAU_SELECT_EVENTS`, identify users that require authorizations due to the authorization scenario. Analyze message IDs `DUO` (Authorization check on object &A in scenario &B successful) and `DUP` (Authorization check on object &A in scenario &B failed).

3. **Activate logging of SACF relevant audit messages in the Security Audit Log (not transported, configuration required in all systems of your landscape):**
    - Ensure that Security Audit Log is activated in transaction `SM19`, tab "Kernel Parameters."
    - Activate the following message IDs in a static Security Audit Log configuration:
        - `DUO` (Authorization check on object &A in scenario &B successful)
        - `DUP` (Authorization check on object &A in scenario &B failed)
        - `DUQ` (Active scenario &A for switchable authorization check was changed - &B)

4. **Adjust your roles to provide those users with the authorizations that require them due to the new authorization scenario:**
    - Using report `RSAU_SELECT_EVENTS`, identify users that require authorizations due to the authorization scenario. Analyze by individual "Events (Audit Messages)" `DUO` and `DUP`.
    - Authorization checks for productive authorization scenarios with status "Active" or "Logging" can also be analyzed using the system trace for authorizations (transactions `STAUTHTRACE` or `ST01`).

5. **Maintain RFC Function Modules default values:**
    - Start transaction `SU22`, and for standard selection choose application type "RFC Function Module" and Function Module `COM_PCAT_CVIEW_UNLOCK`, and execute (F8).
    - Check if the authorization object `COM_PCAT` with default value `(ACTVT=02)` exists. If not, switch to edit mode, add the authorization object `COM_PCAT`, and set the default authorization value.
    - Repeat the above steps for each affected function module listed in the [manual activities](https://me.sap.com/corrins/0002265385/63).

### References
- [SAP Note 2008727](https://me.sap.com/notes/2008727): RFC Security
- [SAP Note 1922808](https://me.sap.com/notes/1922808): Switchable Authorization Check Framework (SACF)

### Valid Software Components
| Software Component | From | To |
|--------------------|------|----|
| BBPCRM             | 700  | 700|
| BBPCRM             | 701  | 701|
| BBPCRM             | 702  | 702|
| BBPCRM             | 712  | 712|
| BBPCRM             | 713  | 713|
| BBPCRM             | 714  | 714|

### Support Packages
| Software Component Version | Support Package | URL |
|----------------------------|-----------------|-----|
| BBPCRM 700                 | [SAPKU70018](https://me.sap.com/supportpackage/SAPKU70018) |  
| BBPCRM 701                 | [SAPKU70115](https://me.sap.com/supportpackage/SAPKU70115) |  
| BBPCRM 702                 | [SAPKU70217](https://me.sap.com/supportpackage/SAPKU70217) |  
| BBPCRM 712                 | [SAPKU71210](https://me.sap.com/supportpackage/SAPKU71210) |  
| BBPCRM 713                 | [SAPKU71312](https://me.sap.com/supportpackage/SAPKU71312) |  
| BBPCRM 714                 | [SAPK-71402INBBPCRM](https://me.sap.com/supportpackage/SAPK-71402INBBPCRM) |  

### Correction Instructions
| Software Component | Number of Correction Instructions | URL |
|--------------------|------------------------------------|-----|
| BBPCRM             | 5                                  | [Corr. Instructions](https://me.sap.com/corrins/0002265385/63) |

### Attachments
- [CRM_PCAT_1.txt](https://me.sap.com/userapps/support/sapnotes/public/services/attachment.htm?iv_key=012006153200000073352016&iv_version=0002&iv_guid=6CAE8B27F67B1ED682F3CF368A114D2A) (527 bytes, text/plain)

### Preconditions
- **Software Component**: BBPCRM
- **Valid From/To**: Various releases from 600 to 714
- **Relevant SAP Notes**:
    - [1289052](https://me.sap.com/notes/1289052): Long text is reordered when maintaining it with webcatadmin
    - [1429806](https://me.sap.com/notes/1429806): Product Catalog: LOG: no filtering on XML-Export logs
    - [1780398](https://me.sap.com/notes/1780398): Short dump when updating prices in CRM WEB UI
    - [2236076](https://me.sap.com/notes/2236076): Architectural change to avoid syntax errors when calling CL_RFC=>CHECK_EXTERNAL and CL_SACF=>AUTH_CHECK_SPEC
    - [2265385](https://me.sap.com/notes/2265385): Switchable authorization checks for RFC in Product Catalog

### CVSS
- **Score**: 0
- **Vector**: Not Defined

### Rating
- **Helpful Yes**: 0 people
- **Quality AVG**: 0.0
- **Quality Votes**: 0

### Side Effects
- **Solves Side Effects**: None
- **Causes Side Effects**: None

---

*Credits to [Redrays](https://redrays.io) for support in providing this information.*