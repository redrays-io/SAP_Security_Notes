2407694 - SAP Web IDE for SAP HANA: Unauthorized remote data tampering and DOS attack

**Symptom**

**SAP Web IDE for SAP HANA internal npm registry (Sinopia) allows default user creation**

- An attacker could create a new user and use it to publish new packages.
- **Tampering:** An attacker could publish a malicious version of an existing package. If an application retrieves the latest version without checking for specific versions, it might load the malicious one.
  
  *Note:* In general, data in the SAP HANA database is not affected by this vulnerability. **Exception:** Database data in self-developed applications can be tampered with.
  
- **DoS:** A malicious Sinopia user may fill a mount assigned as a file system service for the XS advanced application `di-local-npm-registry`, possibly crashing the application in process. If the file system used by the mount is in use by other mounts, other SAP HANA components could be potentially impacted. Additionally, it might not be possible to create new content in SAP Web IDE for SAP HANA.

**DoS Attack:** 
- Sinopia crashes on publish if a package name contains special characters. The crash impacts build functionality in SAP Web IDE for SAP HANA.

---

**CVSS Information**

| Metric                        | Value               |
|-------------------------------|---------------------|
| Attack Vector (AV)            | Network (N)         |
| Attack Complexity (AC)        | Low (L)             |
| Privileges Required (PR)      | None (N)            |
| User Interaction (UI)         | None (N)            |
| Scope (S)                     | Changed (C)         |
| Confidentiality Impact (C)    | Low (L)              |
| Integrity Impact (I)          | Low (L)              |
| Availability Impact (A)       | Low (L)              |
| **Base Score**                | **8.3 / 10**        |
| **CVSS Vector**               | **AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L** |

*SAP provides this CVSS v3 base score as an estimate of the risk posed by the issue reported in this note. This estimate does not take into account your own system configuration or operational environment. It is not intended to replace any risk assessments you are advised to conduct when deciding on the applicability or priority of this SAP security note. For more information, see the FAQ section at [https://support.sap.com/securitynotes](https://support.sap.com/securitynotes).*

---

**Reason and Prerequisites**

Direct network access to SAP HANA XS advanced applications is the only requirement to exploit this vulnerability.

This vulnerability is only relevant in systems that have both SAP HANA XS advanced and SAP Web IDE for SAP HANA installed. The SAP HANA Web-based Development Workbench based on SAP HANA XS classic is not affected.

---

**Solution**

To address both issues:

1. **Block the npm registry (sinopia) from registering new users.** This prevents any new users from publishing packages, thereby blocking malicious use of the vulnerability.
   
   *No intended functionality is affected by this workaround.*

2. **Update to the fixed versions:**
   - SAP Web IDE for SAP HANA 1.00 SPS 12 Patch 6 (for SAP HANA 1.00 SPS 12)
   - SAP HANA 2.0 SPS 00 Patch 2 (for SAP HANA 2.00 SPS 00)
   
   *Note:* SAP Web IDE for SAP HANA can be updated independently of SAP HANA XS advanced, so there is no need to update your SAP HANA database.

---

**How to find out if your system has been attacked using this vulnerability:**

1. **Connect to the target machine using SSH** (use PuTTY or similar utility).
2. **Log on to xs with the CLI:**
   ```bash
   xs login -a https://<hostname>:3<instance number>30 -u <xs_username> -p <xs_password> -o <org> -s <space> --skip-ssl-validation
   ```
3. **Find sinopia config files:**
   ```bash
   xs logs di-local-npm-registry --all | grep config
   ```
   *Example Output:*
   ```
   <time/date>[APP/4-2] OUT   warn --- config file - /usr/sap/hana/shared/XSA/xs/ea_data/<hostname>/executionroot/<generated-uuid>/app/sinopia/config.yaml
   ```
4. **Navigate to the sinopia folder:**
   ```bash
   cd /usr/sap/hana/shared/XSA/xs/ea_data/<hostname>/executionroot/<generated-uuid>/app/sinopia
   ```
5. **Check current internal repository users:**
   ```bash
   cat htpasswd
   ```
   *If the file is not empty, it indicates user definitions in sinopia, suggesting a successful attack.*
6. **Check the last modified time of the file:**
   ```bash
   expr $(date +%s) - $(date +%s -r htpasswd)
   ```
   *If the time differs from when webide/di-core were deployed, a new user was likely defined recently.*

---

**Temporary Workaround:**

To manually block new user registration:

1. **Navigate to the sinopia config folder:**
   ```bash
   cd /usr/sap/hana/shared/XSA/xs/ea_data/<hostname>/executionroot/<generated-uuid>/app/sinopia
   ```
2. **Change file ownership and permissions:**
   ```bash
   sudo chown root htpasswd
   sudo chmod go-w htpasswd
   ```

*Note:* This workaround is only valid as long as the `di-local-npm-registry` XS advanced application is not restarted. Executing `xs restart di-local-npm-registry` will disable the change, and you will need to reapply it.

---

For more details, refer to the official SAP Security Note [2407694](https://me.sap.com/notes/2407694).

*Credits to [https://redrays.io](https://redrays.io) for support in providing this information.*