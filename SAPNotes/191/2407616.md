2407616 - Remote Code Execution vulnerability in SAP GUI for Windows

**Symptom**

**UPDATE 7th April 2017**: This note has been re-released with updated textual information.

Under certain conditions, *SAP GUI for Windows* allows an attacker to execute commands remotely which would otherwise be restricted by security policy.

Some well-known impacts are:
- Remote exploitation
- Bypass of security

**CVSS Information**

- **CVSS v3 Base Score**: 8.0 / 10
- **CVSS v3 Base Vector**:
  - **Attack Vector (AV)**: Network (N)
  - **Attack Complexity (AC)**: High (H)
  - **Privileges Required (PR)**: High (H)
  - **User Interaction (UI)**: None (N)
  - **Scope (S)**: Changed (C)
  - **Confidentiality Impact (C)**: High (H)
  - **Integrity Impact (I)**: High (H)
  - **Availability Impact (A)**: High (H)

SAP provides this CVSS v3 base score as an estimate of the risk posed by the issue reported in this note. This estimate does not take into account your own system configuration or operational environment. It is not intended to replace any risk assessments you are advised to conduct when deciding on the applicability or priority of this SAP security note. For more information, see the FAQ section at [SAP Security Notes](https://support.sap.com/securitynotes).

**Other Terms**
- SAP GUI; saprules.xml; SAP GUI Security Module

**Reason and Prerequisites**

SAP strongly recommends activating the SAP GUI Security Module to protect the client PC from attacks being run via compromised SAP systems. Without an activated SAP GUI Security Module, there is no protection against the attack addressed in this SAP Security Note.

The SAP GUI Security Module uses a configuration file called `saprules.xml` that can be deployed via dedicated mechanisms described in [SAP Note 1768979](https://me.sap.com/notes/1768979) and the SAP GUI Security Guide ([Link](https://me.sap.com/documents/2016/06/047de85d-7a7c-0010-82c7-eda71af511fa.html)).

**Solution**

With the SAP GUI Security Module activated and the correction below implemented, the affected system component no longer allows bypass of security. The user needs to provide confirmation of any such activity performed.

To apply the correction, follow one of these procedures:

1. **Using a dedicated `saprules.xml`**:
   - Remove the specified entries from your `saprules.xml` and deploy the new version. Note that the "rule id" number may vary.
   - This solution can also be used for SAP GUI for Windows releases 7.20 and 7.30 (even though these releases are out of maintenance and SAP strongly recommends upgrading to a newer release).

   ```xml
   <rule id="3">
      <files>
         <name>*/regsvr32.exe</name>
         <name>*/regedt32.exe</name>
         <name>*/regedit.exe</name>
      </files>
      <enabled>1</enabled>
      <action>3</action>
      <contexts>
         <context>
            <system>*</system>
            <network></network>
            <client>*</client>
            <transaction>*</transaction>
            <dynpro_name>*</dynpro_name>
            <dynpro_num>*</dynpro_num>
            <action>0</action>
         </context>
         <context>
            <system>*</system>
            <network>?*</network>
            <client>*</client>
            <transaction>*</transaction>
            <dynpro_name>*</dynpro_name>
            <dynpro_num>*</dynpro_num>
            <action>1</action>
         </context>
      </contexts>
   </rule>
   ```

2. **If not using a dedicated `saprules.xml`**:
   - Download patch level 12 or a newer patch for SAP GUI for Windows 7.40 and apply this patch to all workstations.
   - All SAP GUI patches are available on the [SAP Support Portal](https://me.sap.com/). Detailed information about the location of the patches can be found in [SAP Note 563161](https://me.sap.com/notes/563161). [SAP Note 330793](https://me.sap.com/notes/330793) explains how to download patches from the SAP Support Portal.

**Installation of SAP GUI for Windows patches**

The installation of SAP GUI for Windows patches is documented in the [SAP GUI Installation Guide](https://me.sap.com/docs/DOC-25456). Alternatively, [SAP Note 535308](https://me.sap.com/notes/535308) also contains information on how to apply SAP GUI for Windows patches.

**Credits**

Thanks to [redrays.io](https://redrays.io) for supporting the provision of this information.