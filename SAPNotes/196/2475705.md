2475705 - Switchable Authorization checks for RFC in In House Cash

**SAP Security Note 2475705 - Switchable Authorization checks for RFC in In House Cash**

### Symptom
`S_RFC` authorization checks are not sufficient to ensure secure execution of RFC function modules covered by this SAP Note. New switchable authorization checks have been implemented for RFC function modules in the In House Cash application.

### Other Terms
- SACF
- RFC
- Authorization
- IHC
- Switchable

### Reason and Prerequisites
Remote calls to RFC function modules are by default protected by checks on the authorization object `S_RFC`. These checks must not be deactivated. Refer to [SAP Note 2216306](https://me.sap.com/notes/2216306) for recommended and deprecated settings of profile parameter `auth/rfc_authority_check`.

Ensure that authorizations for `S_RFC` are limited to the required minimum for all users to maintain system security. While many RFC function modules can be sufficiently protected using `S_RFC` authorization checks, additional functional authorization checks may not be performed. Refer to the white paper "[Securing Remote Function Calls (RFC)](https://www.sap.com/documents/2015/07/e6441a8d-5b7c-0010-82c7-eda71af511fa.html)" attached to [SAP Note 2008727](https://me.sap.com/notes/2008727) for further information on RFC Security.

It was identified that `S_RFC` authorization checks might not be sufficient for RFC function modules covered by this note. Activate new switchable authorization checks and update corresponding roles if these RFC function modules are included in `S_RFC` authorizations in your system.

### Solution
New switchable authorization checks have been implemented. These checks are delivered inactive to ensure compatibility with your running processes. They can be activated in transaction `SACF` as described in the attached manual correction instructions. Refer to [SAP Note 1922808](https://me.sap.com/notes/1922808) for additional information on the switchable authorization check framework (SACF).

#### New Authorization Scenario
The following new authorization scenarios can be maintained in transaction `SACF` after implementation of this SAP Note:

- **IHC_PN** - In House Cash Payment Order and Item actions
- **IHC_PRQ** - IHC: Payment Request actions and Document Reversal

#### Affected RFC Function Modules
- `BKK_IHB_BASTA_IN_POST`
- `IHC_APPL_XBS_POST`
- `IHC_PROC_PN_POLLING_VIA_IDOC`
- `IHC_PAYRQ_RESET_CLEARING`
- `IHC_PN_CANCEL`
- `IHC_PROCESS_2810`

#### Authorization Objects Used
- `F_PAIT_ACT`
- `IHC_ACTION`
- `F_BKPF_BLA`
- `F_PAYRQ`

#### Implementation Steps

**Switchable Authorization Scenario Implementation:**

1. **Create Scenario Definition:**
   - Start transaction `SACF` in the development system and check if the scenario definition `IHC_PN` exists.
   - If it does not exist, download the `IHC_PN.txt` file attached to this note.
   - Start transaction `SACF_TRANSFER`.
   - Select the radio button "Upload", choose the work area "Scenario Definition", deselect "Productive Scenarios" and "Test Mode", then execute (F8).
   - Choose the `IHC_PN.txt` file and confirm the upload.
   - Assign the scenario definition `IHC_PN` to the development package `FIN_IHC`.

2. **Activate Switchable Authorization Checks:**
   - Individual activation is done by creating productive authorization scenarios from scenario definitions in transaction `SACF`.
   - Refer to [SAP Note 1922808](https://me.sap.com/notes/1922808) section [4] for ensuring authorized users have all required authorizations and how to activate the checks.
   - Collective maintenance of authorization scenarios is performed after system updates using transaction `SACF_COMPARE`.

**Message Creation:**

- Go to transaction `SE91`.
- Check if message numbers 650 and 651 for Message Class '1Q' are present.
- If not, follow these steps:
  - For Message Class '1Q', Message number 650:
    - Click 'Change'.
    - Enter the text "Missing authorization to execute External RFC (Module: &)".
    - Save and return.
  - For Message Class '1Q', Message number 651:
    - Click 'Change'.
    - Enter the text "Missing authorization for user & to perform activity & (Object &)".
    - Save and return.
- Repeat similar steps for Message Class 'IHC', Message numbers 850 and 851.

### Preconditions
Ensure the following software components and versions are in place:

- **EA-FINSERV**
  - Versions: 600, 603, 604, 605, 606, 616, 617, 618, 800
  - SAP Note: [2475705](https://me.sap.com/notes/2475705) for various components

- **S4CORE**
  - Versions: 101 to 102
  - SAP Note: [2475705](https://me.sap.com/notes/2475705)

- **SAP_BASIS**
  - Versions: 700, 701, 702, 731, 740, 750-751
  - Relevant SAP Notes: [1988903](https://me.sap.com/notes/1988903), [2449051](https://me.sap.com/notes/2449051)

### CVSS
- **Score:** 6.3
- **Vector:** CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L

### Rating
*No ratings yet.*

### Side Effects
- **Solves:** None
- **Causing:** None

For more details, download the attachments:
- [IHC_PN.TXT](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=002075125900001276782017&iv_version=0002&iv_guid=001999D61DA01ED7B286B5439B7060C6)
- [IHC_PRQ.TXT](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=002075125900001276782017&iv_version=0002&iv_guid=6CAE8B28C73B1ED7B286B5CA3625A0C8)

---

*Credits to [RedRays](https://redrays.io) for supporting and providing the information.*