2878030 - [CVE-2020-6191] Missing Input Validation in SAP Landscape Management

**Symptom**

An attacker with admin privileges could run malicious executables with root privileges in SAP Host Agent via SAP Landscape Management due to missing input validation.

**Other Terms**

LaMa, Landscape Management, Host Agent, operations.d, SAPACEXT, SAP Adaptive Extensions, SAPACOSPrep, [CVE-2020-6191](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-6191)

**Reason and Prerequisites**

- The attacker needs to authenticate as a user registered in the `admin_group` against the SAP Host Agent (via SOAP/remotely).
- The attacker needs to place a malicious executable on the filesystem of the target host.
- SAP Landscape Management needs to be installed with at least one managed host being configured.

*Note:* Typical users in `admin_group` are the `sapadm` user and Diagnostics Agent user.

**Solution**

**Prerequisites to ensure the fixes can be activated:**

1. **Enable Validator:**
   - Ensure validator **'SAP Landscape Management Internal Operation Check'** is enabled.
   - For more information, see [Setting Up Validations for Landscape Entities](https://me.sap.com/viewer/e7dead4286c545808b3bd24feee7448c/latest/en-US/4e01ccb9c4e400aae10000000a42189e.html).

2. **Enable Validation:**
   - Ensure validation **'LVMIntOpOld'** is enabled and not suppressed on any host.
   - For more information, see [Validations for Hosts](https://me.sap.com/viewer/e7dead4286c545808b3bd24feee7448c/latest/en-US/856412279b164ea085be4e4e1fa8dfea.html).

**Steps to Resolve:**

1. **Install Patches:**
   - Install SAP Landscape Management 3.0 SP13 Patch 3 ([Note 2887591](https://me.sap.com/notes/2887591)).
   - Install the SAP Adaptive Extensions Patch 52 ([Note 1808793](https://me.sap.com/notes/1808793)) on all managed hosts where SAP Adaptive Extensions have been installed before (e.g., SAP HANA hosts, appliance provisioning).

2. **Execute Mass Validation:**
   - Execute a mass validation on all hosts of your landscape for the validator **'RuntimeInternalOperationValidator'** to activate the fixes immediately.
   - If not executed manually, fixes will be enabled with the next automatic execution of the validation (24h by default).
   - For more information, see [Validating Hosts](https://me.sap.com/viewer/e7dead4286c545808b3bd24feee7448c/latest/en-US/f19736626215495e8675fb4d07f81a23.html).

**Mounted operations.d Directory:**

If the `operations.d` directory of your managed hosts is mounted, update `*.conf` files from SAP Adaptive Extensions patch 52 as per [SAP Note 1550099](https://me.sap.com/notes/1550099).

**Note on the Installation Order:**

Ensure you install SAP Landscape Management 3.0 SP13 Patch 3 before installing SAP Adaptive Extensions Patch 52.

**CVSS**

- **CVSS Score:** 7.2
- **Vector:** [CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H)

| Metric                     | Value             |
|----------------------------|-------------------|
| Attack Vector (AV)         | Network (N)       |
| Attack Complexity (AC)     | Low (L)           |
| Privileges Required (PR)   | High (H)          |
| User Interaction (UI)      | None (N)          |
| Scope (S)                  | Unchanged (U)     |
| Confidentiality Impact (C) | High (H)          |
| Integrity Impact (I)       | High (H)          |
| Availability Impact (A)    | High (H)          |

**References**

- [SAP Landscape Management 3.0 SP13 Patch03 (Note 2887591)](https://me.sap.com/notes/2887591)
- [SAP Adaptive Extension: Fixes for Patch 01 to Patch 55 (Note 1808793)](https://me.sap.com/notes/1808793)
- [Additional Host Agent Operations (Note 1550099)](https://me.sap.com/notes/1550099)

**Credits**

Special thanks to [RedRays](https://redrays.io) for supporting the information provided.