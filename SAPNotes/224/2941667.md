2941667 - [CVE-2020-6296] Code Injection Vulnerability in SAP NetWeaver (ABAP) and ABAP Platform

**Symptom**

**UPDATE 22nd September 2020**: This note has been re-released with the updated automatic correction instruction for NW Release 750 to additionally cover SP00 to SP05.

**UPDATE 8th September 2020**: This note has been re-released with the updated 'Correction instruction’ information. The correction instructions for releases NW 700 and 701 have been adjusted with an additional dependency to SAP Note [1497003](https://me.sap.com/notes/1497003).

SAP NetWeaver (ABAP Server) and ABAP Platform allow a low-privileged attacker to inject code by executing an ABAP report over the network. An attacker could gain access to data, overwrite arbitrary SAP programs including essential logon programs, and potentially lead to a Denial of Service.

**Reason and Prerequisites**

The batch input recorder report RSBDCREC is executable without an appropriate authorization check for any authenticated user if executed directly outside the context of transaction SHDB. The recorder enables the user to perform various code injections, which might be stored in either a recording or an extension in the DSN parameter.

**Solution**

This SAP Note implements the following corrections:

- Moves the authorization check `S_BDC_MONI` from SHDB to RSBDCREC.
- Prevents malicious code injection by changing the `INSERT REPORT` behavior using the central API to create development objects.

Authorization checks are performed against authorization `S_BDC_MONI` with parameters 'BDCAKTI' (values 'RSCP' and 'ORCS') and 'BDCGROUPID' (customer-defined token).

Code creation has been changed from a local implementation to a central API. Besides various repository checks, the API requires that the user has authorization `S_DEVELOP` with parameters 'OBJTYPE' (dynamic), 'OBJNAME' (dynamic), and `ACTVT` (based on developer role).

**CVSS Score**

- **Score**: 8.3
- **Vector**: CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:H/A:H

**Affected Software Components**

| Software Component | From | To  |
|--------------------|------|-----|
| SAP_BASIS          | 700  | 755 |

**Support Packages**

Refer to the specific support packages for your SAP_BASIS version:

- [SAPKB70038](https://me.sap.com/supportpackage/SAPKB70038) for SAP_BASIS 700
- [SAPKB70123](https://me.sap.com/supportpackage/SAPKB70123) for SAP_BASIS 701
- ... *(additional support packages listed similarly)*

**Preconditions**

Ensure the following SAP Notes are applied before implementing this correction:

- [1521853](https://me.sap.com/notes/1521853) – Directory Traversal in BC-ABA-SC
- [1497003](https://me.sap.com/notes/1497003) – Potential directory traversals in applications
- [2482441](https://me.sap.com/notes/2482441) – CALL TRANSACTION xxx USING: Include BDCRECX1 checks authorization

**Download and Additional Resources**

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000001337282020)
- [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0002941667?language=en-US&token=EE601C456334D8C01286C616EBD23939)
- [Show Changes](https://me.sap.com/notesLatestChanges/0002941667/E/diff)

For more details, visit the [SAP Support Portal](https://me.sap.com/).

*Credits to [RedRays](https://redrays.io) for supporting the information provided.*