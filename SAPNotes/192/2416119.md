SAP Security Note 2416119 - Improved Security for Outgoing HTTPS Connections in SAP NetWeaver

```markdown
## SAP Security Note 2416119 - Improved Security for Outgoing HTTPS Connections in SAP NetWeaver

### Header Data
- **SAP Note/KBA:** 2416119
- **Type:** SAP Security Note
- **Version:** 8
- **Recency:** Updated
- **Language:** English
- **Master Language:** English
- **Category:** Customizing
- **Priority:** Correction with high priority
- **Release Status:** Released for Customer
- **Released On:** 07.07.2017
- **Component:** BC-JAS-WEB  
  *Basis Components > NetWeaver Application Server Java > Web Container, HTTP, JavaMail, Servlets*

### Title
**2416119 - Improved security for outgoing HTTPS connections in SAP NetWeaver**

### Description
**Symptom**

Man-in-the-middle attacks are possible for outgoing HTTPS calls triggered by code running on SAP NetWeaver.

**CVSS Information**
- **CVSS v3 Base Score:** 7.4 / 10
- **CVSS v3 Base Vector:**
  - **Attack Vector (AV):** Network (N)
  - **Attack Complexity (AC):** High (H)
  - **Privileges Required (PR):** None (N)
  - **User Interaction (UI):** None (N)
  - **Scope (S):** Unchanged (U)
  - **Confidentiality Impact (C):** High (H)
  - **Integrity Impact (I):** High (H)
  - **Availability Impact (A):** None (N)

_SAP provides this CVSS v3 base score as an estimate of the risk posed by the issue reported in this note. This estimate does not take into account your own system configuration or operational environment._

**Reason and Prerequisites**

The security of outgoing HTTPS calls from a NetWeaver system is controlled by the `UrlCheckServerCertificate` property of the HTTP Provider service. The default value is `false`. **You must set this property to `true`** to enable full security for outgoing HTTPS calls.

After enabling this property, outgoing HTTPS calls to other resources will require proper and valid certificates in the client system’s keystore. Failure to maintain valid certificates may result in exceptions such as:

```
Cannot process an HTTP request to servlet [<actual code triggering the https call>] in [<application name>] web application.
[EXCEPTION]
org.w3c.www.protocol.http.HttpException: Peer certificate rejected by ChainVerifier
...
```

**Solution**

i. **Ensure server certificates are properly maintained in the keystore of the NetWeaver system that originates the HTTPS calls.**

ii. **Set the value of the property `UrlCheckServerCertificate` of the HTTP Provider service to `true`.**

**Manual Activities**

1. **Ensure the SSL service on both client and server systems is running.**
2. **Acquire and configure certificates:**
   - **Using a third-party CA provider:**
     - Generate a CSR request via NWA → SSL → Server Identity tab.
     - Send the PKCS#10 file to the CA provider for signing.
   - **Using self-signed certificates:**
     - Generate a CA using tools like OpenSSL.
     - Create and sign server certificates.
3. **Import the certificates:**
   - Import the server certificate via NWA → SSL → Import CSR Response.
   - Import the CA certificate into the client keystore via NWA → Configuration → Certificates and keys → TrustedCAs.
4. **Set `UrlCheckServerCertificate` to `true`:**
   - Follow the instructions [here](https://me.sap.com/help/notes/0002416119/E).
5. **Restart the system.**

_For detailed instructions, refer to the manual section of the note on [SAP Help Portal](https://me.sap.com/help/notes/0002416119/E)._

### Attributes
- **Other Components:** Basis Components > NetWeaver Application Server Java > Security, User Management (BC-JAS-SEC)
- **Externally Reported:** Yes
- **Planned Release Date:** 14.03.2017

### Available Languages
- [Deutsch](https://me.sap.com/notes/0002416119/D)
- [日本語](https://me.sap.com/notes/0002416119/J)
- [Português (Machine Translation)](https://me.sap.com/notes/0002416119/P)
- [Español (Machine Translation)](https://me.sap.com/notes/0002416119/S)
- [Français (Machine Translation)](https://me.sap.com/notes/0002416119/F)
- [Italiano (Machine Translation)](https://me.sap.com/notes/0002416119/I)
- [Русский (Machine Translation)](https://me.sap.com/notes/0002416119/R)
- [中文 (Machine Translation)](https://me.sap.com/notes/0002416119/1)
- [한국어 (Machine Translation)](https://me.sap.com/notes/0002416119/3)

### References
- [2671583 - Peer certificate rejected by ChainVerifier - CertRevoc result: false - error in AS Java](https://me.sap.com/notes/2671583)
- [2452615 - How to set URLCheckServerCertificate](https://me.sap.com/notes/2452615)
- [2372375 - AS Java log provider for SAP Enterprise Threat Detection](https://me.sap.com/notes/2372375)
- [2658857 - Heartbeat custom configuration for HTTPS certificate rejected by ChainVerifier](https://me.sap.com/notes/2658857)
- [2620218 - Heartbeat application https GRMGWSTest certificate rejected by ChainVerifier](https://me.sap.com/notes/2620218)
- [2479773 - Improved security and tracing for outgoing HTTPS connections in SAP NetWeaver](https://me.sap.com/notes/2479773)

### Validity
- **SERVERCORE:** Releases 7.30, 7.31, 7.40, 7.50 (All Support Package Levels)

_For more details on software components and support packages, visit the [SAP Support Portal](https://me.sap.com/)._

---

*Credits to [RedRays](https://redrays.io) for support in providing this information.*