1511179 - Loading DLLs from the current directory

---

**SAP Note/KBA**: 1511179  
**Type**: SAP Security Note  
**Released On**: 14.12.2010  
**Version**: 5  
**Language**: English  
**Category**: Program error  
**Priority**: HotNews  
**Release Status**: Released for Customer  
**Component**: Basis Components > Frontend Services (SAP Note 1322184) > SAP GUI for Windows (BC-FES-GUI)  

### Description

If an SAP shortcut (`.SAP`) is started from an unprotected directory, DLLs may be loaded from this directory. This can lead to a scenario known as **DLL preloading**, where a malicious DLL is loaded under an incorrect name. This vulnerability may be exploited to execute unauthorized code on the client host. For more details, refer to the [Microsoft article on DLL preloading](http://blogs.technet.com/b/srd/archive/2010/08/23/more-information-about-dll-preloading-remote-attack-vector.aspx).

### Reason and Prerequisites

Some system files loaded from SAP Logon or the SAP Logon path attempt to load DLLs from the current directory. This issue persists until the affected DLLs are corrected.

### Solution

1. **Upgrade SAP GUI for Windows**:  
   Apply **patch level 3** for SAP GUI for Windows, which removes the current directory from the DLL search path.  
   **Important**: You must also install [Microsoft update KB2264107](https://me.sap.com/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=DISPHIER&HEADER=Y&FUNCTIONBAR=N&EVENT=TREE&NE=NAVIGATE&ENR=01200615320200014751&V=MAINT) on all client PCs for this solution to be effective.

2. **Manual Registry Changes for Older SAP GUI Releases**:  
   If upgrading is not feasible, manually update the registry to remove the current directory from the DLL search path:
   
   - Navigate to each of the following registry keys:
     - `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\saplogon.exe`
     - `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\saplgpad.exe`
     - `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sapgui.exe`
     - `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sapshcut.exe`
     - `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sapfewcp.exe`
     - `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\BExAnalyzer.exe`
     - `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\wdb3xlau.exe`
   
   - For each key, create a `DWORD` value named `CWDIllegalInDllSearch` and set its value to `4294967295`.

   **Note**: The Microsoft update mentioned above is also required for this workaround.

### Download Links

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000017215592017)
- [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0001511179?language=en-US&token=EF3C0EF9D909EFBB9748EA5EB0012355)

---

_Credits to [redrays.io](https://redrays.io) for support in providing this information._