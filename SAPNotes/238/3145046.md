3145046 - [CVE-2022-27656] Cross-Site Scripting (XSS) vulnerability in administration UI of SAP Webdispatcher and SAP Netweaver AS for ABAP and Java (ICM)

## Description

### Symptom
The Web administration UI of SAP Web Dispatcher and the Internet Communication Manager (ICM) does not sufficiently encode user-controlled inputs, resulting in a Cross-Site Scripting (XSS) vulnerability. The following products are affected:

- ICM administration UI in SAP Application Server ABAP
- ICM administration UI in SAP Application Server Java
- Web Dispatcher administration UI in SAP Web Dispatcher (both standalone and embedded in the (A)SCS instance)

### Other Terms
Stored XSS, CVE-2022-27656

### Reason and Prerequisites
You are using one of the aforementioned SAP products with the administration UI enabled.

To exploit the vulnerability, an attacker must entice a victim to log on to the administration UI using a browser. Unauthenticated access is not affected. Therefore, a system is not vulnerable if there are no users with authorization for logging on to its administration UI.

For further information on prerequisites, see the FAQ in [SAP Knowledge Base Article 3195635](https://me.sap.com/notes/3195635).

## Solution
Implement the Support Packages and Patches referenced by this SAP Note. This ensures proper content encoding to prevent XSS attacks.

This correction is delivered with the following archives:

- **SAPWEBDISP.SAR**
- **hotfix - file dw.sar**
- **SP Stack Kernel - files SAPEXE.SAR and SAPEXEDB.SAR**

Use SAPWEBDISP.SAR to patch standalone SAP Web Dispatcher. Use dw.sar or SAPEXE.SAR and SAPEXEDB.SAR to patch both ICM and embedded SAP Web Dispatcher.

The correction is contained in all patch levels that are **equal to or higher** than the patch level listed in the "Support Package Patches" section of this SAP Note for the desired kernel release.

If you need to patch SAP Web Dispatcher, follow [SAP Note 908097](https://me.sap.com/notes/908097). It contains details about the recommended SAP Web Dispatcher version and how to download and install the patch.

Otherwise, follow the **SAP recommendations** on how to patch the SAP kernel:

1. Apply the **latest SP Stack Kernel** if it already contains the correction. For the list of current SP Stack Kernels, see [SAP Note 2083594](https://me.sap.com/notes/2083594) (SAP Kernel Versions and SAP Kernel Patch Levels).
2. Apply the **hotfix** if the patch level required by this note is higher than that of the latest SP Stack Kernel.
3. Review the **regression note** for the required patch level before installing the kernel patch. For details, see [SAP Note 1802333](https://me.sap.com/notes/1802333) (Finding information about regressions in the SAP kernel).
4. For instructions on how to download and install kernel patches, see [SAP Note 19466](https://me.sap.com/notes/19466) (Downloading SAP kernel patches).

The paper [Update Strategy for the Kernel of the Application Server ABAP in On Premise Landscapes](https://support.sap.com/deployment-strategies-kernel-abap.pdf) provides detailed information on the SAP recommendations.

## Workaround
SAP strongly recommends applying the corrections outlined above. If you cannot apply the patch in a timely manner, a workaround is possible to eliminate the vulnerability. Note that this workaround is a temporary fix and is not a permanent solution. It results in a partial loss of functionality of the administration UI.

Three workarounds are possible; it is sufficient to apply one of them:

### Workaround Option 1: Disable Affected Functionalities
Disable affected functionalities of the administration UI by removing affected files from the file system.

**Affected ICP files to remove:**
- `$(DIR_DATA)/icmandir/admin/icp/confirm.icp`
- `$(DIR_DATA)/icmandir/admin/icp/show_cache.icp`
- `$(DIR_DATA)/icmandir/admin/icp/show_conns.icp`

`$(DIR_DATA)` stands for the value of the profile parameter DIR_DATA in your system. A typical value is `/usr/sap/<SID>/<INSTANCE>/data`.

Replace `/` with `\` if you implement the workaround on the Windows operating system.

**Functionalities disabled by this measure:**
- All change operations (e.g., changing trace level)
- Showing cache entries
- Showing active connections

After removing the files above, the administration UI can still be used for most monitoring (read-only) purposes.

This workaround does not have to be reversed if you apply the patch after implementing the workaround.

If you install a patch level that is lower than the patch level listed in the "Support Package Patches" section after applying the workaround, then you have to remove the listed files again to re-enable the workaround.

### Workaround Option 2: Disable the Administration UI
The vulnerability cannot be exploited if the administration UI is disabled. You can disable the administration UI by removing all `icm/HTTP/admin_xx` from the profile. Additionally, set the following profile parameter to an empty value:

```
icm/HTTP/admin_0 =
```

Then restart the system.

This workaround must be reversed if you apply the patch after implementing the workaround.

### Workaround Option 3: Remove User Authorizations
Remove the authorization for logging on to the administration UI for all possible victim users. How to achieve this depends on the authentication method you are using in the administration UI. See documentation [Setting Up the Web Administration Interface](https://help.sap.com/docs/ABAP_PLATFORM_NEW/683d6a1797a34730a6e005d1e8de6f22/4880f7f674973ff6e10000000a42189c.html?locale=en-US) and subsequent pages for details.

This workaround must be reversed if you apply the patch after implementing the workaround.

For further information, see the FAQ in [SAP Knowledge Base Article 3195635](https://me.sap.com/notes/3195635).

## CVSS

- **CVSS Score:** 8.3
- **CVSS Vector:** CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:H

### Metrics
- **Attack Vector (AV):** Network (N)
- **Attack Complexity (AC):** High (H)
- **Privileges Required (PR):** None (N)
- **User Interaction (UI):** Required (R)
- **Scope (S):** Changed (C)
- **Confidentiality Impact (C):** High (H)
- **Integrity Impact (I):** High (H)
- **Availability Impact (A):** High (H)

## References

- [FAQ for SAP Security Note 3145046](https://me.sap.com/notes/3195635)

## Validity

### Software Components
- **KRNL64NUC:** 7.22 to 7.22, 7.22EXT to 7.22EXT, 7.49 to 7.49
- **KRNL64UC:** 7.22 to 7.22, 7.22EXT to 7.22EXT, 7.49 to 7.49, 7.53 to 7.53, 7.77 to 7.77, 7.81 to 7.81, 7.85 to 7.85
- **WEBDISP:** 7.49 to 7.49, 7.53 to 7.53, 7.77 to 7.77, 7.81 to 7.81, 7.85 to 7.85, 7.22_EXT to 7.22_EXT
- **KERNEL:** 7.22 to 7.22, 8.04 to 8.04, 7.49 to 7.49, 7.53 to 7.53, 7.77 to 7.77, 7.81 to 7.81, 7.85 to 7.85, 7.86 to 7.86, 7.87 to 7.87

## Support Package Patches

### Example Patches
- **SAP KERNEL 7.87 64-BIT UNICODE**
  - **Support Package:** SP016
  - **Patch Level:** 000016
  - [Download SP016](https://me.sap.com/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=DISPHIER&HEADER=Y&FUNCTIONBAR=N&EVENT=TREE&NE=NAVIGATE&ENR=73555000100200016628&V=MAINT)

- **SAP WEB DISPATCHER 7.53**
  - **Support Package:** SP1010
  - **Patch Level:** 001010
  - [Download SP1010](https://userapps.support.sap.com/sap/support/swdc/notes?cvnr=73554900100200005911&support_package=SP1010&patch_level=001010)

*(For the complete list of Support Package Patches, refer to the original SAP Note or visit the [SAP Support Portal](https://me.sap.com/))*.

## Credits
Credits to [https://redrays.io](https://redrays.io) for support in providing this information.