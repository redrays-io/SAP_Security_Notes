1567128 - Unauthorized use of application functions in System Login

### **Symptom**
A malicious user can execute functions in ICF System Login without proper authentication and authorization. This vulnerability allows unauthorized actions by tricking an authenticated user's browser into making specific requests.

### **Other Terms**
- **Cross-site request forgery (XSRF)**
- **ICF_SYSTEM_LOGIN**

### **Reason and Prerequisites**
ICF System Login executes certain functions by referencing specific URLs. When a malicious user tricks an authenticated user's browser into making a request containing a specific URL and parameters, the function is executed with the user's rights. This can be achieved through cross-site scripting attacks or by presenting deceptive links to victims.

### **Solution**
- **Apply the ABAP Correction:** It is strongly recommended to implement the relevant Support Package instead of using Correction Instructions due to the necessary manual changes involved.
  
  **Manual Implementation Steps:**
  
  1. **Create Data Elements:** Define new data elements such as `ICFAUTOLOGIN`, `ICFCERTREQUEST`, `ICFCERTUSRLNK`, etc., in the package `SICF_EXT_LOGIN`.
  
  2. **Add Documentation:** Document the newly created data elements appropriately to ensure clarity and maintainability.
  
  3. **Modify Data Structure:** Update the `ICFSYSLOGPARAMS` structure by appending the required components in the specified order.
     
     **Important:** Ensure the structure matches the provided specifications exactly to avoid compile errors.
  
  4. **Create Messages for ICF_SYSTEM_LOGIN:** Define messages like `402`, `403`, `404`, and `405` to handle various login scenarios and failures.
  
  **Recommendations:**
  
  - Implement the Support Package recommended by SAP to avoid manual changes.
  - Carefully follow the manual steps if opting for Correction Instructions to ensure system stability and security.

### **Attachments**
- [Autologin5_documentation.zip](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012003146900000013402011&iv_version=0009&iv_guid=183B3A9CF42FF84E8322FBC571591247)
- [Autologin6_syslogparams.zip](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012003146900000013402011&iv_version=0009&iv_guid=F5D72481801BA042920A91E0840D22C6)
- [Autologin7_message40X.zip](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=012003146900000013402011&iv_version=0009&iv_guid=CF73619C3717134E992A89BBC21B5C7A)

### **Support Packages Available**
- [SAPKB62071 for SAP_BASIS 620](https://me.sap.com/supportpackage/SAPKB62071)
- [SAPKB64029 for SAP_BASIS 640](https://me.sap.com/supportpackage/SAPKB64029)
- [SAPKB70025 for SAP_BASIS 700](https://me.sap.com/supportpackage/SAPKB70025)
- [SAPKB70110 for SAP_BASIS 701](https://me.sap.com/supportpackage/SAPKB70110)
- [SAPKB70209 for SAP_BASIS 702](https://me.sap.com/supportpackage/SAPKB70209)
- [SAPKB71013 for SAP_BASIS 710](https://me.sap.com/supportpackage/SAPKB71013)
- [SAPKB71108 for SAP_BASIS 711](https://me.sap.com/supportpackage/SAPKB71108)
- [SAPKB72006 for SAP_BASIS 720](https://me.sap.com/supportpackage/SAPKB72006)
- [SAPKB73004 for SAP_BASIS 730](https://me.sap.com/supportpackage/SAPKB73004)

### **References**
- [SAP Note 1732539](https://me.sap.com/notes/1732539) - SAP NetWeaver Gateway deployment w/ GW_CORE 190 IW_FND 240
- [SAP Note 1617090](https://me.sap.com/notes/1617090) - ICF system logon: Logon fails, logon cookie
- [SAP Note 1598015](https://me.sap.com/notes/1598015) - Business Workflow Task Execution screen do not open from UWL
- [SAP Note 1560585](https://me.sap.com/notes/1560585) - SAP Gateway 2.0 Release Note

### **Preconditions**
Ensure that the following SAP Notes are applied based on your SAP_BASIS version:
- **SAP_BASIS 620 to 730:** Various notes like [1420203](https://me.sap.com/notes/1420203), [1566201](https://me.sap.com/notes/1566201), [1371778](https://me.sap.com/notes/1371778), and [1456249](https://me.sap.com/notes/1456249).

---

*Credits to [RedRays](https://redrays.io) for supporting the provision of this information.*