SAP Security Note 821875 - Security settings in the message server

## Description

This security note provides guidance on enhancing the security configurations of the SAP message server. It outlines the necessary settings to increase the security level, manage access control, and troubleshoot related issues.

## Symptom

After increasing the security settings of the message server, you may encounter the following issues:
- **Access Denied Errors:** For example:
  ```
  MsSClientHandle: client 212.190.195.45 is EXTERNAL, access denied [msxxserv.c 4843]
  ```
- **Event Trigger Failures:** No events can be triggered via `sapevt`, resulting in trace entries indicating access denial.

## Solution

To address these issues and enhance the security of the message server, follow the steps below:

### 1. Administration Settings

- **ms/monitor Parameter:**
  - **0:** Only application servers can change the internal memory and execute monitor functions (default).
  - **1:** External monitoring programs (e.g., `msmon`) can also make changes.

- **ms/admin_port Parameter:**
  - **Default Value:** `0` (administration via external programs is deactivated).
  - **Set to a Specific Port Number:** Assign a port number greater than 1024 to allow administration via external programs.
  - **Configuration:** Use transaction `SMMS` -> Go to -> Security Settings to open or close the administration port dynamically.

### 2. Separation of Internal and External Communication

- **rdisp/msserv_internal Parameter:**
  - **Purpose:** Uses a separate data channel for internal (application servers) and external communication.
  - **Configuration Steps:**
    1. Define a different port for internal communication.
    2. Ensure all application servers use the internal port.
    3. Restart both the message server and application servers for changes to take effect.
  - **Benefits:** Prevents unauthorized external clients from performing administrative tasks and ensures that programs like `sapevt` connect through the internal port to trigger events successfully.

### 3. ACL List Configuration

- **ms/acl_info Parameter:**
  - **Default File:** `/usr/sap/<SID>/SYS/global/ms_acl_info`
  - **Purpose:** Specifies access rights to the message server, listing allowed machine names, domains, IP addresses, and subnet masks.
  - **Syntax Examples:**
    - `HOST=*` (all hosts are allowed)
    - `HOST=host1,host2`
    - `HOST=*.sap.com`
    - `HOST=147.45.56.32`
    - `HOST=147.45.56.*`
  - **Security:** Protect the ACL file from unauthorized modifications and activate ACL reading via transaction `SMMS` to manage dynamic entries.

## References

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000015854292017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0000821875?language=en-US&token=BCFF554173907B1DA0B0638013056FF6)
- [sapevt (Version 5): Security settings in the Msg. - SAP Note 826779](https://me.sap.com/notes/826779)
- [Additional info: Upgrade to SAP NW 2004s AS ABAP (iSeries) - SAP Note 822296](https://me.sap.com/notes/822296)

## Validity

This note is applicable to the following SAP Basis components:

- **SAP_BASIS 6.40**
- **SAP_BASIS 7.00**
- **SAP_BASIS 7.01**
- **SAP_BASIS 7.10**
- **SAP_BASIS 7.11**

Refer to the [Validity Information](https://me.sap.com/notes/0000821875/D) for detailed version support.

## Support Package Information

Ensure that your system has the latest support packages applied. For example:

- **SAP_BASIS 7.00:** [Support Package SP244](https://me.sap.com/supportpackage/SAPKB70001)
- **SAP_BASIS 7.10:** [Support Package SP190](https://me.sap.com/supportpackage/SAPKB70001)
- **SAP_BASIS 7.11:** [Support Package SP077](https://me.sap.com/supportpackage/SAPKB70001)

Check the [Support Packages](https://me.sap.com/supportpackage/SAPKB70001) section for your specific SAP Kernel version.

---

*Credits to [Redrays.io](https://redrays.io) for supporting the provision of this information.*