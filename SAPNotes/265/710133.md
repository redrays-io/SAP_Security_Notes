710133 - Security Note: Cross Site Scripting in SAP BC

**Title:** 710133 - Security Note: Cross Site Scripting in SAP BC  
**Type:** SAP Security Note  
**Released On:** 08.10.2009  
**Version:** 3  
**Priority:** Correction with high priority  
**Status:** Released for Customer  
**SAP Component:** Basis Components > Middleware > Business Connector

## Description

### Symptom
Security Fix regarding cross-site scripting attacks against the SAP Business Connector.  
You want to get information about whether the SAP Business Connector is vulnerable to "Cross Site Scripting" attacks and about how to protect your Business Connector against those possible attacks.

### Other Terms
CSS, XSS, dynamic server pages, DSP

### Reason and Prerequisites
*No additional information provided.*

### Solution
In general, all Web Servers that accept input parameters via HTTP requests, dynamically generate HTML pages based on these inputs, and then return this dynamically generated content as a response to the client (browser) are potentially vulnerable to "Cross Site Scripting" attacks. The Business Connector falls into this category only if a number of conditions are satisfied:

1. You created a browser-based web application on the Business Connector using "Dynamic Server Pages" (DSPs) or "Output Templates".
2. These DSPs use the `%value%` command to insert output parameters (or even input parameters that the browser has supplied in the request) into the HTML response.
3. One of the output parameters that is inserted into the HTML page is left empty during execution of the Services being called in the DSP. (Or input parameters are inserted directly.)

Under these circumstances, your web application is vulnerable to XSS. For example, an attacker might modify a URL to include a piece of JavaScript in the output parameter that is not used, causing it to be submitted as input to the DSP. During execution, this parameter remains unchanged and is inserted into the HTML response, executing the script on the client browser.

**To protect against such attacks:**

- Check your DSPs and wherever a parameter is inserted into the output via the command `%value myParameter%`, change it to `%value myParameter encode(xml)%`.  
  This ensures that the contents of `myParameter` are encoded using standard escape sequences (e.g., `<` becomes `&lt;`), breaking any script code and displaying it as harmless text.

Starting with CoreFix 6 (BC 4.6 and 4.7), the Business Connector offers additional features to protect against XSS based on where in the HTML document the value is inserted:

1. **Normal HTML text:** `encode(html)`
2. **HTML tag attributes:** `encode(htmlattr)`
   - *Example:* `<table width="%value pixel encode(htmlattr)%">`
3. **URL-encoded parameters:** `encode(url)`
   - *Example:* `<a href="another.dsp?input=%value param encode(url)%">`
4. **URLs and anchors:** `encode(location)`
   - *Example:* `<a href="%value pathToFile encode(location)%">`
5. **JavaScript/VBS:** `encode(script)`
   - *Example:*
     ```html
     <script language="JavaScript">
       function doSomething(){
         var release = %value currentRelease encode(script)%;
         if (release == "1.0") alert("Warning: Old release!");
       }
     </script>
     ```

For inserting parameters into XML templates:

1. **XML content:** `<ADDRESS>%value address encode(xml)%</ADDRESS>`
2. **XML attributes:** `<Payment terms=%value payTerms encode(xmlattr)%>`

*Note:* For strong protection in XML documents, use the "html" encoding options instead of "xml" to avoid invalid XML in multibyte encodings.

For more sophisticated precautions, consider creating a BC Service to validate and sanitize all input parameters before they are processed by DSPs.

For general background on "Cross Site Scripting," refer to [IBM Developer Works](http://www-106.ibm.com/developerworks/web/library/wa-secxss/).

## References

This document refers to:

- [908349 - Security Note: Phishing in SAP BC](https://me.sap.com/notes/908349)
- [906401 - Security Note: Path Traversal in SAP BC](https://me.sap.com/notes/906401)

## Validity

- **SAP BC:** 4.6 to 4.6
- **SAP BC:** 4.7 to 4.7

## Actions

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000015617982017)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0000710133?language=en-US&token=5FFDDE146FBE8ADB5AC28B74A1AB571B)
- [Edit Note](https://me.sap.com/notes/0000710133/edit)
- [Show Changes](https://me.sap.com/notes/0000710133/compare)
- [Share by Email](mailto:?subject=SAP%20Note%20710133&body=Check%20out%20this%20SAP%20Security%20Note:%20https://me.sap.com/notes/710133)
- [Open in New Window](https://me.sap.com/notes/710133)

## Translations

Available in the following languages:

- [日本語](https://me.sap.com/notes/0000710133/J)
- [Deutsch](https://me.sap.com/notes/0000710133/D)
- [Português (Machine Translation)](https://me.sap.com/notes/0000710133/P)
- [Español (Machine Translation)](https://me.sap.com/notes/0000710133/S)
- [Français (Machine Translation)](https://me.sap.com/notes/0000710133/F)
- [Italiano (Machine Translation)](https://me.sap.com/notes/0000710133/I)
- [Русский (Machine Translation)](https://me.sap.com/notes/0000710133/R)
- [中文 (Machine Translation)](https://me.sap.com/notes/0000710133/1)
- [한국어 (Machine Translation)](https://me.sap.com/notes/0000710133/3)

*Credits to [Redrays.io](https://redrays.io) for support in providing this information.*