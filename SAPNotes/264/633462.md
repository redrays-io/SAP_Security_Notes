633462 - Encrypting credit card data

**SAP Note 633462 - Encrypting credit card data**

**Type:** SAP Security Note  
**Version:** 7  
**Recency:** New  
**Language:** English  
**Master Language:** German  
**Category:** Legal change  
**Priority:** Correction with low priority  
**Status:** Released for Customer  
**Released On:** 08.10.2009  
**Component:** Sales and Distribution > Billing > Processing Billing Documents > Payment Cards (SD-BIL-IV-PC)

### Symptom
For legal reasons, you must save payment card numbers to a database in encrypted form. Before you activate the encryption function, refer to the FAQ contained in [Note 766703](https://me.sap.com/notes/766703).

### Other Terms
Credit cards, CCARDEC, FPLTC, BSEGC

### Reason and Prerequisites
This is a legal requirement.

### Solution
To activate encryption, your system must meet the following requirements:

1. For Release 4.6C, you must import Support Package [SAPKH46C46](https://me.sap.com/supportpackage/SAPKH46C46) and
2. Kernel 4.6D must have patch level 1329 (see [Note 565111](https://me.sap.com/notes/565111)).
3. For Release 470, you must import Support Package [SAPKH47022](https://me.sap.com/supportpackage/SAPKH47022).
4. For Release ERP 500, you must import Support Package [SAPKH50007](https://me.sap.com/supportpackage/SAPKH50007).
5. Download and install SAPCRYPTOLIB (see [Note 662340](https://me.sap.com/notes/662340)). You must use the CCARD application when you use Transaction SSFA to set up encryption.

**Activation Steps:**
6. Start the SAPFACCG report once.
7. Depending on the card type, use Transaction SM30 to activate encryption. Maintain the CCARDEC_V view.
8. Use the CCARDEC_CHECK report to ensure that the encryption tool is working correctly. Only select the P_TOOLS checkbox and then execute the report on all application servers.
9. If encryption works correctly (Process Encryption/Decryption passed), you can start to convert existing data. This is only necessary if you also want to encrypt legacy data. Two reports (first CCARDEC_TRANSFORM_SD and then CCARDEC_TRANSFORM_FI) are used to convert the data.
10. Data conversion using the CCARDEC_TRANSFORM_SD report takes place in two steps:
    a) Start the report and choose the action 'Encrypt'. The credit card number is encrypted and saved to the database.
    b) Start the report and choose the action 'Check'. The encrypted payment card number is checked and the original payment card number is masked. For testing purposes, you can carry out both steps without performing a database update (by setting the test indicator to 'X').
11. Then carry out the same steps using the CCARDEC_TRANSFORM_FI report.

**Caution:** The required corrections can only be delivered in a Support Package.

### References
- [1105524 - Security when displaying credit card numbers](https://me.sap.com/notes/1105524)
- [1034482 - FAQ: Credit card encryption in CRM](https://me.sap.com/notes/1034482)
- [1029819 - Encryption of payment cards in SD and customer master](https://me.sap.com/notes/1029819)
- [894022 - NAE: Credit Card Masking](https://me.sap.com/notes/894022)
- [813198 - Action 'C4' is missing for the VBAK_AAT authorization object](https://me.sap.com/notes/813198)
- [808313 - CCARDEC_CHECK report missing](https://me.sap.com/notes/808313)
- [791178 - Credit card encryption in AR backend](https://me.sap.com/notes/791178)
- [790161 - The customer number is missing in message V/005](https://me.sap.com/notes/790161)
- [779203 - Loss of data during payment card encryption](https://me.sap.com/notes/779203)
- [766703 - FAQ: Credit card encryption in R/3 systems](https://me.sap.com/notes/766703)
- [735071 - Payment cards: Coding report does not work](https://me.sap.com/notes/735071)
- [662340 - SSF Encryption Using the SAPCryptolib](https://me.sap.com/notes/662340)
- [597059 - License terms of SAP CommonCryptoLib](https://me.sap.com/notes/597059)
- [397175 - SAP Cryptographic software - export control](https://me.sap.com/notes/397175)

### Side Effects
**This document is causing side effects:**
- [812658 - Credit card information incomplete](https://me.sap.com/notes/812658)
- [738459 - SAPSQL_WHERE_PARENTHESES for payment cards in sales order](https://me.sap.com/notes/738459)
- [700165 - VF04: Update termination 'Convert no number'](https://me.sap.com/notes/700165)

### Actions
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000015476662017)
- [PDF Version](https://me.sap.com/sap/support/sfm/notes/print/0000633462?language=en-US&token=9C3A5062A504ACB5BADF8BA4E1D92D84)

*Credits to [RedRays.io](https://redrays.io) for support in providing this information.*