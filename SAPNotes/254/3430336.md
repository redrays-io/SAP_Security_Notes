3430336 - [CVE-2013-3587] Information Disclosure vulnerability in SAP Commerce Cloud

**Symptom**

SAP Commerce Cloud web applications use Gzip HTTP Compression, which could expose them to BREACH attacks as described in [CVE-2013-3587](https://www.cve.org/CVERecord?id=CVE-2013-3587) under specific conditions. This vulnerability may significantly impact the confidentiality of the system without affecting its integrity or availability.

**Reason and Prerequisites**

Web applications are vulnerable to BREACH attacks when all the following conditions are met:

1. HTTP compression (GZIP/DEFLATE) is enabled.
2. User input (e.g., query string parameters, POST parameters) is reflected in the response body.
3. Confidential data (such as security tokens) is served in the response body and repeated in nearly identical responses on subsequent requests, excluding the reflected user data.

Alternatively:

- The application repeatedly sends almost identical responses containing sensitive information like security tokens without including user data in each subsequent request.

Successful BREACH attacks can reveal anti-CSRF tokens, allowing attackers to perform CSRF attacks that the tokens would normally prevent.

**Solution**

Spring Security introduced `XorCsrfTokenRequestAttributeHandler` to protect anti-CSRF tokens against BREACH attacks by using random cryptographic nonces.

SAP Commerce Cloud addresses this vulnerability by implementing `XorCsrfTokenRequestAttributeHandler` in web applications that use anti-CSRF tokens. Apply the following patches to improve your configuration:

- **SAP Commerce Cloud Update Release 2211.18 (Preview of 2211.20)**: [SAP Commerce Cloud Update Release 2211.18](https://me.sap.com/help/sap-commerce-cloud-update-release-2211-18.html)

**Software Downloads**

You can download these or later patches from the [Software Downloads](https://me.sap.com/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=NEXT&_HEADER=Y&_FUNCTIONBAR=Y&_EVENT=TREE&_NE=NAVIGATE&_ENR=73555000100800001224&_V=MAINT&_TA=ACTUAL/SAP%20COMMERCE%20CLOUD%20V2) section for customers of SAP Commerce Cloud in the Public Cloud.

**Installation Instructions**

After installing a SAP Commerce Cloud patch, rebuild and redeploy the updated version following the [About Patch Releases](https://me.sap.com/help/sap-commerce-cloud-public-cloud/about-patch-releases.html) guidelines. Customers should adhere to the [build instructions](https://me.sap.com/help/sap-commerce-cloud-public-cloud/build-instructions.html) and [deploy instructions](https://me.sap.com/help/sap-commerce-cloud-public-cloud/deploy-instructions.html).

**Remediation for Custom Applications**

If you have custom web applications built on SAP Commerce Cloud 2211.17 or earlier, you may be using vulnerable anti-CSRF tokens. To protect against BREACH attacks, implement `XorCsrfTokenRequestAttributeHandler` in your web applications.

**CVSS**

- **Score:** 5.9
- **Vector:** CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:N/A:N

**References**

For more detailed information, visit the [SAP Commerce Cloud Public Cloud documentation](https://me.sap.com/help/sap-commerce-cloud-public-cloud).

*Credits to [redrays.io](https://redrays.io) for support in providing this information.*