SAP Security Note 3344295 - [CVE-2023-37491] Improper Authorization Check Vulnerability in SAP Message Server

### **Description**

**Symptom:**  
The ACL (Access Control List) of the SAP Message Server can be bypassed under certain conditions, allowing an authenticated malicious user to access the network of SAP systems served by the affected SAP Message Server. This can lead to unauthorized read and write operations, as well as potential system unavailability.

**Affected Versions:**  
SAP Message Server versions **7.22** to **7.77**.

**Preconditions for Exploitation:**
- The SAP Message Server is protected only by an ACL.
- The profile parameter `system/secure_communication` is set to **OFF**.
- The internal port of the SAP Message Server is not secured.
- The trace level of the SAP Message Server is set to 2 or higher.
- The ACL file contains an IP address.

### **Solution**

**Correction:**
Apply the latest **SP Stack Kernel** that includes the correction. All subsequent kernel patch levels contain the fix. You can download and install the latest available kernel patch from the [Support Package Patches](https://me.sap.com/notes/2083594) section of this SAP Note.

**Steps to Apply the Correction:**
1. **Apply the Latest SP Stack Kernel:**  
   Ensure it includes the necessary correction. Refer to [SAP Note 2083594](https://me.sap.com/notes/2083594) for the list of current SP Stack Kernels.

2. **Apply the Next SP Stack Kernel if Needed:**  
   If the latest SP Stack Kernel does not contain the correction, apply the next available one. Use a **hotfix** if you require the correction urgently.

3. **Upgrade Out-of-Maintenance Kernels:**  
   If your kernel release is out of maintenance, upgrade to a corresponding downward compatible kernel as per [SAP Note 2083594](https://me.sap.com/notes/2083594).

4. **Review Regression Notes:**  
   Before installing the patch, review the regression notes for the target patch level in [SAP Note 1802333](https://me.sap.com/notes/1802333).

5. **Download and Install Kernel Patches:**  
   Follow the instructions in [SAP Note 19466](https://me.sap.com/notes/19466) to download and install kernel patches.

For detailed SAP recommendations, refer to the [Update Strategy for the Kernel of the Application Server ABAP in On-Premise Landscapes](https://support.sap.com/deployment-strategies-kernel-abap.pdf).

### **Workaround**

*Please assess the applicability of these workarounds for your SAP landscape before implementation. Note that these are temporary fixes and not permanent solutions.*

1. **Protect the Internal Port of the SAP Message Server:**  
   Implement protections as outlined in [SAP Note 821875](https://me.sap.com/notes/821875) and [SAP Note 1421005](https://me.sap.com/notes/1421005).

2. **Enable Secure Communication:**  
   Set the profile parameter `system/secure_communication` to **ON** as per [SAP Note 2040644](https://me.sap.com/notes/2040644).

3. **Adjust Trace Level:**  
   Keep the trace level of the SAP Message Server below **2**.

### **CVSS Information**

- **CVSS Score:** 7.5
- **Vector:** `CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H`
  - **Attack Vector:** Network (N)
  - **Attack Complexity:** High (H)
  - **Privileges Required:** Low (L)
  - **User Interaction:** None (N)
  - **Scope:** Unchanged (U)
  - **Confidentiality Impact:** High (H)
  - **Integrity Impact:** High (H)
  - **Availability Impact:** High (H)

### **Additional Information**

- **Priority:** Correction with high priority
- **Status:** Released for Customer
- **Released On:** 08.08.2023
- **Category:** Program error
- **Component:** Basis Components > Client/Server Technology > Message Service

For more details and to download the necessary patches, visit the [SAP Support Portal](https://me.sap.com/notes/3344295).

*Credits to [redrays.io](https://redrays.io) for support in providing this information.*