3111311 - [CVE-2022-28772] Denial of service (DOS) in SAP Web Dispatcher and SAP Netweaver (Internet Communication Manager)

**Symptom**
By sending overlong input values, an attacker may overwrite the internal program stack in SAP Web Dispatcher or Internet Communication Manager, rendering these programs unavailable.

**Other Terms**
- DoS
- DDoS
- Distributed Denial of Service
- Uncontrolled Resource Consumption
- Resource Exhaustion
- [CVE-2022-28772](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-28772)

**Reason and Prerequisites**
The issue is caused by a program error related to the parameter `icm/HTTP/file_access`. The ICM in Application Server ABAP is always affected due to the default value for `icm/HTTP/file_access_0`. SAP Web Dispatcher and Application Server Java are only affected if the parameter `icm/HTTP/file_access_<x>` has been explicitly set. SAP HANA Extended Application Services Advanced is also affected under similar conditions.

**Solution**

*For SAP Web Dispatcher and ICM:*
- Apply the appropriate patches using `SAPWEBDISP.SAR`, `dw.sar`, or `SAPEXE.SAR` and `SAPEXEDB.SAR` depending on your setup.
- Ensure your patch level is equal to or higher than the one listed in the "Support Package Patches" section of this [SAP Note](https://me.sap.com/notes/0003111311).

*For SAP HANA Extended Application Services:*
- Apply the referenced XS Advanced version listed in the "Support Package Patches" section of this SAP Note.

*Patch Installation Steps:*
1. Apply the latest SP Stack Kernel if it includes the correction. Refer to [SAP Note 2083594](https://me.sap.com/notes/2083594).
2. Apply the hotfix only if experiencing a serious error not fixed by the latest SP Stack Kernel.
3. Review the regression note before installing the kernel patch. See [SAP Note 1802333](https://me.sap.com/notes/1802333).
4. Follow instructions on how to download and install kernel patches from [SAP Note 19466](https://me.sap.com/notes/19466).

**Workaround**
Before implementing the workaround, assess its applicability to your SAP landscape. This is a temporary fix. SAP strongly recommends applying the corrections outlined in the security note instead.

*For ICM (AS ABAP and AS Java):*
```plaintext
if %{PATH} regimatch "^/sap/public/icmandir/(.){2000}"
RegForbiddenUrl ^(.*) -
```

*For ICM and Web Dispatcher (both standalone and XS Advanced):*
Add rewrite rules for all configured `icm/HTTP/file_access_<x>` parameters:
```plaintext
if %{PATH} regimatch "^/my/prefix/(.){2000}"
RegForbiddenUrl ^(.*) -
```
Refer to [SAP Note 3127829](https://me.sap.com/notes/3127829) for detailed configuration.

**CVSS**
- **Score:** 7.5
- **Vector:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
  - **Attack Vector:** Network (N)
  - **Attack Complexity:** Low (L)
  - **Privileges Required:** None (N)
  - **User Interaction:** None (N)
  - **Scope:** Unchanged (U)
  - **Confidentiality Impact:** None (N)
  - **Integrity Impact:** None (N)
  - **Availability Impact:** High (H)

For more details, refer to the full [SAP Note 3111311](https://me.sap.com/notes/3111311).

*Credits:* Information provided with support from [Red Rays](https://redrays.io).