SAP Security Note 3014121: Remote Code Execution Vulnerability in SAP Commerce (CVE-2021-21477)

## Overview

**SAP Note Number:** 3014121  
**Title:** [CVE-2021-21477] Remote Code Execution vulnerability in SAP Commerce  
**CVSS Score:** 9.9 (Critical)  
**Affected Component:** `CEC-COM-CPS-CKP` (Customer Engagement and Commerce > SAP Commerce > SAP Commerce > Cockpits & hMC)

## Description

A critical Remote Code Execution (RCE) vulnerability has been identified in the SAP Commerce Backoffice application. This vulnerability allows authenticated attackers with specific privileges to inject and execute malicious code within Drools rules, potentially compromising the underlying host. Impacts include unauthorized command execution, sensitive data disclosure, and denial of service.

**Affected Versions:**  
- SAP Commerce Cloud Patch Releases: 1808.34, 1811.32, 1905.24, 2005.8, 2011.3

## Solution

### Patch Releases

SAP has addressed this vulnerability in the following patch releases:

- [SAP Commerce Cloud Patch Release 1808.34](https://cxjira.sap.com/browse/PATCH-8596)
- [SAP Commerce Cloud Patch Release 1811.32](https://cxjira.sap.com/browse/PATCH-8597)
- [SAP Commerce Cloud Patch Release 1905.24](https://cxjira.sap.com/browse/PATCH-8598)
- [SAP Commerce Cloud Patch Release 2005.8](https://cxjira.sap.com/browse/PATCH-8599)
- [SAP Commerce Cloud Patch Release 2011.3](https://cxjira.sap.com/browse/PATCH-8600)

These patches are available in the [Software Downloads](https://me.sap.com/softwarecenter/template/products/_APP=00200682500000001943&_EVENT=NEXT&_HEADER=Y&_FUNCTIONBAR=Y&_EVENT=TREE&_NE=NAVIGATE&_ENR=67837800100800007216&V=MAINT&TA=ACTUAL/SAP%20COMMERCE) section of the SAP Support Portal. For installation instructions, refer to the [About Patch Releases](https://help.sap.com/viewer/a74589c3a81a4a95bf51d87258c0ab15/2011/en-US/8c25978386691014b4abdd61376acd24.html) guide.

**Note:** These patches fix the default permissions for new installations. Existing installations require additional manual remediation.

### Manual Remediation Steps

To secure existing SAP Commerce installations, perform the following steps to revoke inappropriate permissions:

1. **Access Permissions Management:**
   - Log in to SAP Commerce Backoffice as an admin or a highly privileged user.
   - Navigate to `System > Types`.
   - Search for the type with the identifier `"Item"` and open its editor.
   - Click the key icon (Type Permission Action) to access the Permissions Management dialog.

2. **Adjust Permissions:**
   - Ensure that no principals (e.g., user groups) have `change` or `create` permissions for the `Item` type.
   - Set these permissions to `inherited` (gray cross icon) for all relevant principals.
   - Repeat this process for all pages in the Permissions Management table.

3. **Review Affected Principals:**
   - Common principals with vulnerable permissions include:
     - `employeegroup`
     - `cmseditorgroup`
     - `cmsmanagergroup`
     - `apparel-de-cmsmanagergroup`
     - `apparel-uk-cmsmanagergroup`
     - `base-electronics-cmsmanagergroup`
     - `powertools-cmsmanagergroup`
   - Ensure that these principals have appropriate permissions set to prevent unauthorized access.

4. **Extend to Supertypes:**
   - Review and adjust permissions for all supertypes of `DroolsRule`, including:
     - `ExtensibleItem`
     - `LocalizableItem`
     - `GenericItem`
     - `AbstractRuleEngineRule`
     - `DroolsRule`

**Side Effects:**
Adjusting permissions may restrict legitimate operations for certain user groups. It is recommended to grant necessary permissions explicitly where required, ensuring minimal impact on business operations.

## Workaround

If immediate patch installation is not feasible, the manual remediation steps outlined above can serve as a workaround to mitigate the vulnerability.

## References

- [SAP Note 3020726: Remote Code Execution vulnerability in SAP Commerce: FAQ](https://me.sap.com/notes/3020726)

## CVSS Details

- **Vector:** CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
- **Attack Vector:** Network
- **Privileges Required:** Low
- **Scope:** Changed
- **Confidentiality Impact:** High
- **Integrity Impact:** High
- **Availability Impact:** High

## Credits

Information supported by [Red Rays](https://redrays.io)