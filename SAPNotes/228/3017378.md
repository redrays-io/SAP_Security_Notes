3017378 - [CVE-2021-21484] Possible Authentication Bypass in SAP HANA LDAP Scenarios

**Overview**

SAP Security Note **3017378** addresses a critical vulnerability identified as **CVE-2021-21484**. This vulnerability allows for a possible authentication bypass in SAP HANA LDAP scenarios, which can lead to unauthorized access to the SAP HANA database system.

**Symptom**

LDAP authentication in SAP HANA can be bypassed if the attached LDAP directory server is configured to enable unauthenticated bind. This means an attacker could gain access without proper authentication through users enabled for LDAP-based authentication.

**Reason and Prerequisites**

- **Authentication Methods:** SAP HANA supports external authentication via an LDAP directory service.
- **Configuration Requirements:**
  - A trust relationship must be established between SAP HANA and the LDAP authentication service.
  - LDAP authentication must be enabled for each SAP HANA user.
- **Vulnerability Condition:** The vulnerability exists if the LDAP directory server allows unauthenticated binds. Users relying solely on LDAP-based authorization are not affected.

**Impact**

An attacker exploiting this vulnerability can:
- Bypass authentication controls.
- Potentially create new users if automatic user creation is enabled, leading to unauthorized access.

**Solution**

To mitigate this vulnerability, apply the necessary patches to your SAP HANA systems:

- **SAP HANA 2.0 SPS04:** Revision **48.04**
- **SAP HANA 2.0 SPS05:** Revision **54**

**Update Instructions:**
- **Download for SNOTE:** [https://notesdownloads.sap.com/note/0040000000337882021](https://notesdownloads.sap.com/note/0040000000337882021)
- **PDF Version:** [https://me.sap.com/sap/support/sfm/notes/print/0003017378?language=en-US&token=CC6998326410169A43AABB52F719CBE6](https://me.sap.com/sap/support/sfm/notes/print/0003017378?language=en-US&token=CC6998326410169A43AABB52F719CBE6)

**Possible Workarounds:**
1. **Disable LDAP-Based Authentication:** For affected systems and users within SAP HANA.
2. **Restrict LDAP Directory Server:** Disable unauthenticated binds in the LDAP directory serverâ€™s configuration.

**Verification Steps:**

To check if your SAP HANA database is configured to allow LDAP authentication:

1. **Check for Active LDAP Provider:**
   ```sql
   SELECT ldap_provider_name 
   FROM SYS.LDAP_PROVIDERS 
   WHERE is_default='TRUE' AND is_provider_enabled='TRUE';
   ```
2. **Search Active Users Configured for LDAP:**
   ```sql
   SELECT user_name 
   FROM SYS.USERS 
   WHERE is_ldap_enabled='TRUE' AND user_deactivated='FALSE';
   ```

**References**

- **FAQ: SAP HANA LDAP Based Authentication and Authorization**: [https://me.sap.com/notes/2975780](https://me.sap.com/notes/2975780)

**CVSS Details**

- **CVSS Score:** 7.7
- **Vector:** [CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:L](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:L)

**Credits**

Information provided with support from [RedRays](https://redrays.io).