SAP Security Note 2593479 - Checking server certificates and host name of managed systems

**Symptom**
  
The managed system server certificate is not checked by default when a Solution Manager Diagnostics Agent connects to a managed system.

**Reason and Prerequisites**

This note describes how to set up an HTTPS or SSL connection between Diagnostic Agents and their managed systems to ensure that the corresponding server certificate is checked.

**Solution**

1. **Provide Trust to the Diagnostics Agent**

   Import the public key of the managed system's server certificate or a certificate used to sign the server's certificate into the truststore of the SAP JVM running the Diagnostics Agent. This can be done using the `keytool` utility:

   ```bash
   ./keytool -import -file <the_server_trust> -keystore ../jre/lib/security/cacerts
   ```

   For more information, refer to the [keytool documentation](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html).

   *Note: When updating the SAP JVM, repeat this step as the keystore gets overwritten during the update.*

2. **Switch on Validation of Server Certificates**

   With Solution Manager 7.2 SP 7, a service property `smd.use.default.TrustManager` has been introduced. Setting this property to `true` activates standard checking procedures for server certificates.

   - Open the NetWeaver Administrator of the Solution Manager Java instance.
   - Navigate to **Configuration** → **Infrastructure** → **Java System Properties**.
   - In the "Services" tab, find the "SM Diagnostics Server" and select it.
   - Set the property `smd.use.default.TrustManager` to `true`.
   - Save the configuration and restart the Solution Manager Java instance.

3. **Validation of Server Hostname for HTTPS Connections**

   For HTTPS connections, the server hostname specified in the URL is matched against the `CN` attribute in the server's certificate. A single leading '*' in the `CN` is allowed, enabling certificates like `CN=*.acme.com` to be valid for all servers within the `acme.com` domain.

**CVSS Information**

- **CVSS Score:** 3.9
- **Attack Vector:** Local (L)
- **Attack Complexity:** High (H)
- **Privileges Required:** High (H)
- **User Interaction:** None (N)
- **Scope:** Unchanged (U)
- **Confidentiality Impact:** Low (L)
- **Integrity Impact:** Low (L)
- **Availability Impact:** Low (L)

For detailed information, refer to the [full SAP Security Note 2593479](https://me.sap.com/notes/2593479).

**Actions**

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000001161062018)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0002593479?language=en-US&token=4444E12AAFDB3D559F84B88D6BCAD3D5)
- [Show Changes](https://me.sap.com/notesLatestChanges/0002593479/E/diff)

*Credits: [redrays.io](https://redrays.io) for support to provided information.*