2541823 - Switchable Authorization Checks for RFC in SAP CRM (External Billing)

**SAP Security Note 2541823**

**Details:**
- **Type:** SAP Security Note
- **Version:** 4
- **Recency:** Updated
- **Language:** English
- **Category:** Program error
- **Priority:** Correction with medium priority
- **Status:** Released for Customer
- **Released On:** 23.06.2020
- **Component:** CRM-BTX-BF-EBI

**Title:**
2541823 - Switchable authorization checks for RFC in SAP CRM (external billing)

**Description:**

### Symptom
**UPDATE 23rd June 2020**: This note has been re-released with the fileÂ *CRM_SRV_EXT_BILLING.TXT* added in the 'attachment' section.

This SAP note describes new switchable authorization checks for RFC function modules which are called from CRM reports in an external billing scenario.

**Other Terms:**
- SACF Access control
- Authorization error
- Authorization profile
- CRM External billing scenario

### Reason and Prerequisites
Remote calls to RFC function modules are protected by checks on the authorization object `S_RFC`. Authorizations for `S_RFC` must be limited to the required minimum for all users to ensure system security. Many RFC function modules can be sufficiently protected using `S_RFC` authorization checks. These RFC function modules often do not perform additional functional authorization checks. Please see [SAP Note 2008727](https://me.sap.com/notes/2008727) for further information on RFC Security.

It was identified that `S_RFC` authorization checks might not be sufficient to ensure secure execution for RFC function modules covered by this note. Activate new switchable authorization checks and update corresponding roles if these RFC function modules are included in `S_RFC` authorizations in your system.

### Solution
New switchable authorization checks have been implemented. The checks are delivered inactive to ensure compatibility with your running processes. The checks can be activated in transaction SACF as described in the attached manual correction instruction. See [SAP Note 1922808](https://me.sap.com/notes/1922808) for additional information on the switchable authorization check framework (SACF).

**Affected Function Modules:**
- `CRM_DELETE_OBSOLETE_DMR_ITEM`
- `CRM_READ_DMR_ITEMS_FOR_CRM_SER`
- `CRM_READ_DMR_ITEMS_FOR_CRM_W_D`

**New Authorization Scenario:**
- **CRM_SRV_EXT_BILLING:** CRM External Billing RFC FM for Correction Reports

**Authorization Object:**
- `V_VBAK_AAT`

**Implementation of the Switchable Authorization Check:**
The switchable authorization scenario and the switchable authorization checks are provided via a support package. They can be technically pre-implemented via the correction instructions below. After technical implementation via a support package or correction instructions, the checks remain inactive until manual activation.

**Manual Activities:**
```plaintext
------------------------------------------------------------------------
|Manual Activity                                                                                           |
------------------------------------------------------------------------
|VALID FOR                                                                                                 |
|Software Component   SAP_APPL           SAP Application                                                    |
| Release 600          From SAPKH60001                                                                    |
| Release 602          All Support Package Levels                                                         |
| Release 603          All Support Package Levels                                                         |
| Release 604          From SAPKH60401                                                                    |
| Release 605          All Support Package Levels                                                         |
| Release 606          SAPKH60601 - SAPKH60623                                                            |
| Release 616          Until SAPKH61612                                                                    |
| Release 617          SAPKH61701 - SAPKH61717                                                            |
| Release 618          Until SAPK-61811INSAPAPPL                                                           |
------------------------------------------------------------------------

**Caution:** You have to perform this manual activity separately in each system into which you transport the Note for implementation.

Activating the authorization check is required for all support packages where the authorization scenario is available. This is done by creating a productive authorization scenario from the scenario definition.

**Step 1:** Create the authorization scenario definition in older support packages (transported in your landscape):
- Start transaction SACF and check if scenario definition `CRM_SRV_EXT_BILLING` exists. If it does, go to step 2.
- If the scenario definition does not exist in SACF, download the file *CRM_SRV_EXT_BILLING.txt* attached to this note.
- Start transaction `SACF_TRANSFER`.
- Select the radio button "Upload", select work area "Scenario Definition", deselect work area "Productive Scenarios", deselect "Test Mode", and execute (F8).
- Choose the file *CRM_SRV_EXT_BILLING.txt* and confirm the upload.
- Assign the scenario definition `CRM_SRV_EXT_BILLING.txt` to development package `IAOM_CRMSERVICE_EXEC`.

**Step 2:** Create the productive authorization scenario and activate the switchable authorization checks. SAP Note [1922808](https://me.sap.com/notes/1922808) explains in section [4] how to ensure that authorized users have all required authorizations and how to activate the checks.

**Attachments:**
- [CRM_SRV_EXT_BILLING.TXT](https://me.sap.com/sap/support/sapnotes/public/services/attachment.htm?iv_key=002075125900002272972017&iv_version=0004&iv_guid=00109B36BC1E1EDAAD8A98C3583700DB) (2 KB, text/plain)

**Support Packages:**
- [SAPK-10008INS4CORE](https://me.sap.com/supportpackage/SAPK-10008INS4CORE) for S4CORE 100
- [SAPK-10106INS4CORE](https://me.sap.com/supportpackage/SAPK-10106INS4CORE) for S4CORE 101
- [SAPK-10204INS4CORE](https://me.sap.com/supportpackage/SAPK-10204INS4CORE) for S4CORE 102
- [SAPK-10302INS4CORE](https://me.sap.com/supportpackage/SAPK-10302INS4CORE) for S4CORE 103
- [SAPKH60624](https://me.sap.com/supportpackage/SAPKH60624) for SAP_APPL 606
- [SAPKH61613](https://me.sap.com/supportpackage/SAPKH61613) for SAP_APPL 616
- [SAPKH61718](https://me.sap.com/supportpackage/SAPKH61718) for SAP_APPL 617
- [SAPK-61812INSAPAPPL](https://me.sap.com/supportpackage/SAPK-61812INSAPAPPL) for SAP_APPL 618

**Prerequisites:**
- [SAP Note 2541823](https://me.sap.com/notes/2541823) is valid for the following software components:
  - S4CORE 102 for CRM-BTX-BF-EBI
  - SAP_APPL 600-606, 616-618 for Toolbox external billing scenario: CRM_ANLYSE_SERVICE_DOC_DMR

**CVSS:**
- **Score:** 6.3
- **Vector:** [CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L)
  - **Attack Vector:** Network (N)
  - **Attack Complexity:** Low (L)
  - **Privileges Required:** Low (L)
  - **User Interaction:** None (N)
  - **Scope:** Unchanged (U)
  - **Confidentiality Impact:** Low (L)
  - **Integrity Impact:** Low (L)
  - **Availability Impact:** Low (L)

**Actions:**
- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000000960202020)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0002541823?language=en-US&token=2321AAAF27D0F334BC11666C2FAD6AD7)
- [Show Changes](https://me.sap.com/notesLatestChanges/0002541823/E/diff)

For more information and to access additional resources, visit the [SAP Support Portal](https://me.sap.com/).

---

*Credits to [redrays.io](https://redrays.io) for supporting information.*