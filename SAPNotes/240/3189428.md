3189428 - [CVE-2022-22965] Remote Code Execution Vulnerability in SAP HANA Extended Application Services

**Symptom**

SAP HANA Extended Application Services uses a version of Spring Framework which has a Remote Code Execution vulnerability ([CVE-2022-22965](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-22965)).

**Other Terms**

Remote code execution, Spring4Shell, XSA, XS advanced, SAP HANA XS, advanced model, [CVE-2022-22965](https://tanzu.vmware.com/security/cve-2022-22965)

**Reason and Prerequisites**

- You are running SAP HANA Platform with installed XS advanced version 1.0.144 or lower.

**Solution**

**1. Update SAP HANA XS, Advanced Model to Version 1.0.145 or Greater**

- **Check Versions:** Ensure that the versions of the XS Advanced Runtime and the XS advanced components are equal to or greater than those published on the [XS advanced media](https://me.sap.com/notes/2711421). If not, update all required components using the XS advanced media first.
  
- **Update Runtime:** Update the XS Advanced Runtime to the [latest available patch level](https://me.sap.com/notes/3166746), at least to version 1.0.145 or higher.

**2. Finding Vulnerable XS Advanced Applications**

Updating XS advanced secures the XS HANA services against CVE-2022-22965. However, Java applications running on XS advanced are not automatically secured if a different Java runtime (e.g., SapMachine 11) is specified. To identify vulnerable applications:

1. **Check Runtimes:** Log in to XS advanced as `XSA_ADMIN` and run the command:
   ```
   xs runtimes
   ```
   This checks if any applications are bound to the SapMachine 11 runtime.

2. **Assess Impact:**
   - If `bound applications` for SapMachine 11 is `0`, you are not affected by this vulnerability after applying XSA 1.0.145.
   - If `bound applications` is greater than `0`, identify the affected applications.

3. **Identify Affected Applications:**
   - Run:
     ```
     xs runtime -i <ID>
     ```
     Replace `<ID>` with the identifier for SapMachine 11 obtained from the previous step.

   - For each application listed, execute:
     ```
     xs find-app-artifacts <APPNAME> -n "spring-core*"
     ```
     Replace `<APPNAME>` with the application name to find artifacts using vulnerable Spring versions.

4. **Verify Vulnerable Spring Versions:**
   Refer to the official [CVE-2022-22965](https://tanzu.vmware.com/security/cve-2022-22965) details to determine if the identified Spring framework versions (e.g., `spring-core-5.3.5.jar`) are vulnerable and update them immediately.

**CVSS**

- **Score:** 9.8
- **Vector:** [CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**Affected Components**

- **Component:** BC-XS-SEC
- **Title:** Basis Components > HANA XS Advanced > UAA and Security for HANA XSA engine

**References**

- [3166746 - EXTENDED APPLICATION SERVICES 1 Release Collection 1.0.145](https://me.sap.com/notes/3166746)
- [2711421 - Installing SAP HANA Extended Application Services, advanced model using the XS Advanced installation media](https://me.sap.com/notes/2711421)

For more detailed information, visit the official SAP note: [3189428](https://me.sap.com/notes/3189428)

---

*Credits to [Redrays](https://redrays.io) for supporting this information.*