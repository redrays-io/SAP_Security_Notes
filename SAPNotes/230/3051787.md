3051787 - [CVE-2021-38177] Null Pointer Dereference vulnerability in SAP CommonCryptoLib

**Symptom**

SAP CommonCryptoLib version 8.5.38 or lower is vulnerable to a null pointer dereference vulnerability. An unauthenticated attacker can exploit this by sending crafted malicious data in HTTP requests over the network, causing the SAP application to crash and significantly impacting the availability of the SAP system.

**CVE**

- [CVE-2021-38177](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-38177)

**Reason and Prerequisites**

Due to a programming error, a segmentation fault may occur, leading to a denial of service.

**Solution**

1. **Upgrade CommonCryptoLib**
   - Download and install CommonCryptoLib version **8.5.39** or higher. Detailed instructions can be found in [SAP Note 1848999](https://me.sap.com/notes/1848999).

2. **Update Affected Components**
   - The corrected version of CommonCryptoLib is also delivered as part of the components listed in the **Software Components** section of this note. Updating these components will automatically implement the corrected version.
   - For each component, the corrected CommonCryptoLib version is initially delivered with the patch level listed in the **Support Package Patches** section. All higher patch levels also contain the corrected version.

3. **Specific Recommendations for Components:**
   - **SAP NetWeaver AS ABAP, AS Java, ABAP Platform:**
     - Implement the respective kernel version, such as the SP Stack Kernel or hotfix SP via `dw_utils.sar`.
     - **Recommendation:** Apply the latest SP Stack Kernel if it contains the correction. Refer to [SAP Note 2083594](https://me.sap.com/notes/2083594) for current SP Stack Kernels.
     - Alternatively, apply the hotfix `dw_utils.sar` for immediate correction.

   - **SAP Web Dispatcher:**
     - Implement at least the patch level listed in the “Support Package Patches” section for your release.
     - For update details, see [SAP Note 908097](https://me.sap.com/notes/908097).

   - **SAP Host Agent:**
     - Implement patch level 53 or higher.
     - Details available in [SAP Note 3076443](https://me.sap.com/notes/3076443).

   - **SAP Content Server:**
     - Implement SAP Content Server 7.53 patch level 823 or higher.
     - Alternatively, upgrade to SAP Content Server 7.53 as recommended in [SAP Note 719971](https://me.sap.com/notes/719971).

   - **SAP HANA Database:**
     - Implement SAP HANA Database 2.0 with revision **2.00.048.06** or **2.00.056.00**.
     - Refer to [SAP Note 3044239](https://me.sap.com/notes/3044239) and [SAP Note 3043459](https://me.sap.com/notes/3043459) for details.

   - **SAP Extended Application Services and Runtime (XSA):**
     - Implement patch level 135 or higher.
     - Details in [SAP Note 3059497](https://me.sap.com/notes/3059497).

**CVSS**

- **Score:** 7.5
- **Vector:** [CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H)
  - **Attack Vector (AV):** Network (N)
  - **Attack Complexity (AC):** Low (L)
  - **Privileges Required (PR):** None (N)
  - **User Interaction (UI):** None (N)
  - **Scope (S):** Unchanged (U)
  - **Confidentiality Impact (C):** None (N)
  - **Integrity Impact (I):** None (N)
  - **Availability Impact (A):** High (H)

**Affected Software Components**

| Software Component | From Version | To Version |
|--------------------|--------------|------------|
| HDB                | 2.00         | 2.00       |
| KRNL64NUC          | 7.22         | 7.22       |
| KRNL64UC           | 8.04         | 8.04       |
| WEBDISP            | 7.49         | 7.49       |
| XS_ADVANCED_RUNTIME| 1.00         | 1.00       |
| SAP_EXTENDED_APP_SERVICES| 1      | 1          |
| CONTSERV           | 6.50         | 6.50       |
| SAPSSOEXT          | 17           | 17         |
| CRYPTOLIB          | 8            | 8          |
| SAPHOSTAGENT       | 7.22         | 7.22       |
| KERNEL             | 7.22         | 7.22       |
| SAP KERNEL 8.04    | 8.04         | 8.04       |
| ... (and others as listed in the note) |

*For a complete list of affected components and versions, refer to the **Software Components** section in [SAP Note 3051787](https://me.sap.com/notes/3051787).*

**No Workaround Available**

There is no workaround available for this vulnerability.

**Credits**

Thanks to [RedRays.io](https://redrays.io) for supporting the provision of this information.