3036436 - [CVE-2021-27604] Potential XXE Vulnerability in SAP Process Integration (ESR Java Mappings)

**Symptom**

_Update 22nd June 2021: This note has been re-released with updated ‘Solution’ information. Also added a reference link to [FAQs on security note 3036436](https://me.sap.com/notes/3065062). There have not been any changes done, which require customer action._

Insecure Enterprise Services Repository (ESR) Java Mapping in SAP Process Integration could potentially lead to XXE vulnerability. This could further lead to disclosure of confidential information.

**Other Terms**

- XML External Entity Injection (XXE)
- XML external entity
- Injection
- Java Mapping
- Function Libraries
- Graphical Mapping
- SAP Process Orchestration
- [OWASP](https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html)
- [SAP XML Hardener](https://me.sap.com/doc/saphelp_nw75/7.5.5/EN-US/87/568a30d8f3421491a5121320f87528/frameset.htm)
- [CVE-2021-27604](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27604)

**Reason and Prerequisites**

XXE vulnerabilities arise because the XML specification contains various potentially dangerous features. Standard parsers support these features even if they are not normally used by the application.

**Solution**

The safest way to prevent XXE is always to disable DTDs (External Entities) individually. Disabling DTDs also makes the parser secure against denial of services (DOS) attacks. If it is not possible to disable DTDs completely, then external entities and external document type declarations must be disabled. The disablement is specific to each parser. Java Mappings using XML libraries are particularly vulnerable to XXE, because the default settings for most Java XML parsers are XXE enabled. To use these parsers safely, you have to explicitly disable XXE in the parser you use. Here are some examples using `DocumentBuilderFactory` and `SAXParserFactory`:

**Example 1:**
```java
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;

DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
dbf.setNamespaceAware(true);

try {
    dbf.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
} catch (ParserConfigurationException e) {
    System.err.println("could not set parser feature");
}
dbFactory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
```

**Example 2:**
```java
import javax.xml.parsers.SAXParser;
import org.xml.sax.SAXException;
import org.xml.sax.XMLReader;

SAXParser parser = /* created from SAXParserFactory */;
XMLReader reader = parser.getXMLReader();
try {
    reader.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
} catch (SAXException e) {
    System.err.println("could not set parser feature");
}
```

**Further Information (and examples):**
- [XML Hardener in SAP NetWeaver](https://me.sap.com/doc/saphelp_nw75/7.5.5/EN-US/87/568a30d8f3421491a5121320f87528/frameset.htm)
- [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html)
- [FAQ Note 3065062](https://me.sap.com/notes/3065062)

**CVSS**

- **Score:** 6.5
- **Vector:** CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
  - **Attack Vector (AV):** Network (N)
  - **Attack Complexity (AC):** Low (L)
  - **Privileges Required (PR):** Low (L)
  - **User Interaction (UI):** None (N)
  - **Scope (S):** Unchanged (U)
  - **Confidentiality Impact (C):** High (H)
  - **Integrity Impact (I):** None (N)
  - **Availability Impact (A):** None (N)

**Affected Components**

- **SAP_XIESR**
  - Versions: 7.10 to 7.11, 7.20, 7.30, 7.31, 7.40, 7.50

**Status**

Released for Customer on 22.06.2021

**Download Links**

- [Download for SNOTE](https://notesdownloads.sap.com/note/0040000000540032021)
- [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0003036436?language=en-US&token=5C72C7C3A7D7D65EFAF67571AF7F8537)
- [Show Changes](https://me.sap.com/notesLatestChanges/0003036436/E/diff)

**References**

- This document refers to: [3065062 - FAQs on SAP Security Note 3036436](https://me.sap.com/notes/3065062)
- Referenced by: [3065062 - FAQs on SAP Security Note 3036436](https://me.sap.com/notes/3065062)

**Available Languages**

- Deutsch
- Japanese (Machine Translation)
- Portuguese (Machine Translation)
- Español (Machine Translation)
- Français (Machine Translation)
- Italiano (Machine Translation)
- Русский (Machine Translation)
- 中文 (Machine Translation)
- 한국어 (Machine Translation)

**Credits**

Thanks to [redrays.io](https://redrays.io) for supporting the information provided.