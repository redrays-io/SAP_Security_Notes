3271523 - Remote Code Execution Vulnerability in SAP Commerce Associated with Apache Commons Text

**Symptom**
SAP Commerce uses a version of the open-source Java library Apache Commons Text which is vulnerable to [CVE-2022-42889](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-42889).

**Impact**
Apache Commons Text performs variable interpolation. Applications using the interpolation defaults in the affected versions may be vulnerable to remote code execution or unintended contact with remote servers if untrusted configuration values are used. Successful exploitation can compromise the confidentiality, integrity, and availability of the application.

**Affected Versions**
All SAP Commerce versions using Apache Commons Text from 1.5 to 1.9 with "StringSubstitutor" interpolation are affected.

**Solution**
It is recommended to upgrade to the following patched SAP Commerce Cloud releases:

- [SAP Commerce Cloud Patch Release 1905.47](https://me.sap.com/help/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html?version=1905)
- [SAP Commerce Cloud Patch Release 2005.31](https://me.sap.com/help/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html?version=2005)
- [SAP Commerce Cloud Patch Release 2011.26](https://me.sap.com/help/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html?version=2011)
- [SAP Commerce Cloud Patch Release 2105.16](https://me.sap.com/help/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html?version=2105)
- [SAP Commerce Cloud Patch Release 2205.5](https://me.sap.com/help/SAP_COMMERCE/eed845124da0491e875df8139c4e6e8c/f9b65161e1e645249542e59f42f64a7b.html)

After installing a patch, rebuild and redeploy your SAP Commerce environment. Refer to the [SAP Support Portal](https://me.sap.com/) for detailed patch installation instructions.

**Workaround**
As a temporary measure, manually upgrade the Apache Commons Text library to version 1.10.0 to disable "StringSubstitutor" interpolation. Follow the steps below:

1. Navigate to the directory containing the vulnerable SAP Commerce Cloud version.
2. Execute a search command to locate the vulnerable library, e.g., `find . -name "*commons*text*.jar"`.
3. Replace the affected `.jar` files with version 1.10.0 from the [official release](https://search.maven.org/artifact/org.apache.commons/commons-text/1.10.0/jar).
4. Commit the changes if using version control.
5. Rebuild and redeploy the updated SAP Commerce version.

**CVSS Score**
![CVSS Score 9.8](https://img.shields.io/badge/CVSS-3.0%2FAV:N%2FAC:L%2FPR:N%2FUI:N%2FS:U%2FC:H%2FI:H%2FA:H-red) 

**References**
- [SAP KBA 3278497 - FAQ & Workaround for Security Note 3271523](https://me.sap.com/notes/3278497)

For more details, visit the [SAP Security Notes](https://me.sap.com/).

*Credits to [Redrays](https://redrays.io) for supporting the provision of this information.*