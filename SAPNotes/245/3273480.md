3273480 - [CVE-2022-41272] Improper access control in SAP NetWeaver AS Java (User Defined Search)

**Description**

An unauthenticated attacker over the network can exploit improper access control in SAP NetWeaver AS Java's User Defined Search (UDS). This vulnerability allows unauthorized operations that can impact the confidentiality, availability, and integrity of the application. Identified as [CVE-2022-41272](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41272), this issue poses a high security risk.

**Updates:**

- **12th September 2023:** This security note was inadvertently taken back and has been re-released without any changes. No additional customer action is required.
- **28th March 2023:** Re-released with updated **Support Packages & Patches** information. Fix provided for SP026 of release 7.50.
- **28th February 2023:** Re-released with an updated 'Causes - Side Effects' section.
- **23rd December 2022:** Re-released with updated **Support Packages & Patches** information. Fixes provided for SP017 and SP018 of release 7.50.
- **16th December 2022:** Re-released with updated **Support Packages & Patches** information. Fix provided for SP019 of release 7.50 and minor textual changes in the title.

**CVSS Score**

- **Base Score:** 9.9
- **Vector:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:L/A:L
  - **Attack Vector (AV):** Network (N)
  - **Attack Complexity (AC):** Low (L)
  - **Privileges Required (PR):** None (N)
  - **User Interaction (UI):** None (N)
  - **Scope (S):** Changed (C)
  - **Confidentiality Impact (C):** High (H)
  - **Integrity Impact (I):** Low (L)
  - **Availability Impact (A):** Low (L)

**Affected Software Components**

- **MESSAGING:** Applicable to version 7.50.

**Solution**

Apply the recommended **Support Packages and Patches** provided by this SAP Security Note. The fix involves implementing authorization checks in all affected public methods with the following role assignments:

- **SAP_XI_ADMINISTRATOR_J2EE:** All permissions.
- **SAP_XI_CONFIGURATOR_J2EE** and **SAP_XI_DEVELOPER_J2EE:** Read and write permissions.
- **NWA_READONLY:** Read permission.

Additionally, an extra check has been added to all clauses to prevent SQL Injection. There is no workaround available apart from meeting the prerequisites mentioned below.

**Support Package Patches**

Ensure the following patches are applied to the **MESSAGING SYSTEM SERVICE 7.50**:

- **SP017 / Patch Level 000036:** [Download SP017](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP017&patch_level=000036)
- **SP018 / Patch Level 000037:** [Download SP018](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP018&patch_level=000037)
- **SP019 / Patch Level 000037:** [Download SP019](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP019&patch_level=000037)
- **SP020 / Patch Level 000031:** [Download SP020](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP020&patch_level=000031)
- **SP021 / Patch Level 000030:** [Download SP021](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP021&patch_level=000030)
- **SP022 / Patch Level 000021:** [Download SP022](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP022&patch_level=000021)
- **SP023 / Patch Level 000014:** [Download SP023](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP023&patch_level=000014)
- **SP024 / Patch Level 000013:** [Download SP024](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP024&patch_level=000013)
- **SP025 / Patch Level 000009:** [Download SP025](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP025&patch_level=000009)
- **SP026 / Patch Level 000004:** [Download SP026](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP026&patch_level=000004)
- **SP027 / Patch Level 000000:** [Download SP027](https://me.sap.com/sap/support/swdc/notes?cvnr=73554900100200001613&support_package=SP027&patch_level=000000)

**References**

- [SAP Note 3273729 - Impact of CVE-2022-41271 and CVE-2022-41272 on SAP NetWeaver and Process Orchestration](https://me.sap.com/notes/3273729)
- [SAP Note 3273480](https://me.sap.com/notes/3273480)

**Side Effects**

Applying this security note may cause the following side effects:

- [3286049 - Alerts are not sent after applying security note 3273480](https://me.sap.com/notes/3286049)
- [3280409 - Errors in UDS: Error while indexing payload for message key](https://me.sap.com/notes/3280409)
- [3301366 - Side effects on alerting and monitoring after implementing Note 3273480](https://me.sap.com/notes/3301366)

**Prerequisites**

For an exploit to be possible, an attacker would need direct access to the PI Server via the P4 protocol (typically behind a firewall).

**Credits**

Thanks to [RedRays](https://redrays.io) for providing the information.