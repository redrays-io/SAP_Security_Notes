SAP Note 1596335 - Code Injection Vulnerability in IS-M-AMC

**Symptom**
 
IS-M-AMC contains code that permits the execution of arbitrary program code of the user's choice.  
An attacker can therefore control the behavior of the system, or can potentially escalate privileges by executing malicious code, without having their own legitimate credentials.

**Other Terms**

Backdoor, injection, run, credentials, IS-M-AMC, M/AMC

**Reason and Prerequisites**

The program code contains a possibility to define and execute user-defined code that changes the behavior of the system. A valid and authenticated user is required. Depending on the code, the user can:

- Inject and run their own code
- Access confidential information
- Modify data, delete data
- Modify the output of the system
- Create new users with higher privileges
- Perform a denial of service attack

**Solution**

For AMC 3.0, the correction is available as of Support Package 9, Applet Version 171.

**Manual Activities**

If you implement the advance correction, you must carry out the following manual steps:

1. **Create Data Element**
   - Use transaction SE11 to create the data element `ISM_AMC_AD_PRG_FLD_VISIB`.
   - **Short Description:** Display 'Ad Program' Field
   - Maintain the field labels.
   - Assign the domain `XFELD`.

2. **Modify Table TJQPROFILE**
   - Use transaction SE11 to change the table TJQPROFILE.
   - Add the new field `AD_PRG_FLD_VISIB` and specify the data element `ISM_AMC_AD_PRG_FLD_VISIB`.

3. **Change Maintenance Interface**
   - Use transaction SE54 to change the maintenance interface of the maintenance view JQVTPROFILE.
   - **Steps:**
     a. Include the field `AD_PRG_FLD_VISIB` from the table TJQPROFILE in the Dictionary object.
     b. In the generation environment, navigate to `Environment -> Modification -> Maintenance Screens` and go to screen 0395.
     c. Place a checkbox linked to the new field `AD_PRG_FLD_VISIB` at the bottom of the screen.
     d. Create a text field with an ABAP Dictionary reference as the left label.
     e. Create a frame around the new field named 'Ad Components'.
     f. In the flow logic of screen 0395, before line 42, insert:
        ```abap
        module set_update_flag on chain-request.
        field JQVTPROFILE-AD_PRG_FLD_VISIB.
        ```
   - Change the table maintenance dialog by selecting the 'Change' button (F7).
   - Select the following reasons for change:
     - 'Create modules'
     - 'New field/sec.table in structure'
   - **Important:** Do not select any other reasons for change.
   - Select the field type as 'Normal Field'.  
     **Important:** Do not select any other field types or maintenance screens here.

**Validity**

- **Software Component:** IS-M/AMC
  - **From:** 2.0 to 4.0

**Support Package**

- **IS-M/AMC 2.0:** [SAPK-20011INAMC](https://me.sap.com/supportpackage/SAPK-20011INAMC)
- **IS-M/AMC 3.0:** [SAPK-30008INAMC](https://me.sap.com/supportpackage/SAPK-30008INAMC), [SAPK-30009INAMC](https://me.sap.com/supportpackage/SAPK-30009INAMC)
- **IS-M/AMC 4.0:** [SAPK-40003INISAMC](https://me.sap.com/supportpackage/SAPK-40003INISAMC)

**Side Effects**

This document is causing side effects:
- [1656107 - M/AMC: Unrequired menu entries when maintaining user profiles](https://me.sap.com/notes/0001656107)

For more details, visit the [SAP Support Notes](https://me.sap.com/notes/0001596335).

*Credits to [RedRays](https://redrays.io) for supporting the provision of this information.*