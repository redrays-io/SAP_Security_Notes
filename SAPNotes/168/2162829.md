2162829 - Code injection vulnerability in BW-EI-APD

**Symptom**

Analysis Process Designer (BW-EI-APD) allows users to include arbitrary program code in an analysis process object. This code is executed when the analysis process starts, enabling an attacker to control system behavior or potentially escalate privileges by executing malicious code.

**CVSS Information**

- **CVSS Base Score:** 4.6/10
- **Attack Vector (AV):** Network (N)
- **Access Complexity (AC):** High (H)
- **Authentication (Au):** Single (S)
- **Impact to Confidentiality (C):** Partial (P)
- **Impact to Integrity (I):** Partial (P)
- **Impact to Availability (A):** Partial (P)

*Note: This CVSS score is an estimate and does not account for your specific system configuration or environment. Conduct your own risk assessments when evaluating the applicability and priority of this security note. More information can be found in the [SAP Security Notes FAQ](https://support.sap.com/securitynotes).*

**Reason and Prerequisites**

The vulnerability exists because the program code in BW-EI-APD allows the definition and execution of user-defined code that alters system behavior. To exploit this vulnerability, an attacker must have:

- Authorization for the authorization object **RSANPR** with activity **36** (enhanced maintenance) to insert ABAP routines into an analysis process.
- Authorization to maintain the analysis process, which depends on the system change option (modifiability of repository objects).

**Potential Impacts:**

- Inject and execute arbitrary code.
- Obtain unauthorized information.
- Modify or delete data.
- Alter system output.
- Create users with elevated privileges.
- Perform denial of service attacks.

**Solution**

1. **Restrict Authorization:**
   - Review and manage users authorized to maintain ABAP routines in analysis processes (authorization object **RSANPR**, activity **36**).
   - Ensure only users with developer roles have this authorization or remove the ability to create code in APD for unauthorized users.

2. **Apply Correction Instructions:**
   - Implement the correction that adds an authorization check for the authorization object **S_DEVELOP** in the analysis process designer.
   - Before applying correction instructions, consult [SAP Note 1668882](https://me.sap.com/support/notes/1668882) using transaction **SNOTE**.

3. **Update Support Packages:**
   - Depending on your SAP BW version, apply the relevant Support Package as detailed below:

     - **SAP Business Warehouse (SAP BW) 7.0**
       - Import **Support Package 35 for SAP BW 7.00 (SAPKW70035)**. Available via [SAP Note 2009937](https://me.sap.com/support/notes/2009937).

     - **SAP BW 7.01 (SAP BW 7.0 EHP 1)**
       - Import **Support Package 18 for SAP BW 7.01 (SAPKW70118)**. Available via [SAP Note 2123573](https://me.sap.com/support/notes/2123573).

     - **SAP BW 7.02 (SAP BW 7.0 EHP 2)**
       - Import **Support Package 18 for SAP BW 7.02 (SAPKW70218)**. Available via [SAP Note 2126275](https://me.sap.com/support/notes/2126275).

     - **SAP BW 7.11**
       - Import **Support Package 15 for SAP BW 7.11 (SAPKW71115)**. Available via [SAP Note 2083158](https://me.sap.com/support/notes/2083158).

     - **SAP BW 7.30**
       - Import **Support Package 14 for SAP BW 7.30 (SAPKW73014)**. Available via [SAP Note 2132939](https://me.sap.com/support/notes/2132939).

     - **SAP BW 7.31 (SAP BW 7.3 EHP 1)**
       - Import **Support Package 17 for SAP BW 7.31 (SAPKW73117)**. Available via [SAP Note 2139356](https://me.sap.com/support/notes/2139356).

     - **SAP BW 7.40**
       - Import **Support Package 12 for SAP BW 7.40 (SAPKW74012)**. Available via [SAP Note 2143705](https://me.sap.com/support/notes/2143705).

**Additional Actions**

- **Download the Security Note:**
  - [Download for SNOTE](https://notesdownloads.sap.com/note/0040000012833322017)
  - [PDF Version](https://userapps.support.sap.com/sap/support/sfm/notes/print/0002162829?language=en-US&token=61084D5AF3AFE9055E4A28CEE1324C65)

**Credits**

Credits to [redrays.io](https://redrays.io) for support in providing this information.