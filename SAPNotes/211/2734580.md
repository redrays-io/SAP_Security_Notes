2734580 - Information Disclosure in SAP ABAP Server

**SAP Note/KBA:** 2734580  
**Type:** SAP Security Note  
**Version:** 9  
**Priority:** Correction with high priority  
**Status:** Released for Customer  
**Released On:** 14.07.2020  
**Component:** Basis Components > Middleware > Internet Communication Framework > ICF System Login

## Description

### Symptom

This note has been updated. We have added the note [2091403](https://me.sap.com/notes/2091403) as a prerequisite.

ABAP Server has a weakness in Internet Communication Framework's logon procedure, which enables a malicious user to steal logon credentials of another user by providing a malicious URL.

**Other Terms:** Request Forgery, XSRF

### Reason and Prerequisites

A malicious user can manipulate certain parameters used in a URL. When the manipulated URL is presented to another user, selecting that URL might disclose the user's credentials to the malicious user in another domain.

### Solution

- **Harden the Logon Procedure:** Implement the support package mentioned in this SAP Note or the respective correction instructions.
  
- **Implement Whitelist Protection:**
  - **If HTTP Whitelist Tool for Unified Connectivity (UCON) is available/active:** Activate the [Trusted Network Zone](https://me.sap.com/notes/2573569) for the scenario "HTTP Whitelist Scenario".
  - **Otherwise:** Maintain the table `HTTP_WHITELIST` with entry type 21 to enable HTTP Whitelist Protection. For example, to allow a redirect to any relative path, leave all fields empty except specify Entry Type 21 and a proper Sort Key, e.g., 1000. This entry must be maintained for client 000.

## CVSS

**CVSS Score:** 7.4  
**CVSS Vector:** [CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:N/A:N](https://www.first.org/cvss/)

- **Attack Vector (AV):** Network (N)
- **Attack Complexity (AC):** Low (L)
- **Privileges Required (PR):** None (N)
- **User Interaction (UI):** Required (R)
- **Scope (S):** Changed (C)
- **Confidentiality Impact (C):** High (H)
- **Integrity Impact (I):** None (N)
- **Availability Impact (A):** None (N)

## Support Packages

| Software Component Version | Support Package | URL |
|----------------------------|-----------------|-----|
| SAP_BASIS 700              | [SAPKB70037](https://me.sap.com/supportpackage/SAPKB70037) | [Link](https://me.sap.com/supportpackage/SAPKB70037) |
| SAP_BASIS 701              | [SAPKB70122](https://me.sap.com/supportpackage/SAPKB70122) | [Link](https://me.sap.com/supportpackage/SAPKB70122) |
| SAP_BASIS 702              | [SAPKB70222](https://me.sap.com/supportpackage/SAPKB70222) | [Link](https://me.sap.com/supportpackage/SAPKB70222) |
| SAP_BASIS 710              | [SAPKB71024](https://me.sap.com/supportpackage/SAPKB71024) | [Link](https://me.sap.com/supportpackage/SAPKB71024) |
| SAP_BASIS 711              | [SAPKB71119](https://me.sap.com/supportpackage/SAPKB71119) | [Link](https://me.sap.com/supportpackage/SAPKB71119) |
| SAP_BASIS 730              | [SAPKB73020](https://me.sap.com/supportpackage/SAPKB73020) | [Link](https://me.sap.com/supportpackage/SAPKB73020) |
| SAP_BASIS 731              | [SAPKB73125](https://me.sap.com/supportpackage/SAPKB73125) | [Link](https://me.sap.com/supportpackage/SAPKB73125) |
| SAP_BASIS 740              | [SAPKB74022](https://me.sap.com/supportpackage/SAPKB74022) | [Link](https://me.sap.com/supportpackage/SAPKB74022) |
| SAP_BASIS 750              | [SAPK-75015INSAPBASIS](https://me.sap.com/supportpackage/SAPK-75015INSAPBASIS) | [Link](https://me.sap.com/supportpackage/SAPK-75015INSAPBASIS) |

## Correction Instructions

**Software Component:** SAP_BASIS  
**Number of Correction Instructions:** 9  
**URL:** [Correction Instructions](https://me.sap.com/corrins/0002734580/41)

## Manual Activities

### Manual Pre-Implementation

1. **Valid For:**
   - **Software Component:** SAP_BASIS
   - **Releases:** 700, 710, 711, 701, 702, 730, 731, 740, 750+

2. **Steps:**
   - Call transaction SE91.
   - Enter the message class `ICF_SYSTEM_LOGIN` and access it.
   - Choose "Change".
   - Add the following messages:
     - Message 417: Parameter &1 has not passed the whitelist test
   - Set the "Self-explanatory" indicator for the message.
   - Save and activate your changes.

### Manual Activity

1. **Valid For:**
   - **Software Component:** SAP_BASIS
   - **Releases:** 700, 710, 711, 701, 702, 730, 731, 740, 750, 751, 752, 753, 754

2. **Steps:**
   - Perform the manual activity separately in each system where the Note is transported for implementation.
   - Refer to note [2573569](https://me.sap.com/notes/2573569) to activate the "Trusted Network Zone" for the "HTTP Whitelist Scenario" if the HTTP Whitelist Tool for UCON is available/active.
   - Otherwise, maintain the `HTTP_WHITELIST` table with entry type 21 to enable HTTP Whitelist Protection. For example, to allow a redirect to any relative path, leave all fields empty except specify Entry Type 21 and a proper Sort Key, e.g., 1000. This entry must be maintained for client 000.

**Caution:** Perform this manual activity separately in each system into which you transport the Note for implementation.

## References

### This Document Refers To

- [2573569 - UCON HTTP Allowlist Downport](https://me.sap.com/notes/2573569)

### This Document Is Referenced By

- [2704178 - The error HTTP 500 "Redirect is not possible" occurs in /sap/public/myssocntl or in /sap/public/bc/icf/logoff](https://me.sap.com/notes/2704178)
- [3021771 - FAQ regarding the SAP Security Note 2734580](https://me.sap.com/notes/3021771)

## Validity

| Software Component | From | To |
|--------------------|------|----|
| SAP_BASIS          | 700  | 702|
| SAP_BASIS          | 710  | 754+|

## Preconditions

| Software Component | From | To | SAP Note/KBA | Title | Component |
|--------------------|------|----|--------------|-------|-----------|
| SAP_BASIS          | 700  | 700| [2189853](https://me.sap.com/notes/2189853) | SAP Internet Communication Framework fails to validate HTTP_WHITELIST | BC-MID-ICF |
| SAP_BASIS          | 701  | 701| [2189853](https://me.sap.com/notes/2189853) | SAP Internet Communication Framework fails to validate HTTP_WHITELIST | BC-MID-ICF |
| SAP_BASIS          | 702  | 702| [2189853](https://me.sap.com/notes/2189853) | SAP Internet Communication Framework fails to validate HTTP_WHITELIST | BC-MID-ICF |
| SAP_BASIS          | 710  | 710| [2189853](https://me.sap.com/notes/2189853) | SAP Internet Communication Framework fails to validate HTTP_WHITELIST | BC-MID-ICF |
| SAP_BASIS          | 711  | 711| [2189853](https://me.sap.com/notes/2189853) | SAP Internet Communication Framework fails to validate HTTP_WHITELIST | BC-MID-ICF |
| SAP_BASIS          | 730  | 730| [2189853](https://me.sap.com/notes/2189853) | SAP Internet Communication Framework fails to validate HTTP_WHITELIST | BC-MID-ICF |
| SAP_BASIS          | 731  | 731| [2189853](https://me.sap.com/notes/2189853) | SAP Internet Communication Framework fails to validate HTTP_WHITELIST | BC-MID-ICF |
| SAP_BASIS          | 740  | 740| [2189853](https://me.sap.com/notes/2189853) | SAP Internet Communication Framework fails to validate HTTP_WHITELIST | BC-MID-ICF |

---

*Credits: [Redrays.io](https://redrays.io) for support in providing this information.*