SAP Security Note 1497003 - Potential directory traversals in applications

---

**Security Note**: [1497003](https://me.sap.com/notes/0001497003/) - *Potential directory traversals in applications*

**Description**:

This SAP Security Note addresses vulnerabilities in certain SAP applications that could allow malicious users to perform directory traversal attacks. These vulnerabilities may enable unauthorized reading or writing of arbitrary files on the application server, potentially leading to the disclosure of confidential information or alteration of system behavior.

**Symptom**:

Systems may exhibit runtime errors or security audit log entries indicating unauthorized file access attempts via directory traversal.

**Reason and Prerequisites**:

Some SAP applications allow the input of physical or logical file names without proper validation, introducing security risks.

**Solution**:

The note introduces enhancements to the ABAP runtime (KERNEL and SAP_BASIS) to normalize file paths and enforce validation against defined logical file names. Key measures include:

1. **Path Normalization**:
   - Removes redundant path components (e.g., `a/./b` becomes `a/b`).
   - Eliminates path components followed by `..` (e.g., `a/b/../c` becomes `a/c`).
   - Standardizes path separators based on the operating system.

2. **Case Insensitivity**:
   - On Windows platforms, path comparisons are case-insensitive to align with the OS behavior.

3. **Authorization Enhancements**:
   - Implements flags `FS_NOREAD` and `FS_NOWRITE` and checks against authorization object `S_PATH`.
   - Restricts file system access based on configured paths and aliases.

4. **Logical File Name Validation**:
   - Administrators can define aliases and valid directories for logical file names.
   - A mechanism ensures physical file names are validated against these definitions.

5. **Reporting and Auditing**:
   - Enhancements to report `RSFILENA` help identify unconfigured logical file names.
   - Security audit logs can be configured to monitor validation activities and detect unauthorized access attempts.

**Implementation Steps**:

1. **Kernel Update**:
   - Update your kernel to the patch level specified in the Support Package section of this note (e.g., for Release 46C, apply `SAPKB46C61`).

2. **Import Transport Requests**:
   - Download the relevant transport files from the [Download for SNOTE](https://notesdownloads.sap.com/note/0040000008860662017).
   - Extract and import these transport requests into your system.

3. **Execute Reports**:
   - Run report `RSFILECR` using transaction `SA38` to configure logical file names and paths.

4. **Configure Logical File Names**:
   - Define aliases and validation paths using transaction `FILE`.
   - Ensure all logical paths are properly configured to match your application's directory structure.

5. **Activate Path Validation**:
   - Activate file name validation features and monitor the security audit log for any issues.
   - Adjust scheduled jobs to account for the new validation mechanisms to prevent disruptions.

**Configuration**:

- **Authorization Object `S_DATASET`**:
  - Ensure proper configuration to restrict file system access based on normalized paths.
  
- **Customization Table `SPTH`**:
  - Normalize all path entries and configure `FS_NOREAD` and `FS_NOWRITE` flags as needed.
  
- **Logical File Names**:
  - Define and alias logical file names to enforce validation and restrict access to authorized directories.

**Attachments**:

- [Security Audit Log PDF](https://me.sap.com/userapps/support/.../SecurityAuditLog.pdf)
- [Logical File Names PDF](https://me.sap.com/userapps/support/.../Logical_File_Names.pdf)
- [Secure Programming Guide](https://me.sap.com/userapps/support/.../SecureProgramming_LogFileNames.pdf)
- [RSFILECR.zip](https://me.sap.com/userapps/support/.../RSFILECR.zip)
- [Basis_620_and_higher.zip](https://me.sap.com/userapps/support/.../Basis_620_and_higher.zip)

**Validity**:

Applicable to various SAP releases and components, including but not limited to:

- **SAP_APPL**: 31I, 40B, 45B
- **SAP_BASIS**: 46C, 46B, 620, 640, 700, 701, 702, 730

**References**:

This security note refers to multiple other notes addressing specific vulnerabilities related to directory traversal across different SAP components. For detailed references, please visit the [References section](https://me.sap.com/notes/0001497003/#References) of the note.

**Credits**:

Thanks to [RedRays.io](https://redrays.io) for supporting the information provided.

---

For more detailed information and updates, visit the official SAP Security Notes page: [https://me.sap.com/](https://me.sap.com/)