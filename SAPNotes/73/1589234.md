SAP Security Note 1589234 - Insecure Authentication with Trusted Connection in NW MDM

**Symptom**

This security note has been updated.  For more detailed information, see [Security Note 1644143](https://me.sap.com/notes/1644143).

You are using SAP NetWeaver MDM prior to version 7.1 SP8.

A malicious user can use functions of MDM Server (MDS) to which access should be restricted. This may result in an escalation of privileges.

**Other Terms**

Authentication, authentication step, trusted connection, SSO-like, SSL

**Reason and Prerequisites**

MDM offers a trusted connection authentication option to connect from an application based on the MDM Java API to the MDM Server.

Please see [SAP Netweaver Master Data Management (MDM) 7.1 Guide](https://me.sap.com/sap/support/notes/1589234) &gt; "MDM Java and .NET API Guide" → "Concepts" → "Connections, Sessions and Authentication" for more details.

**Trusted connection use in MDM delivered applications:**

The trusted connection authentication is used in the following MDM delivered applications.

- MDM 5.5 and 7.1 iViews and UWL using the SSO-like feature (see [MDM Security Guide](https://me.sap.com/notes/1589234), "iViews and UWL Authentication and the SSO-like feature" section).
- MDM 7.1 Generated Web Services with Basic Authentication with SAP Logon Ticket Support (see [MDM 7.1 Web Services guide](https://me.sap.com/notes/1589234) in sections "Defining Security Settings" and "MDM Web Services Security").
- MDM 7.1 Web Dynpro Components.

**Solution**

With SAP NetWeaver MDM 7.1 SP8, the authentication mechanism is further improved.

With SAP NetWeaver MDM 7.1 SP7, the communication channel will be encrypted using SSL with tunnel encryption.

For prior versions of SAP NetWeaver, a solution to the trusted connection security vulnerability could consist of either one of the two following options:

**Option 1 - Securing the Communication Channel**

With this option, the trusted connection mechanism is kept but the risk posed by it is reduced by securing the communication channel to the MDM server through the use of encryption.

This option is relevant to MDM delivered applications (see the Reason and Prerequisites section) and to custom applications based on the MDM Java API using the trusted connection authentication mode.

Securing the communication channel can be implemented as follows:

1. Set up an SSH tunnel or VPN for the network connection between the client and the server. Please see [SAP Note 1589237](https://me.sap.com/notes/1589237) (Communication Channel Encryption for SAP Netweaver MDM) and the SSH or VPN vendor-supplied documentation for more details.

**Option 2 - Disabling the Trusted Connection and Switching to Username and Password Based Authentication**

This option requires removing the use of the trusted connection and switching to username and password-based authentication.

Typically, it means moving from "SSO-like" user propagation from the Java application to the MDM server to an authentication mode based on a constant user or on user mapping.

It requires a change in the implementation of the MDM Java application using the trusted connection and most probably a change in its user management settings.

Consequently, the auditing of the MDM users in the MDM server might be reduced by this change, and the authorization settings in the MDM server might need to be adjusted.

**Steps to Implement Option 2:**

- **In MDM5.5 and 7.1 iViews and UWL using the SSO-like feature**
  1. Delete the `allow.ip` file from the MDM Server installation folder.
  2. Switch to User Mapping authentication mode as explained in [MDM Portal Content Development Guide](https://me.sap.com/notes/1589234), "Connecting with the MDM Repository, User Mapping" section.

- **In MDM 7.1 Generated Web Services with Basic Authentication with SAP Logon Ticket Support**
  1. Delete the `allow.ip` file from the MDM Server installation folder.
  2. Use MDM Generated Web Services with No Authentication or with Basic Authentication as explained in [MDM Web Services guide](https://me.sap.com/notes/1589234) in sections "Defining Security Settings" and "MDM Web Services Security". See also [SAP Note 1542631](https://me.sap.com/notes/1542631).

- **In MDM 7.1 Web Dynpro Components**
  - Option 2 is not applicable.

- **In Custom MDM 5.5 and 7.1 Java API-based applications**
  1. Delete the `allow.ip` file.
  2. Set up adequate user management:
     - Create administrator-defined MDM usernames and passwords via the MDM Console.
     - Use these credentials when invoking authentication commands in the Java application.
  3. Remove API calls to Trusted Connection commands.
  4. Invoke the `AuthenticateUserSessionCommand` method from your Java application to use username/password-based authentication.

*See also [SAP Note 1589237](https://me.sap.com/notes/1589237) to address additional security concerns with clear-text transmission of data.

**References**

- [Communication Channel Encryption for SAP Netweaver MDM](https://me.sap.com/notes/1589237)
- [Update #1 to Security Note 1589234](https://me.sap.com/notes/1644143)

Credits to [redrays.io](https://redrays.io) for support to provided information.